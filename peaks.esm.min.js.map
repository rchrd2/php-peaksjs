{"version":3,"file":"peaks.esm.min.js","sources":["node_modules/peaks.js/node_modules/eventemitter3/index.js","node_modules/peaks.js/src/cue.js","node_modules/peaks.js/src/utils.js","node_modules/peaks.js/src/cue-emitter.js","node_modules/peaks.js/src/point.js","node_modules/peaks.js/src/waveform-points.js","node_modules/peaks.js/src/segment.js","node_modules/peaks.js/src/waveform-segments.js","node_modules/peaks.js/src/keyboard-handler.js","node_modules/peaks.js/src/mediaelement-player.js","node_modules/peaks.js/src/player.js","node_modules/peaks.js/src/default-point-marker.js","node_modules/peaks.js/src/default-segment-marker.js","node_modules/peaks.js/src/marker-factories.js","node_modules/peaks.js/src/highlight-layer.js","node_modules/peaks.js/src/mouse-drag-handler.js","node_modules/peaks.js/src/playhead-layer.js","node_modules/peaks.js/src/point-marker.js","node_modules/peaks.js/src/points-layer.js","node_modules/peaks.js/src/segment-marker.js","node_modules/peaks.js/src/waveform-shape.js","node_modules/peaks.js/src/segment-shape.js","node_modules/peaks.js/src/segments-layer.js","node_modules/peaks.js/src/waveform-axis.js","node_modules/peaks.js/src/waveform-overview.js","node_modules/peaks.js/src/waveform-zoomview.js","node_modules/peaks.js/src/view-controller.js","node_modules/peaks.js/src/zoom-controller.js","node_modules/peaks.js/src/waveform-builder.js","node_modules/peaks.js/src/main.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/**\n * @file\n *\n * Defines the {@link Cue} class.\n *\n * @module cue\n */\n\n/**\n * A cue represents an event to be triggered at some point on the media\n * timeline.\n *\n * @class\n * @alias Cue\n *\n * @param {Number} time Cue time, in seconds.\n * @param {Number} type Cue mark type, either <code>Cue.POINT</code>,\n *   <code>Cue.SEGMENT_START</code>, or <code>Cue.SEGMENT_END</code>.\n * @param {String} id The id of the {@link Point} or {@link Segment}.\n */\n\nfunction Cue(time, type, id) {\n  this.time = time;\n  this.type = type;\n  this.id = id;\n}\n\n/**\n  * @constant\n  * @type {Number}\n  */\n\nCue.POINT = 0;\nCue.SEGMENT_START = 1;\nCue.SEGMENT_END = 2;\n\n/**\n * Callback function for use with Array.prototype.sort().\n *\n * @static\n * @param {Cue} a\n * @param {Cue} b\n * @return {Number}\n */\n\nCue.sorter = function(a, b) {\n  return a.time - b.time;\n};\n\nexport default Cue;\n","function zeroPad(number, precision) {\n  number = number.toString();\n\n  while (number.length < precision) {\n    number = '0' + number;\n  }\n\n  return number;\n}\n\n/**\n * Returns a formatted time string.\n *\n * @param {Number} time The time to be formatted, in seconds.\n * @param {Number} precision Decimal places to which time is displayed\n * @returns {String}\n */\n\nexport function formatTime(time, precision) {\n  var result = [];\n\n  var fractionSeconds = Math.floor((time % 1) * Math.pow(10, precision));\n  var seconds = Math.floor(time);\n  var minutes = Math.floor(seconds / 60);\n  var hours = Math.floor(minutes / 60);\n\n  if (hours > 0) {\n    result.push(hours); // Hours\n  }\n  result.push(minutes % 60); // Mins\n  result.push(seconds % 60); // Seconds\n\n  for (var i = 0; i < result.length; i++) {\n    result[i] = zeroPad(result[i], 2);\n  }\n\n  result = result.join(':');\n\n  if (precision > 0) {\n    result += '.' + zeroPad(fractionSeconds, precision);\n  }\n\n  return result;\n}\n\n/**\n * Rounds the given value up to the nearest given multiple.\n *\n * @param {Number} value\n * @param {Number} multiple\n * @returns {Number}\n *\n * @example\n * roundUpToNearest(5.5, 3); // returns 6\n * roundUpToNearest(141.0, 10); // returns 150\n * roundUpToNearest(-5.5, 3); // returns -6\n */\n\nexport function roundUpToNearest(value, multiple) {\n  if (multiple === 0) {\n    return 0;\n  }\n\n  var multiplier = 1;\n\n  if (value < 0.0) {\n    multiplier = -1;\n    value = -value;\n  }\n\n  var roundedUp = Math.ceil(value);\n\n  return multiplier * (((roundedUp + multiple - 1) / multiple) | 0) * multiple;\n}\n\nexport function clamp(value, min, max) {\n  if (value < min) {\n    return min;\n  }\n  else if (value > max) {\n    return max;\n  }\n  else {\n    return value;\n  }\n}\n\nexport function objectHasProperty(object, field) {\n  return Object.prototype.hasOwnProperty.call(object, field);\n}\n\nexport function extend(to, from) {\n  for (var key in from) {\n    if (objectHasProperty(from, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\n/**\n * Checks whether the given array contains values in ascending order.\n *\n * @param {Array<Number>} array The array to test\n * @returns {Boolean}\n */\n\nexport function isInAscendingOrder(array) {\n  if (array.length === 0) {\n    return true;\n  }\n\n  var value = array[0];\n\n  for (var i = 1; i < array.length; i++) {\n    if (value >= array[i]) {\n      return false;\n    }\n\n    value = array[i];\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNumber(value) {\n  return typeof value === 'number';\n}\n\n/**\n * Checks whether the given value is a finite number.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFinite(value) {\n  if (typeof value !== 'number') {\n    return false;\n  }\n\n  // Check for NaN and infinity\n  // eslint-disable-next-line no-self-compare\n  if (value !== value || value === Infinity || value === -Infinity) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Checks whether the given value is a valid timestamp.\n *\n * @param {Number} value The value to test\n * @returns {Boolean}\n */\n\nexport function isValidTime(value) {\n  return (typeof value === 'number') && Number.isFinite(value);\n}\n\n/**\n * Checks whether the given value is a valid object.\n *\n * @param {Object|Array} value The value to test\n * @returns {Boolean}\n */\n\nexport function isObject(value) {\n  return (value !== null) && (typeof value === 'object')\n    && !Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid string.\n *\n * @param {String} value The value to test\n * @returns {Boolean}\n */\n\nexport function isString(value) {\n  return typeof value === 'string';\n}\n\n/**\n * Checks whether the given value is a valid ArrayBuffer.\n *\n * @param {ArrayBuffer} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArrayBuffer(value) {\n  return Object.prototype.toString.call(value).includes('ArrayBuffer');\n}\n\n/**\n * Checks whether the given value is null or undefined.\n *\n * @param {Object} value The value to test\n * @returns {Boolean}\n */\n\nexport function isNullOrUndefined(value) {\n  return value === undefined || value === null;\n}\n\n/**\n * Checks whether the given value is a function.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isFunction(value) {\n  return typeof value === 'function';\n}\n\n/**\n * Checks whether the given value is a boolean.\n *\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isBoolean(value) {\n  return value === true || value === false;\n}\n\n/**\n * Checks whether the given value is a valid HTML element.\n *\n * @param {HTMLElement} value The value to test\n * @returns {Boolean}\n */\n\nexport function isHTMLElement(value) {\n  return value instanceof HTMLElement;\n}\n\n/**\n * Checks whether the given value is an array\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Checks whether the given value is a valid linear gradient color\n * @param {Function} value The value to test\n * @returns {Boolean}\n */\n\nexport function isLinearGradientColor(value) {\n  return isObject(value) &&\n    objectHasProperty(value, 'linearGradientStart') &&\n    objectHasProperty(value, 'linearGradientEnd') &&\n    objectHasProperty(value, 'linearGradientColorStops') &&\n    isNumber(value.linearGradientStart) &&\n    isNumber(value.linearGradientEnd) &&\n    isArray(value.linearGradientColorStops) &&\n    value.linearGradientColorStops.length === 2;\n}\n","/**\n * @file\n *\n * Defines the {@link CueEmitter} class.\n *\n * @module cue-emitter\n */\n\nimport Cue from './cue';\nimport { objectHasProperty } from './utils';\n\nvar isHeadless = /HeadlessChrome/.test(navigator.userAgent);\n\nfunction windowIsVisible() {\n  if (isHeadless || navigator.webdriver) {\n    return false;\n  }\n\n  return (typeof document === 'object') &&\n    ('visibilityState' in document) &&\n    (document.visibilityState === 'visible');\n}\n\nvar requestAnimationFrame =\n  window.requestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.msRequestAnimationFrame;\n\nvar cancelAnimationFrame =\n  window.cancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.msCancelAnimationFrame;\n\nvar eventTypes = {\n  forward: {},\n  reverse: {}\n};\n\nvar EVENT_TYPE_POINT = 0;\nvar EVENT_TYPE_SEGMENT_ENTER = 1;\nvar EVENT_TYPE_SEGMENT_EXIT = 2;\n\neventTypes.forward[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.forward[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_ENTER;\neventTypes.forward[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_EXIT;\n\neventTypes.reverse[Cue.POINT] = EVENT_TYPE_POINT;\neventTypes.reverse[Cue.SEGMENT_START] = EVENT_TYPE_SEGMENT_EXIT;\neventTypes.reverse[Cue.SEGMENT_END] = EVENT_TYPE_SEGMENT_ENTER;\n\nvar eventNames = {};\n\neventNames[EVENT_TYPE_POINT] = 'points.enter';\neventNames[EVENT_TYPE_SEGMENT_ENTER] = 'segments.enter';\neventNames[EVENT_TYPE_SEGMENT_EXIT] = 'segments.exit';\n\n/**\n * Given a cue instance, returns the corresponding {@link Point}\n * {@link Segment}.\n *\n * @param {Peaks} peaks\n * @param {Cue} cue\n * @return {Point|Segment}\n * @throws {Error}\n */\n\nfunction getPointOrSegment(peaks, cue) {\n  switch (cue.type) {\n    case Cue.POINT:\n      return peaks.points.getPoint(cue.id);\n\n    case Cue.SEGMENT_START:\n    case Cue.SEGMENT_END:\n      return peaks.segments.getSegment(cue.id);\n\n    default:\n      throw new Error('getPointOrSegment: id not found?');\n  }\n}\n\n/**\n * CueEmitter is responsible for emitting <code>points.enter</code>,\n * <code>segments.enter</code>, and <code>segments.exit</code> events.\n *\n * @class\n * @alias CueEmitter\n *\n * @param {Peaks} peaks Parent {@link Peaks} instance.\n */\n\nfunction CueEmitter(peaks) {\n  this._cues = [];\n  this._peaks = peaks;\n  this._previousTime = -1;\n  this._updateCues = this._updateCues.bind(this);\n  // Event handlers:\n  this._onPlaying = this.onPlaying.bind(this);\n  this._onSeeked = this.onSeeked.bind(this);\n  this._onTimeUpdate = this.onTimeUpdate.bind(this);\n  this._onAnimationFrame = this.onAnimationFrame.bind(this);\n  this._rAFHandle = null;\n  this._activeSegments = {};\n  this._attachEventHandlers();\n}\n\n/**\n * This function is bound to all {@link Peaks} events relating to mutated\n * [Points]{@link Point} or [Segments]{@link Segment}, and updates the\n * list of cues accordingly.\n *\n * @private\n */\n\nCueEmitter.prototype._updateCues = function() {\n  var self = this;\n\n  var points = self._peaks.points.getPoints();\n  var segments = self._peaks.segments.getSegments();\n\n  self._cues.length = 0;\n\n  points.forEach(function(point) {\n    self._cues.push(new Cue(point.time, Cue.POINT, point.id));\n  });\n\n  segments.forEach(function(segment) {\n    self._cues.push(new Cue(segment.startTime, Cue.SEGMENT_START, segment.id));\n    self._cues.push(new Cue(segment.endTime, Cue.SEGMENT_END, segment.id));\n  });\n\n  self._cues.sort(Cue.sorter);\n\n  var time = self._peaks.player.getCurrentTime();\n\n  self._updateActiveSegments(time);\n};\n\n/**\n * Emits events for any cues passed through during media playback.\n *\n * @param {Number} time The current time on the media timeline.\n * @param {Number} previousTime The previous time on the media timeline when\n *   this function was called.\n */\n\nCueEmitter.prototype._onUpdate = function(time, previousTime) {\n  var isForward = time > previousTime;\n  var start;\n  var end;\n  var step;\n\n  if (isForward) {\n    start = 0;\n    end = this._cues.length;\n    step = 1;\n  }\n  else {\n    start = this._cues.length - 1;\n    end = -1;\n    step = -1;\n  }\n\n  // Cues are sorted\n  for (var i = start; isForward ? i < end : i > end; i += step) {\n    var cue = this._cues[i];\n\n    if (isForward ? cue.time > previousTime : cue.time < previousTime) {\n      if (isForward ? cue.time > time : cue.time < time) {\n        break;\n      }\n\n      // Cue falls between time and previousTime\n\n      var marker = getPointOrSegment(this._peaks, cue);\n\n      var eventType = isForward ? eventTypes.forward[cue.type] :\n                                  eventTypes.reverse[cue.type];\n\n      if (eventType === EVENT_TYPE_SEGMENT_ENTER) {\n        this._activeSegments[marker.id] = marker;\n      }\n      else if (eventType === EVENT_TYPE_SEGMENT_EXIT) {\n        delete this._activeSegments[marker.id];\n      }\n\n      this._peaks.emit(eventNames[eventType], marker);\n    }\n  }\n};\n\n// the next handler and onAnimationFrame are bound together\n// when the window isn't in focus, rAF is throttled\n// falling back to timeUpdate\n\nCueEmitter.prototype.onTimeUpdate = function(time) {\n  if (windowIsVisible()) {\n    return;\n  }\n\n  if (this._peaks.player.isPlaying() && !this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n};\n\nCueEmitter.prototype.onAnimationFrame = function() {\n  var time = this._peaks.player.getCurrentTime();\n\n  if (!this._peaks.player.isSeeking()) {\n    this._onUpdate(time, this._previousTime);\n  }\n\n  this._previousTime = time;\n\n  if (this._peaks.player.isPlaying()) {\n    this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n  }\n};\n\nCueEmitter.prototype.onPlaying = function() {\n  this._previousTime = this._peaks.player.getCurrentTime();\n  this._rAFHandle = requestAnimationFrame(this._onAnimationFrame);\n};\n\nCueEmitter.prototype.onSeeked = function(time) {\n  this._previousTime = time;\n\n  this._updateActiveSegments(time);\n};\n\nfunction getSegmentIdComparator(id) {\n  return function compareSegmentIds(segment) {\n    return segment.id === id;\n  };\n}\n\n/**\n * The active segments is the set of all segments which overlap the current\n * playhead position. This function updates that set and emits\n * <code>segments.enter</code> and <code>segments.exit</code> events.\n */\n\nCueEmitter.prototype._updateActiveSegments = function(time) {\n  var self = this;\n\n  var activeSegments = self._peaks.segments.getSegmentsAtTime(time);\n\n  // Remove any segments no longer active.\n\n  for (var id in self._activeSegments) {\n    if (objectHasProperty(self._activeSegments, id)) {\n      var segment = activeSegments.find(getSegmentIdComparator(id));\n\n      if (!segment) {\n        self._peaks.emit('segments.exit', self._activeSegments[id]);\n        delete self._activeSegments[id];\n      }\n    }\n  }\n\n  // Add new active segments.\n\n  activeSegments.forEach(function(segment) {\n    if (!(segment.id in self._activeSegments)) {\n      self._activeSegments[segment.id] = segment;\n      self._peaks.emit('segments.enter', segment);\n    }\n  });\n};\n\nvar triggerUpdateOn = Array(\n  'points.update',\n  'points.dragmove',\n  'points.add',\n  'points.remove',\n  'points.remove_all',\n  'segments.update',\n  'segments.dragged',\n  'segments.add',\n  'segments.remove',\n  'segments.remove_all'\n);\n\nCueEmitter.prototype._attachEventHandlers = function() {\n  this._peaks.on('player.timeupdate', this._onTimeUpdate);\n  this._peaks.on('player.playing', this._onPlaying);\n  this._peaks.on('player.seeked', this._onSeeked);\n\n  for (var i = 0; i < triggerUpdateOn.length; i++) {\n    this._peaks.on(triggerUpdateOn[i], this._updateCues);\n  }\n\n  this._updateCues();\n};\n\nCueEmitter.prototype._detachEventHandlers = function() {\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.seeked', this._onSeeked);\n\n  for (var i = 0; i < triggerUpdateOn.length; i++) {\n    this._peaks.off(triggerUpdateOn[i], this._updateCues);\n  }\n};\n\nCueEmitter.prototype.destroy = function() {\n  if (this._rAFHandle) {\n    cancelAnimationFrame(this._rAFHandle);\n    this._rAFHandle = null;\n  }\n\n  this._detachEventHandlers();\n\n  this._previousTime = -1;\n};\n\nexport default CueEmitter;\n","/**\n * @file\n *\n * Defines the {@link Point} class.\n *\n * @module point\n */\n\nimport {\n  extend, isBoolean, isLinearGradientColor, isNullOrUndefined, isString,\n  isValidTime, objectHasProperty\n} from './utils';\n\nvar pointOptions = ['peaks', 'id', 'time', 'labelText', 'color', 'editable'];\n\nfunction validatePoint(options, context) {\n  if (!isValidTime(options.time)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.points.' + context + ': time should be a numeric value');\n  }\n\n  if (options.time < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.points.' + context + ': time should not be negative');\n  }\n\n  if (isNullOrUndefined(options.labelText)) {\n    // Set default label text\n    options.labelText = '';\n  }\n  else if (!isString(options.labelText)) {\n    throw new TypeError('peaks.points.' + context + ': labelText must be a string');\n  }\n\n  if (!isBoolean(options.editable)) {\n    throw new TypeError('peaks.points.' + context + ': editable must be true or false');\n  }\n\n  if (options.color &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.points.' + context + ': color must be a string or a valid linear gradient object');\n  }\n}\n\n/**\n * A point is a single instant of time, with associated label and color.\n *\n * @class\n * @alias Point\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {String} id A unique identifier for the point.\n * @param {Number} time Point time, in seconds.\n * @param {String} labelText Point label text.\n * @param {String} color Point marker color.\n * @param {Boolean} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n * @param {*} data Optional application specific data.\n */\n\nfunction Point(options) {\n  validatePoint(options, 'add()');\n\n  this._peaks     = options.peaks;\n  this._id        = options.id;\n  this._time      = options.time;\n  this._labelText = options.labelText;\n  this._color     = options.color;\n  this._editable  = options.editable;\n\n  this._setUserData(options);\n}\n\nPoint.prototype._setUserData = function(options) {\n  for (var key in options) {\n    if (objectHasProperty(options, key) && pointOptions.indexOf(key) === -1) {\n      this[key] = options[key];\n    }\n  }\n};\n\nObject.defineProperties(Point.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  time: {\n    enumerable: true,\n    get: function() {\n      return this._time;\n    }\n  },\n  labelText: {\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nPoint.prototype.update = function(options) {\n  var opts = {\n    time:      this.time,\n    labelText: this.labelText,\n    color:     this.color,\n    editable:  this.editable\n  };\n\n  extend(opts, options);\n\n  validatePoint(opts, 'update()');\n\n  this._time      = opts.time;\n  this._labelText = opts.labelText;\n  this._color     = opts.color;\n  this._editable  = opts.editable;\n\n  this._setUserData(options);\n\n  this._peaks.emit('points.update', this);\n};\n\n/**\n * Returns <code>true</code> if the point lies with in a given time range.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n */\n\nPoint.prototype.isVisible = function(startTime, endTime) {\n  return this.time >= startTime && this.time < endTime;\n};\n\nPoint.prototype._setTime = function(time) {\n  this._time = time;\n};\n\nexport default Point;\n","/**\n * @file\n *\n * Defines the {@link WaveformPoints} class.\n *\n * @module waveform-points\n */\n\nimport Point from './point';\nimport { extend, isNullOrUndefined, objectHasProperty } from './utils';\n\n/**\n * Point parameters.\n *\n * @typedef {Object} PointOptions\n * @global\n * @property {Number} point Point time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the point time can be\n *   adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Point marker color.\n *   Default: a random color.\n * @property {String=} labelText Point label text.\n *   Default: an empty string.\n * @property {String=} id A unique point identifier.\n *   Default: an automatically generated identifier.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of points. A point is a single instant of time.\n *\n * @class\n * @alias WaveformPoints\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformPoints(peaks) {\n  this._peaks = peaks;\n  this._points = [];\n  this._pointsById = {};\n  this._pointIdCounter = 0;\n}\n\n/**\n * Returns a new unique point id value.\n *\n * @returns {String}\n */\n\nWaveformPoints.prototype._getNextPointId = function() {\n  return 'peaks.point.' + this._pointIdCounter++;\n};\n\n/**\n * Adds a new point object.\n *\n * @private\n * @param {Point} point\n */\n\nWaveformPoints.prototype._addPoint = function(point) {\n  this._points.push(point);\n\n  this._pointsById[point.id] = point;\n};\n\n/**\n * Creates a new point object.\n *\n * @private\n * @param {PointOptions} options\n * @returns {Point}\n */\n\nWaveformPoints.prototype._createPoint = function(options) {\n  var pointOptions = {\n    peaks: this._peaks\n  };\n\n  extend(pointOptions, options);\n\n  if (isNullOrUndefined(pointOptions.id)) {\n    pointOptions.id = this._getNextPointId();\n  }\n\n  if (isNullOrUndefined(pointOptions.labelText)) {\n    pointOptions.labelText = '';\n  }\n\n  if (isNullOrUndefined(pointOptions.editable)) {\n    pointOptions.editable = false;\n  }\n\n  return new Point(pointOptions);\n};\n\n/**\n * Returns all points.\n *\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.getPoints = function() {\n  return this._points;\n};\n\n/**\n * Returns the point with the given id, or <code>null</code> if not found.\n *\n * @param {String} id\n * @returns {Point|null}\n */\n\nWaveformPoints.prototype.getPoint = function(id) {\n  return this._pointsById[id] || null;\n};\n\n/**\n * Returns all points within a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Array<Point>}\n */\n\nWaveformPoints.prototype.find = function(startTime, endTime) {\n  return this._points.filter(function(point) {\n    return point.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Adds one or more points to the timeline.\n *\n * @param {PointOptions|Array<PointOptions>} pointOrPoints\n *\n * @returns Point|Array<Point>\n */\n\nWaveformPoints.prototype.add = function(/* pointOrPoints */) {\n  var self = this;\n\n  var arrayArgs = Array.isArray(arguments[0]);\n  var points = arrayArgs ?\n               arguments[0] :\n               Array.prototype.slice.call(arguments);\n\n  points = points.map(function(pointOptions) {\n    var point = self._createPoint(pointOptions);\n\n    if (objectHasProperty(self._pointsById, point.id)) {\n      throw new Error('peaks.points.add(): duplicate id');\n    }\n\n    return point;\n  });\n\n  points.forEach(function(point) {\n    self._addPoint(point);\n  });\n\n  this._peaks.emit('points.add', points);\n\n  return arrayArgs ? points : points[0];\n};\n\n/**\n * Returns the indexes of points that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching points.\n * @returns {Array<Number>} An array of indexes into the points array of\n *   the matching elements.\n */\n\nWaveformPoints.prototype._findPoint = function(predicate) {\n  var indexes = [];\n\n  for (var i = 0, length = this._points.length; i < length; i++) {\n    if (predicate(this._points[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the points at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype._removeIndexes = function(indexes) {\n  var removed = [];\n\n  for (var i = 0; i < indexes.length; i++) {\n    var index = indexes[i] - removed.length;\n\n    var itemRemoved = this._points.splice(index, 1)[0];\n\n    delete this._pointsById[itemRemoved.id];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all points that match a given predicate function.\n *\n * After removing the points, this function emits a\n * <code>points.remove</code> event with the removed {@link Point}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   points to remove.\n * @returns {Array<Point>} The removed {@link Points} objects.\n */\n\nWaveformPoints.prototype._removePoints = function(predicate) {\n  var indexes = this._findPoint(predicate);\n\n  var removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('points.remove', removed);\n\n  return removed;\n};\n\n/**\n * Removes the given point.\n *\n * @param {Point} point The point to remove.\n * @returns {Array<Point>} The removed points.\n */\n\nWaveformPoints.prototype.remove = function(point) {\n  return this._removePoints(function(p) {\n    return p === point;\n  });\n};\n\n/**\n * Removes any points with the given id.\n *\n * @param {String} id\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeById = function(pointId) {\n  return this._removePoints(function(point) {\n    return point.id === pointId;\n  });\n};\n\n/**\n * Removes any points at the given time.\n *\n * @param {Number} time\n * @returns {Array<Point>} The removed {@link Point} objects.\n */\n\nWaveformPoints.prototype.removeByTime = function(time) {\n  return this._removePoints(function(point) {\n    return point.time === time;\n  });\n};\n\n/**\n * Removes all points.\n *\n * After removing the points, this function emits a\n * <code>points.remove_all</code> event.\n */\n\nWaveformPoints.prototype.removeAll = function() {\n  this._points = [];\n  this._pointsById = {};\n  this._peaks.emit('points.remove_all');\n};\n\nexport default WaveformPoints;\n","/**\n * @file\n *\n * Defines the {@link Segment} class.\n *\n * @module segment\n */\n\nimport {\n  extend, isBoolean, isNullOrUndefined, isLinearGradientColor,\n  isString, isValidTime, objectHasProperty\n} from './utils';\n\nvar segmentOptions = ['peaks', 'id', 'startTime', 'endTime', 'labelText', 'color', 'editable'];\n\nfunction validateSegment(options, context) {\n  if (!isValidTime(options.startTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': startTime should be a valid number');\n  }\n\n  if (!isValidTime(options.endTime)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': endTime should be a valid number');\n  }\n\n  if (options.startTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': startTime should not be negative');\n  }\n\n  if (options.endTime < 0) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be negative');\n  }\n\n  if (options.endTime < options.startTime) {\n    // eslint-disable-next-line max-len\n    throw new RangeError('peaks.segments.' + context + ': endTime should not be less than startTime');\n  }\n\n  if (isNullOrUndefined(options.labelText)) {\n    // Set default label text\n    options.labelText = '';\n  }\n  else if (!isString(options.labelText)) {\n    throw new TypeError('peaks.segments.' + context + ': labelText must be a string');\n  }\n\n  if (!isBoolean(options.editable)) {\n    throw new TypeError('peaks.segments.' + context + ': editable must be true or false');\n  }\n\n  if (options.color &&\n    !isString(options.color) &&\n    !isLinearGradientColor(options.color)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.' + context + ': color must be a string or a valid linear gradient object');\n  }\n}\n\n/**\n * A segment is a region of time, with associated label and color.\n *\n * @class\n * @alias Segment\n *\n * @param {Peaks} peaks A reference to the Peaks instance.\n * @param {String} id A unique identifier for the segment.\n * @param {Number} startTime Segment start time, in seconds.\n * @param {Number} endTime Segment end time, in seconds.\n * @param {String} labelText Segment label text.\n * @param {String | LinearGradientColor} color Segment waveform color.\n * @param {Boolean} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n * @param {*} data Optional application specific data.\n */\n\nfunction Segment(options) {\n  validateSegment(options, 'add()');\n\n  this._peaks     = options.peaks;\n  this._id        = options.id;\n  this._startTime = options.startTime;\n  this._endTime   = options.endTime;\n  this._labelText = options.labelText;\n  this._color     = options.color;\n  this._editable  = options.editable;\n\n  this._setUserData(options);\n}\n\nSegment.prototype._setUserData = function(options) {\n  for (var key in options) {\n    if (objectHasProperty(options, key) && segmentOptions.indexOf(key) === -1) {\n      this[key] = options[key];\n    }\n  }\n};\n\nObject.defineProperties(Segment.prototype, {\n  id: {\n    enumerable: true,\n    get: function() {\n      return this._id;\n    }\n  },\n  startTime: {\n    enumerable: true,\n    get: function() {\n      return this._startTime;\n    }\n  },\n  endTime: {\n    enumerable: true,\n    get: function() {\n      return this._endTime;\n    }\n  },\n  labelText: {\n    enumerable: true,\n    get: function() {\n      return this._labelText;\n    }\n  },\n  color: {\n    enumerable: true,\n    get: function() {\n      return this._color;\n    }\n  },\n  editable: {\n    enumerable: true,\n    get: function() {\n      return this._editable;\n    }\n  }\n});\n\nSegment.prototype.update = function(options) {\n  var opts = {\n    startTime: this.startTime,\n    endTime:   this.endTime,\n    labelText: this.labelText,\n    color:     this.color,\n    editable:  this.editable\n  };\n\n  extend(opts, options);\n\n  validateSegment(opts, 'update()');\n\n  this._startTime = opts.startTime;\n  this._endTime   = opts.endTime;\n  this._labelText = opts.labelText;\n  this._color     = opts.color;\n  this._editable  = opts.editable;\n\n  this._setUserData(options);\n\n  this._peaks.emit('segments.update', this);\n};\n\n/**\n * Returns <code>true</code> if the segment overlaps a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n * @returns {Boolean}\n *\n * @see http://wiki.c2.com/?TestIfDateRangesOverlap\n */\n\nSegment.prototype.isVisible = function(startTime, endTime) {\n  return this.startTime < endTime && startTime < this.endTime;\n};\n\nSegment.prototype._setStartTime = function(time) {\n  this._startTime = time;\n};\n\nSegment.prototype._setEndTime = function(time) {\n  this._endTime = time;\n};\n\nexport default Segment;\n","/**\n * @file\n *\n * Defines the {@link WaveformSegments} class.\n *\n * @module waveform-segments\n */\n\nimport Segment from './segment';\nimport { extend, isNullOrUndefined, isObject, objectHasProperty } from './utils';\n\n/**\n * Segment parameters.\n *\n * @typedef {Object} SegmentOptions\n * @global\n * @property {Number} startTime Segment start time, in seconds.\n * @property {Number} endTime Segment end time, in seconds.\n * @property {Boolean=} editable If <code>true</code> the segment start and\n *   end times can be adjusted via the user interface.\n *   Default: <code>false</code>.\n * @property {String=} color Segment waveform color.\n *   Default: a random color.\n * @property {String=} labelText Segment label text.\n *   Default: an empty string.\n * @property {String=} id A unique segment identifier.\n *   Default: an automatically generated identifier.\n */\n\n/**\n * Handles all functionality related to the adding, removing and manipulation\n * of segments.\n *\n * @class\n * @alias WaveformSegments\n *\n * @param {Peaks} peaks The parent Peaks object.\n */\n\nfunction WaveformSegments(peaks) {\n  this._peaks = peaks;\n  this._segments = [];\n  this._segmentsById = {};\n  this._segmentIdCounter = 0;\n  this._colorIndex = 0;\n}\n\n/**\n * Returns a new unique segment id value.\n *\n * @private\n * @returns {String}\n */\n\nWaveformSegments.prototype._getNextSegmentId = function() {\n  return 'peaks.segment.' + this._segmentIdCounter++;\n};\n\nvar colors = [\n  '#001f3f', // navy\n  '#0074d9', // blue\n  '#7fdbff', // aqua\n  '#39cccc', // teal\n  '#ffdc00', // yellow\n  '#ff851b', // orange\n  '#ff4136', // red\n  '#85144b', // maroon\n  '#f012be', // fuchsia\n  '#b10dc9'  // purple\n];\n\n/**\n * @private\n * @returns {String}\n */\n\nWaveformSegments.prototype._getSegmentColor = function() {\n  if (this._peaks.options.randomizeSegmentColor) {\n    if (++this._colorIndex === colors.length) {\n      this._colorIndex = 0;\n    }\n\n    return colors[this._colorIndex];\n  }\n  else {\n    return this._peaks.options.segmentColor;\n  }\n};\n\n/**\n * Adds a new segment object.\n *\n * @private\n * @param {Segment} segment\n */\n\nWaveformSegments.prototype._addSegment = function(segment) {\n  this._segments.push(segment);\n\n  this._segmentsById[segment.id] = segment;\n};\n\n/**\n * Creates a new segment object.\n *\n * @private\n * @param {SegmentOptions} options\n * @return {Segment}\n */\n\nWaveformSegments.prototype._createSegment = function(options) {\n  // Watch for anyone still trying to use the old\n  // createSegment(startTime, endTime, ...) API\n  if (!isObject(options)) {\n    // eslint-disable-next-line max-len\n    throw new TypeError('peaks.segments.add(): expected a Segment object parameter');\n  }\n\n  var segmentOptions = {\n    peaks: this._peaks\n  };\n\n  extend(segmentOptions, options);\n\n  if (isNullOrUndefined(segmentOptions.id)) {\n    segmentOptions.id = this._getNextSegmentId();\n  }\n\n  if (isNullOrUndefined(segmentOptions.color)) {\n    segmentOptions.color = this._getSegmentColor();\n  }\n\n  if (isNullOrUndefined(segmentOptions.labelText)) {\n    segmentOptions.labelText = '';\n  }\n\n  if (isNullOrUndefined(segmentOptions.editable)) {\n    segmentOptions.editable = false;\n  }\n\n  return new Segment(segmentOptions);\n};\n\n/**\n * Returns all segments.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegments = function() {\n  return this._segments;\n};\n\n/**\n * Returns the segment with the given id, or <code>null</code> if not found.\n *\n * @param {String} id\n * @returns {Segment|null}\n */\n\nWaveformSegments.prototype.getSegment = function(id) {\n  return this._segmentsById[id] || null;\n};\n\n/**\n * Returns all segments that overlap a given point in time.\n *\n * @param {Number} time\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.getSegmentsAtTime = function(time) {\n  return this._segments.filter(function(segment) {\n    return time >= segment.startTime && time < segment.endTime;\n  });\n};\n\n/**\n * Returns all segments that overlap a given time region.\n *\n * @param {Number} startTime The start of the time region, in seconds.\n * @param {Number} endTime The end of the time region, in seconds.\n *\n * @returns {Array<Segment>}\n */\n\nWaveformSegments.prototype.find = function(startTime, endTime) {\n  return this._segments.filter(function(segment) {\n    return segment.isVisible(startTime, endTime);\n  });\n};\n\n/**\n * Adds one or more segments to the timeline.\n *\n * @param {SegmentOptions|Array<SegmentOptions>} segmentOrSegments\n *\n * @returns Segment|Array<Segment>\n */\n\nWaveformSegments.prototype.add = function(/* segmentOrSegments */) {\n  var self = this;\n\n  var arrayArgs = Array.isArray(arguments[0]);\n  var segments = arrayArgs ?\n                 arguments[0] :\n                 Array.prototype.slice.call(arguments);\n\n  segments = segments.map(function(segmentOptions) {\n    var segment = self._createSegment(segmentOptions);\n\n    if (objectHasProperty(self._segmentsById, segment.id)) {\n      throw new Error('peaks.segments.add(): duplicate id');\n    }\n\n    return segment;\n  });\n\n  segments.forEach(function(segment) {\n    self._addSegment(segment);\n  });\n\n  this._peaks.emit('segments.add', segments);\n\n  return arrayArgs ? segments : segments[0];\n};\n\n/**\n * Returns the indexes of segments that match the given predicate.\n *\n * @private\n * @param {Function} predicate Predicate function to find matching segments.\n * @returns {Array<Number>} An array of indexes into the segments array of\n *   the matching elements.\n */\n\nWaveformSegments.prototype._findSegment = function(predicate) {\n  var indexes = [];\n\n  for (var i = 0, length = this._segments.length; i < length; i++) {\n    if (predicate(this._segments[i])) {\n      indexes.push(i);\n    }\n  }\n\n  return indexes;\n};\n\n/**\n * Removes the segments at the given array indexes.\n *\n * @private\n * @param {Array<Number>} indexes The array indexes to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeIndexes = function(indexes) {\n  var removed = [];\n\n  for (var i = 0; i < indexes.length; i++) {\n    var index = indexes[i] - removed.length;\n\n    var itemRemoved = this._segments.splice(index, 1)[0];\n\n    delete this._segmentsById[itemRemoved.id];\n\n    removed.push(itemRemoved);\n  }\n\n  return removed;\n};\n\n/**\n * Removes all segments that match a given predicate function.\n *\n * After removing the segments, this function also emits a\n * <code>segments.remove</code> event with the removed {@link Segment}\n * objects.\n *\n * @private\n * @param {Function} predicate A predicate function that identifies which\n *   segments to remove.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype._removeSegments = function(predicate) {\n  var indexes = this._findSegment(predicate);\n\n  var removed = this._removeIndexes(indexes);\n\n  this._peaks.emit('segments.remove', removed);\n\n  return removed;\n};\n\n/**\n * Removes the given segment.\n *\n * @param {Segment} segment The segment to remove.\n * @returns {Array<Segment>} The removed segment.\n */\n\nWaveformSegments.prototype.remove = function(segment) {\n  return this._removeSegments(function(s) {\n    return s === segment;\n  });\n};\n\n/**\n * Removes any segments with the given id.\n *\n * @param {String} id\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeById = function(segmentId) {\n  return this._removeSegments(function(segment) {\n    return segment.id === segmentId;\n  });\n};\n\n/**\n * Removes any segments with the given start time, and optional end time.\n *\n * @param {Number} startTime Segments with this start time are removed.\n * @param {Number?} endTime If present, only segments with both the given\n *   start time and end time are removed.\n * @returns {Array<Segment>} The removed {@link Segment} objects.\n */\n\nWaveformSegments.prototype.removeByTime = function(startTime, endTime) {\n  endTime = (typeof endTime === 'number') ? endTime : 0;\n\n  var fnFilter;\n\n  if (endTime > 0) {\n    fnFilter = function(segment) {\n      return segment.startTime === startTime && segment.endTime === endTime;\n    };\n  }\n  else {\n    fnFilter = function(segment) {\n      return segment.startTime === startTime;\n    };\n  }\n\n  return this._removeSegments(fnFilter);\n};\n\n/**\n * Removes all segments.\n *\n * After removing the segments, this function emits a\n * <code>segments.remove_all</code> event.\n */\n\nWaveformSegments.prototype.removeAll = function() {\n  this._segments = [];\n  this._segmentsById = {};\n  this._peaks.emit('segments.remove_all');\n};\n\nexport default WaveformSegments;\n","/**\n * @file\n *\n * Defines the {@link KeyboardHandler} class.\n *\n * @module keyboard-handler\n */\n\nvar nodes = ['OBJECT', 'TEXTAREA', 'INPUT', 'SELECT', 'OPTION'];\n\nvar SPACE = 32,\n    TAB = 9,\n    LEFT_ARROW = 37,\n    RIGHT_ARROW = 39;\n\nvar keys = [SPACE, TAB, LEFT_ARROW, RIGHT_ARROW];\n\n/**\n * Configures keyboard event handling.\n *\n * @class\n * @alias KeyboardHandler\n *\n * @param {EventEmitter} eventEmitter\n */\n\nfunction KeyboardHandler(eventEmitter) {\n  this.eventEmitter = eventEmitter;\n\n  this._handleKeyEvent = this._handleKeyEvent.bind(this);\n\n  document.addEventListener('keydown', this._handleKeyEvent);\n  document.addEventListener('keypress', this._handleKeyEvent);\n  document.addEventListener('keyup', this._handleKeyEvent);\n}\n\n/**\n * Keyboard event handler function.\n *\n * @note Arrow keys only triggered on keydown, not keypress.\n *\n * @param {KeyboardEvent} event\n * @private\n */\n\nKeyboardHandler.prototype._handleKeyEvent = function handleKeyEvent(event) {\n  if (nodes.indexOf(event.target.nodeName) === -1) {\n    if (keys.indexOf(event.type) > -1) {\n      event.preventDefault();\n    }\n\n    if (event.type === 'keydown' || event.type === 'keypress') {\n      switch (event.keyCode) {\n        case SPACE:\n          this.eventEmitter.emit('keyboard.space');\n          break;\n\n        case TAB:\n          this.eventEmitter.emit('keyboard.tab');\n          break;\n      }\n    }\n    else if (event.type === 'keyup') {\n      switch (event.keyCode) {\n        case LEFT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_left');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.left');\n          }\n          break;\n\n        case RIGHT_ARROW:\n          if (event.shiftKey) {\n            this.eventEmitter.emit('keyboard.shift_right');\n          }\n          else {\n            this.eventEmitter.emit('keyboard.right');\n          }\n          break;\n      }\n    }\n  }\n};\n\nKeyboardHandler.prototype.destroy = function() {\n  document.removeEventListener('keydown', this._handleKeyEvent);\n  document.removeEventListener('keypress', this._handleKeyEvent);\n  document.removeEventListener('keyup', this._handleKeyEvent);\n};\n\nexport default KeyboardHandler;\n","/**\n * @file\n *\n * Implementation of {@link Player} adapter based on the HTML5 media element.\n *\n * @module player-medialement\n */\n\n/**\n * A wrapper for interfacing with the HTML5 media element API.\n * Initializes the player for a given media element.\n *\n * @class\n * @alias MediaElementPlayer\n * @param {HTMLMediaElement} mediaElement The HTML <code>&lt;audio&gt;</code>\n *   or <code>&lt;video&gt;</code> element to associate with the\n *   {@link Peaks} instance.\n */\n\nfunction MediaElementPlayer(peaks, mediaElement) {\n  var self = this;\n\n  self._peaks = peaks;\n  self._listeners = [];\n  self._mediaElement = mediaElement;\n}\n\n/**\n * Adds an event listener to the media element.\n *\n * @private\n * @param {String} type The event type to listen for.\n * @param {Function} callback An event handler function.\n */\n\nMediaElementPlayer.prototype._addMediaListener = function(type, callback) {\n  this._listeners.push({ type: type, callback: callback });\n  this._mediaElement.addEventListener(type, callback);\n};\n\nMediaElementPlayer.prototype.init = function(player) {\n  var self = this;\n\n  self._player = player;\n  self._listeners = [];\n  self._duration = self.getDuration();\n  self._isPlaying = false;\n\n  self._addMediaListener('timeupdate', function() {\n    self._peaks.emit('player.timeupdate', self.getCurrentTime());\n  });\n\n  self._addMediaListener('playing', function() {\n    self._isPlaying = true;\n    self._peaks.emit('player.playing', self.getCurrentTime());\n  });\n\n  self._addMediaListener('pause', function() {\n    self._isPlaying = false;\n    self._peaks.emit('player.pause', self.getCurrentTime());\n  });\n\n  self._addMediaListener('ended', function() {\n    self._peaks.emit('player.ended');\n  });\n\n  self._addMediaListener('seeked', function() {\n    self._peaks.emit('player.seeked', self.getCurrentTime());\n  });\n\n  self._addMediaListener('canplay', function() {\n    self._peaks.emit('player.canplay');\n  });\n\n  self._addMediaListener('error', function(event) {\n    self._peaks.emit('player.error', event.target.error);\n  });\n\n  self._interval = null;\n\n  // If the media element has preload=\"none\", clicking to seek in the\n  // waveform won't work, so here we force the media to load.\n  if (self._mediaElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n    self._mediaElement.load();\n  }\n};\n\n/**\n * Cleans up the player object, removing all event listeners from the\n * associated media element.\n */\n\nMediaElementPlayer.prototype.destroy = function() {\n  for (var i = 0; i < this._listeners.length; i++) {\n    var listener = this._listeners[i];\n\n    this._mediaElement.removeEventListener(\n      listener.type,\n      listener.callback\n    );\n  }\n\n  this._listeners.length = 0;\n\n  this._mediaElement = null;\n};\n\nMediaElementPlayer.prototype.play = function() {\n  return this._mediaElement.play();\n};\n\nMediaElementPlayer.prototype.pause = function() {\n  this._mediaElement.pause();\n};\n\nMediaElementPlayer.prototype.isPlaying = function() {\n  return this._isPlaying;\n};\n\nMediaElementPlayer.prototype.isSeeking = function() {\n  return this._mediaElement.seeking;\n};\n\nMediaElementPlayer.prototype.getCurrentTime = function() {\n  return this._mediaElement.currentTime;\n};\n\nMediaElementPlayer.prototype.getDuration = function() {\n  return this._mediaElement.duration;\n};\n\nMediaElementPlayer.prototype.seek = function(time) {\n  this._mediaElement.currentTime = time;\n};\n\nexport default MediaElementPlayer;\n","/**\n * @file\n *\n * A general audio player class which interfaces with external audio players.\n * The default audio player in Peaks.js is {@link MediaElementPlayer}.\n *\n * @module player\n */\n\nimport { isValidTime } from './utils';\n\nfunction getAllPropertiesFrom(adapter) {\n  var allProperties = [];\n  var obj = adapter;\n\n  while (obj) {\n    Object.getOwnPropertyNames(obj).forEach(function(p) {\n      allProperties.push(p);\n    });\n\n    obj = Object.getPrototypeOf(obj);\n  }\n\n  return allProperties;\n}\n\nfunction validateAdapter(adapter) {\n  var publicAdapterMethods = [\n    'init',\n    'destroy',\n    'play',\n    'pause',\n    'isPlaying',\n    'isSeeking',\n    'getCurrentTime',\n    'getDuration',\n    'seek'\n  ];\n\n  var allProperties = getAllPropertiesFrom(adapter);\n\n  publicAdapterMethods.forEach(function(method) {\n    if (!allProperties.includes(method)) {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is undefined');\n    }\n\n    if ((typeof adapter[method]) !== 'function') {\n      throw new TypeError('Peaks.init(): Player method ' + method + ' is not a function');\n    }\n  });\n}\n\n/**\n * A wrapper for interfacing with an external player API.\n *\n * @class\n * @alias Player\n *\n * @param {Peaks} peaks The parent {@link Peaks} object.\n * @param {Adapter} adapter The player adapter.\n */\n\nfunction Player(peaks, adapter) {\n  this._peaks = peaks;\n\n  this._playingSegment = false;\n  this._segment = null;\n  this._loop = false;\n  this._playSegmentTimerCallback = this._playSegmentTimerCallback.bind(this);\n\n  validateAdapter(adapter);\n  this._adapter = adapter;\n\n  this._adapter.init(peaks);\n}\n\n/**\n * Cleans up the player object.\n */\n\nPlayer.prototype.destroy = function() {\n  this._adapter.destroy();\n};\n\n/**\n * Starts playback.\n * @returns {Promise}\n */\n\nPlayer.prototype.play = function() {\n  return this._adapter.play();\n};\n\n/**\n * Pauses playback.\n */\n\nPlayer.prototype.pause = function() {\n  this._adapter.pause();\n};\n\n/**\n * @returns {Boolean} <code>true</code> if playing, <code>false</code>\n * otherwise.\n */\n\nPlayer.prototype.isPlaying = function() {\n  return this._adapter.isPlaying();\n};\n\n/**\n * @returns {boolean} <code>true</code> if seeking\n */\n\nPlayer.prototype.isSeeking = function() {\n  return this._adapter.isSeeking();\n};\n\n/**\n * Returns the current playback time position, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getCurrentTime = function() {\n  return this._adapter.getCurrentTime();\n};\n\n/**\n * Returns the media duration, in seconds.\n *\n * @returns {Number}\n */\n\nPlayer.prototype.getDuration = function() {\n  return this._adapter.getDuration();\n};\n\n/**\n * Seeks to a given time position within the media.\n *\n * @param {Number} time The time position, in seconds.\n */\n\nPlayer.prototype.seek = function(time) {\n  if (!isValidTime(time)) {\n    this._peaks.logger('peaks.player.seek(): parameter must be a valid time, in seconds');\n    return;\n  }\n\n  this._adapter.seek(time);\n};\n\n/**\n * Plays the given segment.\n *\n * @param {Segment} segment The segment denoting the time region to play.\n * @param {Boolean} loop If true, playback is looped.\n */\n\nPlayer.prototype.playSegment = function(segment, loop) {\n  var self = this;\n\n  if (!segment ||\n    !isValidTime(segment.startTime) ||\n    !isValidTime(segment.endTime)) {\n    return Promise.reject(\n      new Error('peaks.player.playSegment(): parameter must be a segment object')\n    );\n  }\n\n  self._segment = segment;\n  self._loop = loop;\n\n  // Set audio time to segment start time\n  self.seek(segment.startTime);\n\n  self._peaks.once('player.playing', function() {\n    if (!self._playingSegment) {\n      self._playingSegment = true;\n\n      // We need to use requestAnimationFrame here as the timeupdate event\n      // doesn't fire often enough.\n      window.requestAnimationFrame(self._playSegmentTimerCallback);\n    }\n  });\n\n  // Start playing audio\n  return self.play();\n};\n\nPlayer.prototype._playSegmentTimerCallback = function() {\n  if (!this.isPlaying()) {\n    this._playingSegment = false;\n    return;\n  }\n  else if (this.getCurrentTime() >= this._segment.endTime) {\n    if (this._loop) {\n      this.seek(this._segment.startTime);\n    }\n    else {\n      this.pause();\n      this._peaks.emit('player.ended');\n      this._playingSegment = false;\n      return;\n    }\n  }\n\n  window.requestAnimationFrame(this._playSegmentTimerCallback);\n};\n\nexport default Player;\n","/**\n * @file\n *\n * Defines the {@link DefaultPointMarker} class.\n *\n * @module default-point-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias DefaultPointMarker\n *\n * @param {CreatePointMarkerOptions} options\n */\n\nfunction DefaultPointMarker(options) {\n  this._options = options;\n}\n\nDefaultPointMarker.prototype.init = function(group) {\n  var handleWidth  = 10;\n  var handleHeight = 20;\n  var handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  // Label\n\n  if (this._options.view === 'zoomview') {\n    // Label - create with default y, the real value is set in fitToView().\n    this._label = new Text({\n      x:          2,\n      y:          0,\n      text:       this._options.point.labelText,\n      textAlign:  'left',\n      fontFamily: this._options.fontFamily || 'sans-serif',\n      fontSize:   this._options.fontSize || 10,\n      fontStyle:  this._options.fontStyle || 'normal',\n      fill:       '#000'\n    });\n  }\n\n  // Handle - create with default y, the real value is set in fitToView().\n\n  if (this._options.draggable) {\n    this._handle = new Rect({\n      x:      handleX,\n      y:      0,\n      width:  handleWidth,\n      height: handleHeight,\n      fill:   this._options.color\n    });\n  }\n\n  // Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  // Time label\n\n  if (this._handle) {\n    // Time - create with default y, the real value is set in fitToView().\n    this._time = new Text({\n      x:          -24,\n      y:          0,\n      text:       this._options.layer.formatTime(this._options.point.time),\n      fontFamily: this._options.fontFamily,\n      fontSize:   this._options.fontSize,\n      fontStyle:  this._options.fontStyle,\n      fill:       '#000',\n      textAlign:  'center'\n    });\n\n    this._time.hide();\n  }\n\n  if (this._handle) {\n    group.add(this._handle);\n  }\n\n  group.add(this._line);\n\n  if (this._label) {\n    group.add(this._label);\n  }\n\n  if (this._time) {\n    group.add(this._time);\n  }\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultPointMarker.prototype.bindEventHandlers = function(group) {\n  var self = this;\n\n  if (self._handle) {\n    self._handle.on('mouseover touchstart', function() {\n      // Position text to the left of the marker\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    });\n\n    self._handle.on('mouseout touchend', function() {\n      self._time.hide();\n    });\n\n    group.on('dragstart', function() {\n      self._time.setX(-24 - self._time.getWidth());\n      self._time.show();\n    });\n\n    group.on('dragend', function() {\n      self._time.hide();\n    });\n  }\n};\n\nDefaultPointMarker.prototype.fitToView = function() {\n  var height = this._options.layer.getHeight();\n\n  this._line.points([0.5, 0, 0.5, height]);\n\n  if (this._label) {\n    this._label.y(12);\n  }\n\n  if (this._handle) {\n    this._handle.y(height / 2 - 10.5);\n  }\n\n  if (this._time) {\n    this._time.y(height / 2 - 5);\n  }\n};\n\nDefaultPointMarker.prototype.timeUpdated = function(time) {\n  if (this._time) {\n    this._time.setText(this._options.layer.formatTime(time));\n  }\n};\n\nexport default DefaultPointMarker;\n","/**\n * @file\n *\n * Defines the {@link DefaultSegmentMarker} class.\n *\n * @module default-segment-marker\n */\n\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Rect } from 'konva/lib/shapes/Rect';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a segment marker handle.\n *\n * @class\n * @alias DefaultSegmentMarker\n *\n * @param {CreateSegmentMarkerOptions} options\n */\n\nfunction DefaultSegmentMarker(options) {\n  this._options = options;\n}\n\nDefaultSegmentMarker.prototype.init = function(group) {\n  var handleWidth  = 10;\n  var handleHeight = 20;\n  var handleX      = -(handleWidth / 2) + 0.5; // Place in the middle of the marker\n\n  var xPosition = this._options.startMarker ? -24 : 24;\n\n  var time = this._options.startMarker ? this._options.segment.startTime :\n                                         this._options.segment.endTime;\n\n  // Label - create with default y, the real value is set in fitToView().\n  this._label = new Text({\n    x:          xPosition,\n    y:          0,\n    text:       this._options.layer.formatTime(time),\n    fontFamily: this._options.fontFamily,\n    fontSize:   this._options.fontSize,\n    fontStyle:  this._options.fontStyle,\n    fill:       '#000',\n    textAlign:  'center'\n  });\n\n  this._label.hide();\n\n  // Handle - create with default y, the real value is set in fitToView().\n  this._handle = new Rect({\n    x:           handleX,\n    y:           0,\n    width:       handleWidth,\n    height:      handleHeight,\n    fill:        this._options.color,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  // Vertical Line - create with default y and points, the real values\n  // are set in fitToView().\n  this._line = new Line({\n    x:           0,\n    y:           0,\n    stroke:      this._options.color,\n    strokeWidth: 1\n  });\n\n  group.add(this._label);\n  group.add(this._line);\n  group.add(this._handle);\n\n  this.fitToView();\n\n  this.bindEventHandlers(group);\n};\n\nDefaultSegmentMarker.prototype.bindEventHandlers = function(group) {\n  var self = this;\n\n  var xPosition = self._options.startMarker ? -24 : 24;\n\n  if (self._options.draggable) {\n    group.on('dragstart', function() {\n      if (self._options.startMarker) {\n        self._label.setX(xPosition - self._label.getWidth());\n      }\n\n      self._label.show();\n    });\n\n    group.on('dragend', function() {\n      self._label.hide();\n    });\n  }\n\n  self._handle.on('mouseover touchstart', function() {\n    if (self._options.startMarker) {\n      self._label.setX(xPosition - self._label.getWidth());\n    }\n\n    self._label.show();\n  });\n\n  self._handle.on('mouseout touchend', function() {\n    self._label.hide();\n  });\n};\n\nDefaultSegmentMarker.prototype.fitToView = function() {\n  var height = this._options.layer.getHeight();\n\n  this._label.y(height / 2 - 5);\n  this._handle.y(height / 2 - 10.5);\n  this._line.points([0.5, 0, 0.5, height]);\n};\n\nDefaultSegmentMarker.prototype.timeUpdated = function(time) {\n  this._label.setText(this._options.layer.formatTime(time));\n};\n\nexport default DefaultSegmentMarker;\n","/**\n * @file\n *\n * Factory functions for creating point and segment marker handles.\n *\n * @module marker-factories\n */\n\nimport DefaultPointMarker from './default-point-marker';\nimport DefaultSegmentMarker from './default-segment-marker';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Parameters for the {@link createSegmentMarker} function.\n *\n * @typedef {Object} CreateSegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker\n * @property {String} color\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n * @property {Layer} layer\n * @property {String} view\n */\n\n/**\n * Creates a left or right side segment marker handle.\n *\n * @param {CreateSegmentMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createSegmentMarker(options) {\n  if (options.view === 'zoomview') {\n    return new DefaultSegmentMarker(options);\n  }\n\n  return null;\n}\n\n/**\n * Parameters for the {@link createSegmentLabel} function.\n *\n * @typedef {Object} SegmentLabelOptions\n * @global\n * @property {Segment} segment The {@link Segment} object associated with this\n *   label.\n * @property {String} view The name of the view that the label is being\n *   created in, either <code>zoomview</code> or <code>overview</code>.\n * @property {SegmentsLayer} layer\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a Konva object that renders information about a segment, such as\n * its label text.\n *\n * @param {SegmentLabelOptions} options\n * @returns {Konva.Text}\n */\n\nexport function createSegmentLabel(options) {\n  return new Text({\n    x:          12,\n    y:          12,\n    text:       options.segment.labelText,\n    textAlign:  'center',\n    fontFamily: options.fontFamily || 'sans-serif',\n    fontSize:   options.fontSize || 12,\n    fontStyle:  options.fontStyle || 'normal',\n    fill:       '#000'\n  });\n}\n\n/**\n * Parameters for the {@link createPointMarker} function.\n *\n * @typedef {Object} CreatePointMarkerOptions\n * @global\n * @property {Point} point\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {String} color\n * @property {Layer} layer\n * @property {String} view\n * @property {String} fontFamily\n * @property {Number} fontSize\n * @property {String} fontStyle\n */\n\n/**\n * Creates a point marker handle.\n *\n * @param {CreatePointMarkerOptions} options\n * @returns {Marker}\n */\n\nexport function createPointMarker(options) {\n  return new DefaultPointMarker(options);\n}\n","/**\n * @file\n *\n * Defines the {@link HighlightLayer} class.\n *\n * @module highlight-layer\n */\n\nimport { clamp } from  './utils';\nimport Konva from 'konva/lib/Core';\nimport { Rect } from 'konva/lib/shapes/Rect';\n\n/**\n * Creates the highlight region that shows the position of the zoomable\n * waveform view in the overview waveform.\n *\n * @class\n * @alias HighlightLayer\n *\n * @param {WaveformOverview} view\n * @param {Number} offset\n * @param {String} color\n */\n\nfunction HighlightLayer(view, offset, color) {\n  this._view          = view;\n  this._offset        = offset;\n  this._color         = color;\n  this._layer         = new Konva.Layer({ listening: false });\n  this._highlightRect = null;\n  this._startTime     = null;\n  this._endTime       = null;\n}\n\nHighlightLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nHighlightLayer.prototype.showHighlight = function(startTime, endTime) {\n  if (!this._highlightRect) {\n    this._createHighlightRect(startTime, endTime);\n  }\n\n  this._update(startTime, endTime);\n};\n\n/**\n * Updates the position of the highlight region.\n *\n * @param {Number} startTime The start of the highlight region, in seconds.\n * @param {Number} endTime The end of the highlight region, in seconds.\n */\n\nHighlightLayer.prototype._update = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime = endTime;\n\n  var startOffset = this._view.timeToPixels(startTime);\n  var endOffset   = this._view.timeToPixels(endTime);\n\n  this._highlightRect.setAttrs({\n    x:     startOffset,\n    width: endOffset - startOffset\n  });\n};\n\nHighlightLayer.prototype._createHighlightRect = function(startTime, endTime) {\n  this._startTime = startTime;\n  this._endTime   = endTime;\n\n  var startOffset = this._view.timeToPixels(startTime);\n  var endOffset   = this._view.timeToPixels(endTime);\n\n  // Create with default y and height, the real values are set in fitToView().\n  this._highlightRect = new Rect({\n    startOffset:  0,\n    y:            0,\n    width:        endOffset - startOffset,\n    stroke:       this._color,\n    strokeWidth:  1,\n    height:       0,\n    fill:         this._color,\n    opacity:      0.3,\n    cornerRadius: 2\n  });\n\n  this.fitToView();\n\n  this._layer.add(this._highlightRect);\n};\n\nHighlightLayer.prototype.removeHighlight = function() {\n  if (this._highlightRect) {\n    this._highlightRect.destroy();\n    this._highlightRect = null;\n  }\n};\n\nHighlightLayer.prototype.updateHighlight = function() {\n  if (this._highlightRect) {\n    this._update(this._startTime, this._endTime);\n  }\n};\n\nHighlightLayer.prototype.fitToView = function() {\n  if (this._highlightRect) {\n    var height = this._view.getHeight();\n    var offset = clamp(this._offset, 0, Math.floor(height / 2));\n\n    this._highlightRect.setAttrs({\n      y: offset,\n      height: height - (offset * 2)\n    });\n  }\n};\n\nexport default HighlightLayer;\n","/**\n * @file\n *\n * Defines the {@link MouseDragHandler} class.\n *\n * @module mouse-drag-handler\n */\n\nimport Konva from 'konva/lib/Core';\n\nfunction getMarkerObject(obj) {\n  while (obj.parent !== null) {\n    if (obj.parent instanceof Konva.Layer) {\n      return obj;\n    }\n\n    obj = obj.parent;\n  }\n\n  return null;\n}\n\n/**\n * An object to receive callbacks on mouse drag events. Each function is\n * called with the current mouse X position, relative to the stage's\n * container HTML element.\n *\n * @typedef {Object} MouseDragHandlers\n * @global\n * @property {Function} onMouseDown Mouse down event handler.\n * @property {Function} onMouseMove Mouse move event handler.\n * @property {Function} onMouseUp Mouse up event handler.\n */\n\n/**\n * Creates a handler for mouse events to allow interaction with the waveform\n * views by clicking and dragging the mouse.\n *\n * @class\n * @alias MouseDragHandler\n *\n * @param {Konva.Stage} stage\n * @param {MouseDragHandlers} handlers\n */\n\nfunction MouseDragHandler(stage, handlers) {\n  this._stage     = stage;\n  this._handlers  = handlers;\n  this._dragging  = false;\n  this._mouseDown = this._mouseDown.bind(this);\n  this._mouseUp   = this._mouseUp.bind(this);\n  this._mouseMove = this._mouseMove.bind(this);\n\n  this._stage.on('mousedown', this._mouseDown);\n  this._stage.on('touchstart', this._mouseDown);\n\n  this._lastMouseClientX = null;\n}\n\n/**\n * Mouse down event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseDown = function(event) {\n  var marker = getMarkerObject(event.target);\n\n  // Avoid interfering with drag/drop of point and segment markers.\n  if (marker && marker.attrs.draggable) {\n    return;\n  }\n\n  this._lastMouseClientX = Math.floor(\n    event.type === 'touchstart' ? event.evt.touches[0].clientX : event.evt.clientX\n  );\n\n  if (this._handlers.onMouseDown) {\n    var mouseDownPosX = this._getMousePosX(this._lastMouseClientX);\n\n    this._handlers.onMouseDown(mouseDownPosX);\n  }\n\n  // Use the window mousemove and mouseup handlers instead of the\n  // Konva.Stage ones so that we still receive events if the user moves the\n  // mouse outside the stage.\n  window.addEventListener('mousemove', this._mouseMove, false);\n  window.addEventListener('touchmove', this._mouseMove, false);\n  window.addEventListener('mouseup', this._mouseUp, false);\n  window.addEventListener('touchend', this._mouseUp, false);\n  window.addEventListener('blur', this._mouseUp, false);\n};\n\n/**\n * Mouse move event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseMove = function(event) {\n  var clientX = Math.floor(\n    event.type === 'touchmove' ? event.changedTouches[0].clientX : event.clientX\n  );\n\n  // Don't update on vertical mouse movement.\n  if (clientX === this._lastMouseClientX) {\n    return;\n  }\n\n  this._lastMouseClientX = clientX;\n\n  this._dragging = true;\n\n  if (this._handlers.onMouseMove) {\n    var mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseMove(mousePosX);\n  }\n};\n\n/**\n * Mouse up event handler.\n *\n * @param {MouseEvent} event\n */\n\nMouseDragHandler.prototype._mouseUp = function(event) {\n  var clientX;\n\n  if (event.type === 'touchend') {\n    clientX = Math.floor(event.changedTouches[0].clientX);\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  else {\n    clientX = Math.floor(event.clientX);\n  }\n\n  if (this._handlers.onMouseUp) {\n    var mousePosX = this._getMousePosX(clientX);\n\n    this._handlers.onMouseUp(mousePosX);\n  }\n\n  window.removeEventListener('mousemove', this._mouseMove, false);\n  window.removeEventListener('touchmove', this._mouseMove, false);\n  window.removeEventListener('mouseup', this._mouseUp, false);\n  window.removeEventListener('touchend', this._mouseUp, false);\n  window.removeEventListener('blur', this._mouseUp, false);\n\n  this._dragging = false;\n};\n\n/**\n * @returns {Number} The mouse X position, relative to the container that\n * received the mouse down event.\n *\n * @private\n * @param {Number} clientX Mouse client X position.\n */\n\nMouseDragHandler.prototype._getMousePosX = function(clientX) {\n  var containerPos = this._stage.getContainer().getBoundingClientRect();\n\n  return clientX - containerPos.left;\n};\n\n/**\n * Returns <code>true</code> if the mouse is being dragged, i.e., moved with\n * the mouse button held down.\n *\n * @returns {Boolean}\n */\n\nMouseDragHandler.prototype.isDragging = function() {\n  return this._dragging;\n};\n\nexport default MouseDragHandler;\n","/**\n * @file\n *\n * Defines the {@link PlayheadLayer} class.\n *\n * @module playhead-layer\n */\n\nimport Konva from 'konva/lib/Core';\nimport { Animation } from 'konva/lib/Animation';\nimport { Line } from 'konva/lib/shapes/Line';\nimport { Text } from 'konva/lib/shapes/Text';\n\n/**\n * Creates a Konva.Layer that displays a playhead marker.\n *\n * @class\n * @alias PlayheadLayer\n *\n * @param {Object} options\n * @param {Player} options.player\n * @param {WaveformOverview|WaveformZoomView} options.view\n * @param {Boolean} options.showPlayheadTime If <code>true</code> The playback time position\n *   is shown next to the playhead.\n * @param {String} options.playheadColor\n * @param {String} options.playheadTextColor\n * @param {String} options.playheadFontFamily\n * @param {Number} options.playheadFontSize\n * @param {String} options.playheadFontStyle\n */\n\nfunction PlayheadLayer(options) {\n  this._player = options.player;\n  this._view = options.view;\n  this._playheadPixel = 0;\n  this._playheadLineAnimation = null;\n  this._playheadVisible = false;\n  this._playheadColor = options.playheadColor;\n  this._playheadTextColor = options.playheadTextColor;\n\n  this._playheadFontFamily = options.playheadFontFamily;\n  this._playheadFontSize = options.playheadFontSize;\n  this._playheadFontStyle = options.playheadFontStyle;\n\n  this._playheadLayer = new Konva.Layer();\n\n  this._createPlayhead(this._playheadColor);\n\n  if (options.showPlayheadTime) {\n    this._createPlayheadText(this._playheadTextColor);\n  }\n\n  this.fitToView();\n\n  this.zoomLevelChanged();\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPlayheadLayer.prototype.addToStage = function(stage) {\n  stage.add(this._playheadLayer);\n};\n\n/**\n * Decides whether to use an animation to update the playhead position.\n *\n * If the zoom level is such that the number of pixels per second of audio is\n * low, we can use timeupdate events from the HTMLMediaElement to\n * set the playhead position. Otherwise, we use an animation to update the\n * playhead position more smoothly. The animation is CPU intensive, so we\n * avoid using it where possible.\n */\n\nPlayheadLayer.prototype.zoomLevelChanged = function() {\n  var pixelsPerSecond = this._view.timeToPixels(1.0);\n  var time;\n\n  this._useAnimation = pixelsPerSecond >= 5;\n\n  if (this._useAnimation) {\n    if (this._player.isPlaying() && !this._playheadLineAnimation) {\n      // Start the animation\n      this._start();\n    }\n  }\n  else {\n    if (this._playheadLineAnimation) {\n      // Stop the animation\n      time = this._player.getCurrentTime();\n\n      this.stop(time);\n    }\n  }\n};\n\n/**\n * Resizes the playhead UI objects to fit the available space in the\n * view.\n */\n\nPlayheadLayer.prototype.fitToView = function() {\n  var height = this._view.getHeight();\n\n  this._playheadLine.points([0.5, 0, 0.5, height]);\n\n  if (this._playheadText) {\n    this._playheadText.y(12);\n  }\n};\n\n/**\n * Creates the playhead UI objects.\n *\n * @private\n * @param {String} color\n */\n\nPlayheadLayer.prototype._createPlayhead = function(color) {\n  // Create with default points, the real values are set in fitToView().\n  this._playheadLine = new Line({\n    stroke:      color,\n    strokeWidth: 1\n  });\n\n  this._playheadGroup = new Konva.Group({\n    x: 0,\n    y: 0\n  });\n\n  this._playheadGroup.add(this._playheadLine);\n  this._playheadLayer.add(this._playheadGroup);\n};\n\nPlayheadLayer.prototype._createPlayheadText = function(color) {\n  var time = this._player.getCurrentTime();\n  var text = this._view.formatTime(time);\n\n  // Create with default y, the real value is set in fitToView().\n  this._playheadText = new Text({\n    x: 2,\n    y: 0,\n    text: text,\n    fontSize: this._playheadFontSize,\n    fontFamily: this._playheadFontFamily,\n    fontStyle: this._playheadFontStyle,\n    fill: color,\n    align: 'right'\n  });\n\n  this._playheadGroup.add(this._playheadText);\n};\n\n/**\n * Updates the playhead position.\n *\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype.updatePlayheadTime = function(time) {\n  this._syncPlayhead(time);\n\n  if (this._player.isPlaying()) {\n    this._start();\n  }\n};\n\n/**\n * Updates the playhead position.\n *\n * @private\n * @param {Number} time Current playhead position, in seconds.\n */\n\nPlayheadLayer.prototype._syncPlayhead = function(time) {\n  var pixelIndex = this._view.timeToPixels(time);\n\n  var frameOffset = this._view.getFrameOffset();\n  var width = this._view.getWidth();\n\n  var isVisible = (pixelIndex >= frameOffset) &&\n                  (pixelIndex <= frameOffset + width);\n\n  this._playheadPixel = pixelIndex;\n\n  if (isVisible) {\n    var playheadX = this._playheadPixel - frameOffset;\n\n    if (!this._playheadVisible) {\n      this._playheadVisible = true;\n      this._playheadGroup.show();\n    }\n\n    this._playheadGroup.setX(playheadX);\n\n    if (this._playheadText) {\n      var text = this._view.formatTime(time);\n      var playheadTextWidth = this._playheadText.getTextWidth();\n\n      this._playheadText.setText(text);\n\n      if (playheadTextWidth + playheadX > width - 2) {\n        this._playheadText.setX(-playheadTextWidth - 2);\n      }\n      else if (playheadTextWidth + playheadX < width) {\n        this._playheadText.setX(2);\n      }\n    }\n  }\n  else {\n    if (this._playheadVisible) {\n      this._playheadVisible = false;\n      this._playheadGroup.hide();\n    }\n  }\n\n  if (this._view.playheadPosChanged) {\n    this._view.playheadPosChanged(time);\n  }\n};\n\n/**\n * Starts a playhead animation in sync with the media playback.\n *\n * @private\n */\n\nPlayheadLayer.prototype._start = function() {\n  var self = this;\n\n  if (self._playheadLineAnimation) {\n    self._playheadLineAnimation.stop();\n    self._playheadLineAnimation = null;\n  }\n\n  if (!self._useAnimation) {\n    return;\n  }\n\n  var lastPlayheadPosition = null;\n\n  self._playheadLineAnimation = new Animation(function() {\n    var time = self._player.getCurrentTime();\n    var playheadPosition = self._view.timeToPixels(time);\n\n    if (playheadPosition !== lastPlayheadPosition) {\n      self._syncPlayhead(time);\n      lastPlayheadPosition = playheadPosition;\n    }\n  }, self._playheadLayer);\n\n  self._playheadLineAnimation.start();\n};\n\nPlayheadLayer.prototype.stop = function(time) {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n\n  this._syncPlayhead(time);\n};\n\n/**\n * Returns the position of the playhead marker, in pixels relative to the\n * left hand side of the waveform view.\n *\n * @return {Number}\n */\n\nPlayheadLayer.prototype.getPlayheadOffset = function() {\n  return this._playheadPixel - this._view.getFrameOffset();\n};\n\nPlayheadLayer.prototype.getPlayheadPixel = function() {\n  return this._playheadPixel;\n};\n\nPlayheadLayer.prototype.showPlayheadTime = function(show) {\n  if (show) {\n    if (!this._playheadText) {\n      // Create it\n      this._createPlayheadText(this._playheadTextColor);\n      this.fitToView();\n    }\n  }\n  else {\n    if (this._playheadText) {\n      this._playheadText.remove();\n      this._playheadText.destroy();\n      this._playheadText = null;\n    }\n  }\n};\n\nPlayheadLayer.prototype.updatePlayheadText = function() {\n  if (this._playheadText) {\n    var time = this._player.getCurrentTime();\n    var text = this._view.formatTime(time);\n\n    this._playheadText.setText(text);\n  }\n};\n\nPlayheadLayer.prototype.destroy = function() {\n  if (this._playheadLineAnimation) {\n    this._playheadLineAnimation.stop();\n    this._playheadLineAnimation = null;\n  }\n};\n\nexport default PlayheadLayer;\n","/**\n * @file\n *\n * Defines the {@link PointMarker} class.\n *\n * @module point-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link PointMarker} constructor.\n *\n * @typedef {Object} PointMarkerOptions\n * @global\n * @property {Point} point Point object with timestamp.\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Marker} marker\n * @property {Function} onDblClick\n * @property {Function} onDragStart\n * @property {Function} onDragMove Callback during mouse drag operations.\n * @property {Function} onDragEnd\n * @property {Function} onMouseEnter\n * @property {Function} onMouseLeave\n */\n\n/**\n * Creates a point marker handle.\n *\n * @class\n * @alias PointMarker\n *\n * @param {PointMarkerOptions} options\n */\n\nfunction PointMarker(options) {\n  this._point     = options.point;\n  this._marker    = options.marker;\n  this._draggable = options.draggable;\n\n  this._onClick      = options.onClick;\n  this._onDblClick   = options.onDblClick;\n  this._onDragStart  = options.onDragStart;\n  this._onDragMove   = options.onDragMove;\n  this._onDragEnd    = options.onDragEnd;\n  this._onMouseEnter = options.onMouseEnter;\n  this._onMouseLeave = options.onMouseLeave;\n\n  this._dragBoundFunc = this._dragBoundFunc.bind(this);\n\n  this._group = new Konva.Group({\n    draggable:     this._draggable,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  this._bindDefaultEventHandlers();\n\n  this._marker.init(this._group);\n}\n\nPointMarker.prototype._bindDefaultEventHandlers = function() {\n  var self = this;\n\n  self._group.on('dragstart', function() {\n    self._onDragStart(self._point);\n  });\n\n  self._group.on('dragmove', function() {\n    self._onDragMove(self._point);\n  });\n\n  self._group.on('dragend', function() {\n    self._onDragEnd(self._point);\n  });\n\n  self._group.on('click', function() {\n    self._onClick(self._point);\n  });\n\n  self._group.on('dblclick', function() {\n    self._onDblClick(self._point);\n  });\n\n  self._group.on('mouseenter', function() {\n    self._onMouseEnter(self._point);\n  });\n\n  self._group.on('mouseleave', function() {\n    self._onMouseLeave(self._point);\n  });\n};\n\nPointMarker.prototype._dragBoundFunc = function(pos) {\n  // Allow the marker to be moved horizontally but not vertically.\n  return {\n    x: pos.x,\n    y: this._group.getAbsolutePosition().y\n  };\n};\n\n/**\n * @param {Konva.Layer} layer\n */\n\nPointMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nPointMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nPointMarker.prototype.getPoint = function() {\n  return this._point;\n};\n\nPointMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nPointMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nPointMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nPointMarker.prototype.timeUpdated = function(time) {\n  if (this._marker.timeUpdated) {\n    this._marker.timeUpdated(time);\n  }\n};\n\nPointMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nexport default PointMarker;\n","/**\n * @file\n *\n * Defines the {@link PointsLayer} class.\n *\n * @module points-layer\n */\n\nimport PointMarker from './point-marker';\nimport { objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\nvar defaultFontFamily = 'sans-serif';\nvar defaultFontSize = 10;\nvar defaultFontShape = 'normal';\n\n/**\n * Creates a Konva.Layer that displays point markers against the audio\n * waveform.\n *\n * @class\n * @alias PointsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction PointsLayer(peaks, view, allowEditing) {\n  this._peaks        = peaks;\n  this._view         = view;\n  this._allowEditing = allowEditing;\n  this._pointMarkers = {};\n  this._layer        = new Konva.Layer();\n\n  this._onPointsDrag = this._onPointsDrag.bind(this);\n\n  this._onPointHandleClick      = this._onPointHandleClick.bind(this);\n  this._onPointHandleDblClick   = this._onPointHandleDblClick.bind(this);\n  this._onPointHandleDragStart  = this._onPointHandleDragStart.bind(this);\n  this._onPointHandleDragMove   = this._onPointHandleDragMove.bind(this);\n  this._onPointHandleDragEnd    = this._onPointHandleDragEnd.bind(this);\n  this._onPointHandleMouseEnter = this._onPointHandleMouseEnter.bind(this);\n  this._onPointHandleMouseLeave = this._onPointHandleMouseLeave.bind(this);\n\n  this._onPointsUpdate    = this._onPointsUpdate.bind(this);\n  this._onPointsAdd       = this._onPointsAdd.bind(this);\n  this._onPointsRemove    = this._onPointsRemove.bind(this);\n  this._onPointsRemoveAll = this._onPointsRemoveAll.bind(this);\n\n  this._peaks.on('points.update', this._onPointsUpdate);\n  this._peaks.on('points.add', this._onPointsAdd);\n  this._peaks.on('points.remove', this._onPointsRemove);\n  this._peaks.on('points.remove_all', this._onPointsRemoveAll);\n\n  this._peaks.on('points.dragstart', this._onPointsDrag);\n  this._peaks.on('points.dragmove', this._onPointsDrag);\n  this._peaks.on('points.dragend', this._onPointsDrag);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nPointsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nPointsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nPointsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nPointsLayer.prototype._onPointsUpdate = function(point) {\n  var frameStartTime = this._view.getStartTime();\n  var frameEndTime   = this._view.getEndTime();\n\n  this._removePoint(point);\n\n  if (point.isVisible(frameStartTime, frameEndTime)) {\n    this._addPointMarker(point);\n  }\n\n  this.updatePoints(frameStartTime, frameEndTime);\n};\n\nPointsLayer.prototype._onPointsAdd = function(points) {\n  var self = this;\n\n  var frameStartTime = self._view.getStartTime();\n  var frameEndTime   = self._view.getEndTime();\n\n  points.forEach(function(point) {\n    if (point.isVisible(frameStartTime, frameEndTime)) {\n      self._addPointMarker(point);\n    }\n  });\n\n  self.updatePoints(frameStartTime, frameEndTime);\n};\n\nPointsLayer.prototype._onPointsRemove = function(points) {\n  var self = this;\n\n  points.forEach(function(point) {\n    self._removePoint(point);\n  });\n};\n\nPointsLayer.prototype._onPointsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._pointMarkers = {};\n};\n\nPointsLayer.prototype._onPointsDrag = function(point) {\n  this._updatePoint(point);\n};\n\n/**\n * Creates the Konva UI objects for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._createPointMarker = function(point) {\n  var editable = this._allowEditing && point.editable;\n\n  var marker = this._peaks.options.createPointMarker({\n    point:      point,\n    draggable:  editable,\n    color:      point.color ? point.color : this._peaks.options.pointMarkerColor,\n    fontFamily: this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:   this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:  this._peaks.options.fontStyle || defaultFontShape,\n    layer:      this,\n    view:       this._view.getName()\n  });\n\n  return new PointMarker({\n    point:        point,\n    draggable:    editable,\n    marker:       marker,\n    onClick:      this._onPointHandleClick,\n    onDblClick:   this._onPointHandleDblClick,\n    onDragStart:  this._onPointHandleDragStart,\n    onDragMove:   this._onPointHandleDragMove,\n    onDragEnd:    this._onPointHandleDragEnd,\n    onMouseEnter: this._onPointHandleMouseEnter,\n    onMouseLeave: this._onPointHandleMouseLeave\n  });\n};\n\nPointsLayer.prototype.getHeight = function() {\n  return this._view.getHeight();\n};\n\n/**\n * Adds a Konva UI object to the layer for a given point.\n *\n * @private\n * @param {Point} point\n * @returns {PointMarker}\n */\n\nPointsLayer.prototype._addPointMarker = function(point) {\n  var pointMarker = this._createPointMarker(point);\n\n  this._pointMarkers[point.id] = pointMarker;\n\n  pointMarker.addToLayer(this._layer);\n\n  return pointMarker;\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDragMove = function(point) {\n  var pointMarker = this._pointMarkers[point.id];\n\n  var markerX = pointMarker.getX();\n\n  if (markerX >= 0 && markerX < this._view.getWidth()) {\n    var offset = markerX + pointMarker.getWidth();\n\n    point._setTime(this._view.pixelOffsetToTime(offset));\n\n    pointMarker.timeUpdated(point.time);\n  }\n\n  this._peaks.emit('points.dragmove', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleMouseEnter = function(point) {\n  this._peaks.emit('points.mouseenter', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleMouseLeave = function(point) {\n  this._peaks.emit('points.mouseleave', point);\n};\n\nPointsLayer.prototype._onPointHandleClick = function(point) {\n  this._peaks.emit('points.click', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDblClick = function(point) {\n  this._peaks.emit('points.dblclick', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDragStart = function(point) {\n  this._peaks.emit('points.dragstart', point);\n};\n\n/**\n * @param {Point} point\n */\n\nPointsLayer.prototype._onPointHandleDragEnd = function(point) {\n  this._peaks.emit('points.dragend', point);\n};\n\n/**\n * Updates the positions of all displayed points in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nPointsLayer.prototype.updatePoints = function(startTime, endTime) {\n  // Update all points in the visible time range.\n  var points = this._peaks.points.find(startTime, endTime);\n\n  points.forEach(this._updatePoint.bind(this));\n\n  // TODO: in the overview all points are visible, so no need to check\n  this._removeInvisiblePoints(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._updatePoint = function(point) {\n  var pointMarker = this._findOrAddPointMarker(point);\n\n  var pointMarkerOffset = this._view.timeToPixels(point.time);\n\n  var pointMarkerX = pointMarkerOffset - this._view.getFrameOffset();\n\n  pointMarker.setX(pointMarkerX);\n};\n\n/**\n * @private\n * @param {Point} point\n * @return {PointMarker}\n */\n\nPointsLayer.prototype._findOrAddPointMarker = function(point) {\n  var pointMarker = this._pointMarkers[point.id];\n\n  if (!pointMarker) {\n    pointMarker = this._addPointMarker(point);\n  }\n\n  return pointMarker;\n};\n\n/**\n * Remove any points that are not visible, i.e., are outside the given time\n * range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n * @returns {Number} The number of points removed.\n */\n\nPointsLayer.prototype._removeInvisiblePoints = function(startTime, endTime) {\n  var count = 0;\n\n  for (var pointId in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointId)) {\n      var point = this._pointMarkers[pointId].getPoint();\n\n      if (!point.isVisible(startTime, endTime)) {\n        this._removePoint(point);\n        count++;\n      }\n    }\n  }\n\n  return count;\n};\n\n/**\n * Removes the UI object for a given point.\n *\n * @private\n * @param {Point} point\n */\n\nPointsLayer.prototype._removePoint = function(point) {\n  var pointMarker = this._pointMarkers[point.id];\n\n  if (pointMarker) {\n    pointMarker.destroy();\n    delete this._pointMarkers[point.id];\n  }\n};\n\n/**\n * Toggles visibility of the points layer.\n *\n * @param {Boolean} visible\n */\n\nPointsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nPointsLayer.prototype.destroy = function() {\n  this._peaks.off('points.update', this._onPointsUpdate);\n  this._peaks.off('points.add', this._onPointsAdd);\n  this._peaks.off('points.remove', this._onPointsRemove);\n  this._peaks.off('points.remove_all', this._onPointsRemoveAll);\n  this._peaks.off('points.dragstart', this._onPointsDrag);\n  this._peaks.off('points.dragmove', this._onPointsDrag);\n  this._peaks.off('points.dragend', this._onPointsDrag);\n};\n\nPointsLayer.prototype.fitToView = function() {\n  for (var pointId in this._pointMarkers) {\n    if (objectHasProperty(this._pointMarkers, pointId)) {\n      var pointMarker = this._pointMarkers[pointId];\n\n      pointMarker.fitToView();\n    }\n  }\n};\n\nPointsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nexport default PointsLayer;\n","/**\n * @file\n *\n * Defines the {@link SegmentMarker} class.\n *\n * @module segment-marker\n */\n\nimport Konva from 'konva/lib/Core';\n\n/**\n * Parameters for the {@link SegmentMarker} constructor.\n *\n * @typedef {Object} SegmentMarkerOptions\n * @global\n * @property {Segment} segment\n * @property {SegmentShape} segmentShape\n * @property {Boolean} draggable If true, marker is draggable.\n * @property {Boolean} startMarker If <code>true</code>, the marker indicates\n *   the start time of the segment. If <code>false</code>, the marker\n *   indicates the end time of the segment.\n * @property {Function} onDrag\n * @property {Function} onDragStart\n * @property {Function} onDragEnd\n */\n\n/**\n * Creates a Left or Right side segment handle marker.\n *\n * @class\n * @alias SegmentMarker\n *\n * @param {SegmentMarkerOptions} options\n */\n\nfunction SegmentMarker(options) {\n  this._segment       = options.segment;\n  this._marker        = options.marker;\n  this._segmentShape  = options.segmentShape;\n  this._draggable     = options.draggable;\n  this._layer         = options.layer;\n  this._startMarker   = options.startMarker;\n\n  this._onDrag      = options.onDrag;\n  this._onDragStart = options.onDragStart;\n  this._onDragEnd   = options.onDragEnd;\n\n  this._dragBoundFunc = this._dragBoundFunc.bind(this);\n\n  this._group = new Konva.Group({\n    draggable:     this._draggable,\n    dragBoundFunc: this._dragBoundFunc\n  });\n\n  this._bindDefaultEventHandlers();\n\n  this._marker.init(this._group);\n}\n\nSegmentMarker.prototype._bindDefaultEventHandlers = function() {\n  var self = this;\n\n  if (self._draggable) {\n    self._group.on('dragmove', function() {\n      self._onDrag(self);\n    });\n\n    self._group.on('dragstart', function() {\n      self._onDragStart(self);\n    });\n\n    self._group.on('dragend', function() {\n      self._onDragEnd(self);\n    });\n  }\n};\n\nSegmentMarker.prototype._dragBoundFunc = function(pos) {\n  var marker;\n  var limit;\n\n  if (this._startMarker) {\n    marker = this._segmentShape.getEndMarker();\n    limit  = marker.getX() - marker.getWidth();\n\n    if (pos.x > limit) {\n      pos.x = limit;\n    }\n  }\n  else {\n    marker = this._segmentShape.getStartMarker();\n    limit  = marker.getX() + marker.getWidth();\n\n    if (pos.x < limit) {\n      pos.x = limit;\n    }\n  }\n\n  return {\n    x: pos.x,\n    y: this._group.getAbsolutePosition().y\n  };\n};\n\nSegmentMarker.prototype.addToLayer = function(layer) {\n  layer.add(this._group);\n};\n\nSegmentMarker.prototype.fitToView = function() {\n  this._marker.fitToView();\n};\n\nSegmentMarker.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentMarker.prototype.getX = function() {\n  return this._group.getX();\n};\n\nSegmentMarker.prototype.getWidth = function() {\n  return this._group.getWidth();\n};\n\nSegmentMarker.prototype.isStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentMarker.prototype.setX = function(x) {\n  this._group.setX(x);\n};\n\nSegmentMarker.prototype.timeUpdated = function(time) {\n  if (this._marker.timeUpdated) {\n    this._marker.timeUpdated(time);\n  }\n};\n\nSegmentMarker.prototype.destroy = function() {\n  if (this._marker.destroy) {\n    this._marker.destroy();\n  }\n\n  this._group.destroyChildren();\n  this._group.destroy();\n};\n\nexport default SegmentMarker;\n","/**\n * @file\n *\n * Defines the {@link WaveformShape} class.\n *\n * @module waveform-shape\n */\n\nimport { clamp, isLinearGradientColor, isString } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Waveform shape options.\n *\n * @typedef {Object} WaveformShapeOptions\n * @global\n * @property {String | LinearGradientColor} color Waveform color.\n * @property {WaveformOverview|WaveformZoomView} view The view object\n *   that contains the waveform shape.\n * @property {Segment?} segment If given, render a waveform image\n *   covering the segment's time range. Otherwise, render the entire\n *   waveform duration.\n */\n\n/**\n * Creates a Konva.Shape object that renders a waveform image.\n *\n * @class\n * @alias WaveformShape\n *\n * @param {WaveformShapeOptions} options\n */\n\nfunction WaveformShape(options) {\n  this._color = options.color;\n\n  var shapeOptions = {};\n\n  if (isString(options.color)) {\n    shapeOptions.fill = options.color;\n  }\n  else if (isLinearGradientColor(options.color)) {\n    var startY = options.view._height * (options.color.linearGradientStart / 100);\n    var endY = options.view._height * (options.color.linearGradientEnd / 100);\n\n    shapeOptions.fillLinearGradientStartPointY = startY;\n    shapeOptions.fillLinearGradientEndPointY = endY;\n    shapeOptions.fillLinearGradientColorStops = [\n      0, options.color.linearGradientColorStops[0],\n      1, options.color.linearGradientColorStops[1]\n    ];\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n\n  this._shape = new Konva.Shape(shapeOptions);\n  this._view = options.view;\n  this._segment = options.segment;\n\n  this._shape.sceneFunc(this._sceneFunc.bind(this));\n  this._shape.hitFunc(this._waveformShapeHitFunc.bind(this));\n}\n\n// WaveformShape.prototype = Object.create(Konva.Shape.prototype);\n\nWaveformShape.prototype.setSegment = function(segment) {\n  this._segment = segment;\n};\n\nWaveformShape.prototype.setWaveformColor = function(color) {\n  if (isString(color)) {\n    this._shape.fill(color);\n\n    this._shape.fillLinearGradientStartPointY(null);\n    this._shape.fillLinearGradientEndPointY(null);\n    this._shape.fillLinearGradientColorStops(null);\n  }\n  else if (isLinearGradientColor(color)) {\n    this._shape.fill(null);\n\n    var startY = this._view._height * (color.linearGradientStart / 100);\n    var endY = this._view._height * (color.linearGradientEnd / 100);\n\n    this._shape.fillLinearGradientStartPointY(startY);\n    this._shape.fillLinearGradientEndPointY(endY);\n    this._shape.fillLinearGradientColorStops([\n      0, color.linearGradientColorStops[0],\n      1, color.linearGradientColorStops[1]\n    ]);\n  }\n  else {\n    throw new TypeError('Unknown type for color property');\n  }\n};\n\nWaveformShape.prototype.fitToView = function() {\n  this.setWaveformColor(this._color);\n};\n\nWaveformShape.prototype._sceneFunc = function(context) {\n  var frameOffset = this._view.getFrameOffset();\n  var width = this._view.getWidth();\n  var height = this._view.getHeight();\n\n  this._drawWaveform(\n    context,\n    this._view.getWaveformData(),\n    frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.startTime) : frameOffset,\n    this._segment ? this._view.timeToPixels(this._segment.endTime)   : frameOffset + width,\n    width,\n    height\n  );\n};\n\n/**\n * Draws a waveform on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformData} waveformData The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} width The width of the waveform area, in pixels.\n * @param {Number} height The height of the waveform area, in pixels.\n */\n\nWaveformShape.prototype._drawWaveform = function(context, waveformData,\n    frameOffset, startPixels, endPixels, width, height) {\n  if (startPixels < frameOffset) {\n    startPixels = frameOffset;\n  }\n\n  var limit = frameOffset + width;\n\n  if (endPixels > limit) {\n    endPixels = limit;\n  }\n\n  if (endPixels > waveformData.length - 1) {\n    endPixels = waveformData.length - 1;\n  }\n\n  var channels = waveformData.channels;\n\n  var waveformTop = 0;\n  var waveformHeight = Math.floor(height / channels);\n\n  for (var i = 0; i < channels; i++) {\n    if (i === channels - 1) {\n      waveformHeight = height - (channels - 1) * waveformHeight;\n    }\n\n    this._drawChannel(\n      context,\n      waveformData.channel(i),\n      frameOffset,\n      startPixels,\n      endPixels,\n      waveformTop,\n      waveformHeight\n    );\n\n    waveformTop += waveformHeight;\n  }\n};\n\n/**\n * Draws a single waveform channel on a canvas context.\n *\n * @param {Konva.Context} context The canvas context to draw on.\n * @param {WaveformDataChannel} channel The waveform data to draw.\n * @param {Number} frameOffset The start position of the waveform shown\n *   in the view, in pixels.\n * @param {Number} startPixels The start position of the waveform to draw,\n *   in pixels.\n * @param {Number} endPixels The end position of the waveform to draw,\n *   in pixels.\n * @param {Number} top The top of the waveform channel area, in pixels.\n * @param {Number} height The height of the waveform channel area, in pixels.\n */\n\nWaveformShape.prototype._drawChannel = function(context, channel,\n    frameOffset, startPixels, endPixels, top, height) {\n  var x, amplitude;\n\n  var amplitudeScale = this._view.getAmplitudeScale();\n\n  var lineX, lineY;\n\n  context.beginPath();\n\n  for (x = startPixels; x <= endPixels; x++) {\n    amplitude = channel.min_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 0.5;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  for (x = endPixels; x >= startPixels; x--) {\n    amplitude = channel.max_sample(x);\n\n    lineX = x - frameOffset + 0.5;\n    lineY = top + WaveformShape.scaleY(amplitude, height, amplitudeScale) + 0.5;\n\n    context.lineTo(lineX, lineY);\n  }\n\n  context.closePath();\n\n  context.fillShape(this._shape);\n};\n\nWaveformShape.prototype._waveformShapeHitFunc = function(context) {\n  if (!this._segment) {\n    return;\n  }\n\n  var frameOffset = this._view.getFrameOffset();\n  var viewWidth = this._view.getWidth();\n  var viewHeight = this._view.getHeight();\n\n  var startPixels = this._view.timeToPixels(this._segment.startTime);\n  var endPixels   = this._view.timeToPixels(this._segment.endTime);\n\n  var offsetY = 10;\n  var hitRectHeight = viewHeight - 2 * offsetY;\n\n  if (hitRectHeight < 0) {\n    hitRectHeight = 0;\n  }\n\n  var hitRectLeft = startPixels - frameOffset;\n  var hitRectWidth = endPixels - startPixels;\n\n  if (hitRectLeft < 0) {\n    hitRectWidth -= -hitRectLeft;\n    hitRectLeft = 0;\n  }\n\n  if (hitRectLeft + hitRectWidth > viewWidth) {\n    hitRectWidth -= hitRectLeft + hitRectWidth - viewWidth;\n  }\n\n  context.beginPath();\n  context.rect(hitRectLeft, offsetY, hitRectWidth, hitRectHeight);\n  context.closePath();\n  context.fillStrokeShape(this._shape);\n};\n\nWaveformShape.prototype.addToLayer = function(layer) {\n  layer.add(this._shape);\n};\n\nWaveformShape.prototype.destroy = function() {\n  this._shape.destroy();\n  this._shape = null;\n};\n\nWaveformShape.prototype.on = function(event, handler) {\n  this._shape.on(event, handler);\n};\n\n/**\n * Scales the waveform data for drawing on a canvas context.\n *\n * @see {@link https://stats.stackexchange.com/questions/281162}\n *\n * @todo Assumes 8-bit waveform data (-128 to 127 range)\n *\n * @param {Number} amplitude The waveform data point amplitude.\n * @param {Number} height The height of the waveform, in pixels.\n * @param {Number} scale Amplitude scaling factor.\n * @returns {Number} The scaled waveform data point.\n */\n\nWaveformShape.scaleY = function(amplitude, height, scale) {\n  var y = -(height - 1) * (amplitude * scale + 128) / 255 + (height - 1);\n\n  return clamp(Math.floor(y), 0, height - 1);\n};\n\nexport default WaveformShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentShape} class.\n *\n * @module segment-shape\n */\n\nimport SegmentMarker from './segment-marker';\nimport WaveformShape from './waveform-shape';\n\nvar defaultFontFamily = 'sans-serif';\nvar defaultFontSize = 10;\nvar defaultFontShape = 'normal';\n\n/**\n * Creates a waveform segment shape with optional start and end markers.\n *\n * @class\n * @alias SegmentShape\n *\n * @param {Segment} segment\n * @param {Peaks} peaks\n * @param {SegmentsLayer} layer\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nfunction SegmentShape(segment, peaks, layer, view) {\n  this._segment       = segment;\n  this._peaks         = peaks;\n  this._layer         = layer;\n  this._view          = view;\n  this._label         = null;\n  this._startMarker   = null;\n  this._endMarker     = null;\n  this._color         = segment.color;\n\n  this._waveformShape = new WaveformShape({\n    color:   segment.color,\n    view:    view,\n    segment: segment\n  });\n\n  this._onMouseEnter = this._onMouseEnter.bind(this);\n  this._onMouseLeave = this._onMouseLeave.bind(this);\n  this._onClick      = this._onClick.bind(this);\n  this._onDblClick   = this._onDblClick.bind(this);\n\n  // Set up event handlers to show/hide the segment label text when the user\n  // hovers the mouse over the segment.\n  this._waveformShape.on('mouseenter', this._onMouseEnter);\n  this._waveformShape.on('mouseleave', this._onMouseLeave);\n  this._waveformShape.on('click', this._onClick);\n  this._waveformShape.on('dblclick', this._onDblClick);\n\n  // Event handlers for markers\n  this._onSegmentHandleDrag      = this._onSegmentHandleDrag.bind(this);\n  this._onSegmentHandleDragStart = this._onSegmentHandleDragStart.bind(this);\n  this._onSegmentHandleDragEnd   = this._onSegmentHandleDragEnd.bind(this);\n\n  this._label = this._peaks.options.createSegmentLabel({\n    segment:    segment,\n    view:       this._view.getName(),\n    layer:      this._layer,\n    fontFamily: this._peaks.options.fontFamily,\n    fontSize:   this._peaks.options.fontSize,\n    fontStyle:  this._peaks.options.fontStyle\n  });\n\n  if (this._label) {\n    this._label.hide();\n  }\n\n  this._createMarkers();\n}\n\nSegmentShape.prototype.updatePosition = function() {\n  var segmentStartOffset = this._view.timeToPixels(this._segment.startTime);\n  var segmentEndOffset   = this._view.timeToPixels(this._segment.endTime);\n\n  var frameStartOffset = this._view.getFrameOffset();\n\n  var startPixel = segmentStartOffset - frameStartOffset;\n  var endPixel   = segmentEndOffset   - frameStartOffset;\n\n  var marker = this.getStartMarker();\n\n  if (marker) {\n    marker.setX(startPixel - marker.getWidth());\n  }\n\n  marker = this.getEndMarker();\n\n  if (marker) {\n    marker.setX(endPixel);\n  }\n};\n\nSegmentShape.prototype.getSegment = function() {\n  return this._segment;\n};\n\nSegmentShape.prototype.getStartMarker = function() {\n  return this._startMarker;\n};\n\nSegmentShape.prototype.getEndMarker = function() {\n  return this._endMarker;\n};\n\nSegmentShape.prototype.addToLayer = function(layer) {\n  this._waveformShape.addToLayer(layer);\n\n  if (this._label) {\n    layer.add(this._label);\n  }\n\n  if (this._startMarker) {\n    this._startMarker.addToLayer(layer);\n  }\n\n  if (this._endMarker) {\n    this._endMarker.addToLayer(layer);\n  }\n};\n\nSegmentShape.prototype._createMarkers = function() {\n  var editable = this._layer.isEditingEnabled() && this._segment.editable;\n\n  if (!editable) {\n    return;\n  }\n\n  var startMarker = this._peaks.options.createSegmentMarker({\n    segment:      this._segment,\n    draggable:    editable,\n    startMarker:  true,\n    color:        this._peaks.options.segmentStartMarkerColor,\n    fontFamily:   this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:     this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:    this._peaks.options.fontStyle || defaultFontShape,\n    layer:        this._layer,\n    view:         this._view.getName()\n  });\n\n  if (startMarker) {\n    this._startMarker = new SegmentMarker({\n      segment:      this._segment,\n      segmentShape: this,\n      draggable:    editable,\n      startMarker:  true,\n      marker:       startMarker,\n      onDrag:       this._onSegmentHandleDrag,\n      onDragStart:  this._onSegmentHandleDragStart,\n      onDragEnd:    this._onSegmentHandleDragEnd\n    });\n  }\n\n  var endMarker = this._peaks.options.createSegmentMarker({\n    segment:      this._segment,\n    draggable:    editable,\n    startMarker:  false,\n    color:        this._peaks.options.segmentEndMarkerColor,\n    fontFamily:   this._peaks.options.fontFamily || defaultFontFamily,\n    fontSize:     this._peaks.options.fontSize || defaultFontSize,\n    fontStyle:    this._peaks.options.fontStyle || defaultFontShape,\n    layer:        this._layer,\n    view:         this._view.getName()\n  });\n\n  if (endMarker) {\n    this._endMarker = new SegmentMarker({\n      segment:      this._segment,\n      segmentShape: this,\n      draggable:    editable,\n      startMarker:  false,\n      marker:       endMarker,\n      onDrag:       this._onSegmentHandleDrag,\n      onDragStart:  this._onSegmentHandleDragStart,\n      onDragEnd:    this._onSegmentHandleDragEnd\n    });\n  }\n};\n\nSegmentShape.prototype._onMouseEnter = function() {\n  if (this._label) {\n    this._label.moveToTop();\n    this._label.show();\n  }\n\n  this._peaks.emit('segments.mouseenter', this._segment);\n};\n\nSegmentShape.prototype._onMouseLeave = function() {\n  if (this._label) {\n    this._label.hide();\n  }\n\n  this._peaks.emit('segments.mouseleave', this._segment);\n};\n\nSegmentShape.prototype._onClick = function() {\n  this._peaks.emit('segments.click', this._segment);\n};\n\nSegmentShape.prototype._onDblClick = function() {\n  this._peaks.emit('segments.dblclick', this._segment);\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentHandleDrag = function(segmentMarker) {\n  var width = this._view.getWidth();\n\n  var startMarker = segmentMarker.isStartMarker();\n\n  var startMarkerX = this._startMarker.getX();\n  var endMarkerX = this._endMarker.getX();\n\n  if (startMarker && startMarkerX >= 0) {\n    var startMarkerOffset = startMarkerX +\n                            this._startMarker.getWidth();\n\n    this._segment._setStartTime(this._view.pixelOffsetToTime(startMarkerOffset));\n\n    segmentMarker.timeUpdated(this._segment.startTime);\n  }\n\n  if (!startMarker && endMarkerX < width) {\n    var endMarkerOffset = endMarkerX;\n\n    this._segment._setEndTime(this._view.pixelOffsetToTime(endMarkerOffset));\n\n    segmentMarker.timeUpdated(this._segment.endTime);\n  }\n\n  this._peaks.emit('segments.dragged', this._segment, startMarker);\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentHandleDragStart = function(segmentMarker) {\n  var startMarker = segmentMarker.isStartMarker();\n\n  this._peaks.emit('segments.dragstart', this._segment, startMarker);\n};\n\n/**\n * @param {SegmentMarker} segmentMarker\n */\n\nSegmentShape.prototype._onSegmentHandleDragEnd = function(segmentMarker) {\n  var startMarker = segmentMarker.isStartMarker();\n\n  this._peaks.emit('segments.dragend', this._segment, startMarker);\n};\n\nSegmentShape.prototype.fitToView = function() {\n  if (this._startMarker) {\n    this._startMarker.fitToView();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.fitToView();\n  }\n\n  this._waveformShape.setWaveformColor(this._color);\n};\n\nSegmentShape.prototype.destroy = function() {\n  this._waveformShape.destroy();\n\n  if (this._label) {\n    this._label.destroy();\n  }\n\n  if (this._startMarker) {\n    this._startMarker.destroy();\n  }\n\n  if (this._endMarker) {\n    this._endMarker.destroy();\n  }\n};\n\nexport default SegmentShape;\n","/**\n * @file\n *\n * Defines the {@link SegmentsLayer} class.\n *\n * @module segments-layer\n */\n\nimport SegmentShape from './segment-shape';\nimport { objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a Konva.Layer that displays segment markers against the audio\n * waveform.\n *\n * @class\n * @alias SegmentsLayer\n *\n * @param {Peaks} peaks\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Boolean} allowEditing\n */\n\nfunction SegmentsLayer(peaks, view, allowEditing) {\n  this._peaks         = peaks;\n  this._view          = view;\n  this._allowEditing  = allowEditing;\n  this._segmentShapes = {};\n  this._layer         = new Konva.Layer();\n\n  this._onSegmentsUpdate    = this._onSegmentsUpdate.bind(this);\n  this._onSegmentsAdd       = this._onSegmentsAdd.bind(this);\n  this._onSegmentsRemove    = this._onSegmentsRemove.bind(this);\n  this._onSegmentsRemoveAll = this._onSegmentsRemoveAll.bind(this);\n  this._onSegmentsDragged   = this._onSegmentsDragged.bind(this);\n\n  this._peaks.on('segments.update', this._onSegmentsUpdate);\n  this._peaks.on('segments.add', this._onSegmentsAdd);\n  this._peaks.on('segments.remove', this._onSegmentsRemove);\n  this._peaks.on('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.on('segments.dragged', this._onSegmentsDragged);\n}\n\n/**\n * Adds the layer to the given {Konva.Stage}.\n *\n * @param {Konva.Stage} stage\n */\n\nSegmentsLayer.prototype.addToStage = function(stage) {\n  stage.add(this._layer);\n};\n\nSegmentsLayer.prototype.enableEditing = function(enable) {\n  this._allowEditing = enable;\n};\n\nSegmentsLayer.prototype.isEditingEnabled = function() {\n  return this._allowEditing;\n};\n\nSegmentsLayer.prototype.formatTime = function(time) {\n  return this._view.formatTime(time);\n};\n\nSegmentsLayer.prototype._onSegmentsUpdate = function(segment) {\n  var redraw = false;\n  var segmentShape = this._segmentShapes[segment.id];\n  var frameStartTime = this._view.getStartTime();\n  var frameEndTime = this._view.getEndTime();\n\n  if (segmentShape) {\n    this._removeSegment(segment);\n    redraw = true;\n  }\n\n  if (segment.isVisible(frameStartTime, frameEndTime)) {\n    this._addSegmentShape(segment);\n    redraw = true;\n  }\n\n  if (redraw) {\n    this.updateSegments(frameStartTime, frameEndTime);\n  }\n};\n\nSegmentsLayer.prototype._onSegmentsAdd = function(segments) {\n  var self = this;\n\n  var frameStartTime = self._view.getStartTime();\n  var frameEndTime   = self._view.getEndTime();\n\n  segments.forEach(function(segment) {\n    if (segment.isVisible(frameStartTime, frameEndTime)) {\n      self._addSegmentShape(segment);\n    }\n  });\n\n  self.updateSegments(frameStartTime, frameEndTime);\n};\n\nSegmentsLayer.prototype._onSegmentsRemove = function(segments) {\n  var self = this;\n\n  segments.forEach(function(segment) {\n    self._removeSegment(segment);\n  });\n};\n\nSegmentsLayer.prototype._onSegmentsRemoveAll = function() {\n  this._layer.removeChildren();\n  this._segmentShapes = {};\n};\n\nSegmentsLayer.prototype._onSegmentsDragged = function(segment) {\n  this._updateSegment(segment);\n};\n\n/**\n * Creates the Konva UI objects for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._createSegmentShape = function(segment) {\n  return new SegmentShape(segment, this._peaks, this, this._view);\n};\n\n/**\n * Adds a Konva UI object to the layer for a given segment.\n *\n * @private\n * @param {Segment} segment\n * @returns {SegmentShape}\n */\n\nSegmentsLayer.prototype._addSegmentShape = function(segment) {\n  var segmentShape = this._createSegmentShape(segment);\n\n  segmentShape.addToLayer(this._layer);\n\n  this._segmentShapes[segment.id] = segmentShape;\n\n  return segmentShape;\n};\n\n/**\n * Updates the positions of all displayed segments in the view.\n *\n * @param {Number} startTime The start of the visible range in the view,\n *   in seconds.\n * @param {Number} endTime The end of the visible range in the view,\n *   in seconds.\n */\n\nSegmentsLayer.prototype.updateSegments = function(startTime, endTime) {\n  // Update segments in visible time range.\n  var segments = this._peaks.segments.find(startTime, endTime);\n\n  segments.forEach(this._updateSegment.bind(this));\n\n  // TODO: in the overview all segments are visible, so no need to check\n  this._removeInvisibleSegments(startTime, endTime);\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._updateSegment = function(segment) {\n  var segmentShape = this._findOrAddSegmentShape(segment);\n\n  segmentShape.updatePosition();\n};\n\n/**\n * @private\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._findOrAddSegmentShape = function(segment) {\n  var segmentShape = this._segmentShapes[segment.id];\n\n  if (!segmentShape) {\n    segmentShape = this._addSegmentShape(segment);\n  }\n\n  return segmentShape;\n};\n\n/**\n * Removes any segments that are not visible, i.e., are not within and do not\n * overlap the given time range.\n *\n * @private\n * @param {Number} startTime The start of the visible time range, in seconds.\n * @param {Number} endTime The end of the visible time range, in seconds.\n * @returns {Number} The number of segments removed.\n */\n\nSegmentsLayer.prototype._removeInvisibleSegments = function(startTime, endTime) {\n  var count = 0;\n\n  for (var segmentId in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentId)) {\n      var segment = this._segmentShapes[segmentId].getSegment();\n\n      if (!segment.isVisible(startTime, endTime)) {\n        this._removeSegment(segment);\n        count++;\n      }\n    }\n  }\n\n  return count;\n};\n\n/**\n * Removes the given segment from the view.\n *\n * @param {Segment} segment\n */\n\nSegmentsLayer.prototype._removeSegment = function(segment) {\n  var segmentShape = this._segmentShapes[segment.id];\n\n  if (segmentShape) {\n    segmentShape.destroy();\n    delete this._segmentShapes[segment.id];\n  }\n};\n\n/**\n * Toggles visibility of the segments layer.\n *\n * @param {Boolean} visible\n */\n\nSegmentsLayer.prototype.setVisible = function(visible) {\n  this._layer.setVisible(visible);\n};\n\nSegmentsLayer.prototype.destroy = function() {\n  this._peaks.off('segments.update', this._onSegmentsUpdate);\n  this._peaks.off('segments.add', this._onSegmentsAdd);\n  this._peaks.off('segments.remove', this._onSegmentsRemove);\n  this._peaks.off('segments.remove_all', this._onSegmentsRemoveAll);\n  this._peaks.off('segments.dragged', this._onSegmentsDragged);\n};\n\nSegmentsLayer.prototype.fitToView = function() {\n  for (var segmentId in this._segmentShapes) {\n    if (objectHasProperty(this._segmentShapes, segmentId)) {\n      var segmentShape = this._segmentShapes[segmentId];\n\n      segmentShape.fitToView();\n    }\n  }\n};\n\nSegmentsLayer.prototype.draw = function() {\n  this._layer.draw();\n};\n\nSegmentsLayer.prototype.getHeight = function() {\n  return this._layer.getHeight();\n};\n\nexport default SegmentsLayer;\n","/**\n * @file\n *\n * Defines the {@link WaveformAxis} class.\n *\n * @module waveform-axis\n */\n\nimport { formatTime, roundUpToNearest } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the waveform axis shapes and adds them to the given view layer.\n *\n * @class\n * @alias WaveformAxis\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @param {Object} options\n * @param {String} options.axisGridlineColor\n * @param {String} options.axisLabelColor\n * @param {String} options.axisLabelFontFamily\n * @param {Number} options.axisLabelFontSize\n * @param {String} options.axisLabelFontStyle\n */\n\nfunction WaveformAxis(view, options) {\n  var self = this;\n\n  self._axisGridlineColor = options.axisGridlineColor;\n  self._axisLabelColor    = options.axisLabelColor;\n\n  self._axisLabelFont = WaveformAxis._buildFontString(\n    options.axisLabelFontFamily,\n    options.axisLabelFontSize,\n    options.axisLabelFontStyle\n  );\n\n  self._axisShape = new Konva.Shape({\n    sceneFunc: function(context) {\n      self.drawAxis(context, view);\n    }\n  });\n}\n\nWaveformAxis._buildFontString = function(fontFamily, fontSize, fontStyle) {\n  if (!fontSize) {\n    fontSize = 11;\n  }\n\n  if (!fontFamily) {\n    fontFamily = 'sans-serif';\n  }\n\n  if (!fontStyle) {\n    fontStyle = 'normal';\n  }\n\n  return fontStyle + ' ' + fontSize + 'px ' + fontFamily;\n};\n\nWaveformAxis.prototype.addToLayer = function(layer) {\n  layer.add(this._axisShape);\n};\n\n/**\n * Returns number of seconds for each x-axis marker, appropriate for the\n * current zoom level, ensuring that markers are not too close together\n * and that markers are placed at intuitive time intervals (i.e., every 1,\n * 2, 5, 10, 20, 30 seconds, then every 1, 2, 5, 10, 20, 30 minutes, then\n * every 1, 2, 5, 10, 20, 30 hours).\n *\n * @param {WaveformOverview|WaveformZoomView} view\n * @returns {Number}\n */\n\nWaveformAxis.prototype.getAxisLabelScale = function(view) {\n  var baseSecs   = 1; // seconds\n  var steps      = [1, 2, 5, 10, 20, 30];\n  var minSpacing = 60;\n  var index      = 0;\n\n  var secs;\n\n  for (;;) {\n    secs = baseSecs * steps[index];\n    var pixels = view.timeToPixels(secs);\n\n    if (pixels < minSpacing) {\n      if (++index === steps.length) {\n        baseSecs *= 60; // seconds -> minutes -> hours\n        index = 0;\n      }\n    }\n    else {\n      break;\n    }\n  }\n\n  return secs;\n};\n\n/**\n * Draws the time axis and labels onto a view.\n *\n * @param {Konva.Context} context The context to draw on.\n * @param {WaveformOverview|WaveformZoomView} view\n */\n\nWaveformAxis.prototype.drawAxis = function(context, view) {\n  var currentFrameStartTime = view.getStartTime();\n\n  // Draw axis markers\n  var markerHeight = 10;\n\n  // Time interval between axis markers (seconds)\n  var axisLabelIntervalSecs = this.getAxisLabelScale(view);\n\n  // Time of first axis marker (seconds)\n  var firstAxisLabelSecs = roundUpToNearest(currentFrameStartTime, axisLabelIntervalSecs);\n\n  // Distance between waveform start time and first axis marker (seconds)\n  var axisLabelOffsetSecs = firstAxisLabelSecs - currentFrameStartTime;\n\n  // Distance between waveform start time and first axis marker (pixels)\n  var axisLabelOffsetPixels = view.timeToPixels(axisLabelOffsetSecs);\n\n  context.setAttr('strokeStyle', this._axisGridlineColor);\n  context.setAttr('lineWidth', 1);\n\n  // Set text style\n  context.setAttr('font', this._axisLabelFont);\n  context.setAttr('fillStyle', this._axisLabelColor);\n  context.setAttr('textAlign', 'left');\n  context.setAttr('textBaseline', 'bottom');\n\n  var secs = firstAxisLabelSecs;\n  var x;\n\n  var width  = view.getWidth();\n  var height = view.getHeight();\n\n  for (;;) {\n    // Position of axis marker (pixels)\n    x = axisLabelOffsetPixels + view.timeToPixels(secs - firstAxisLabelSecs);\n    if (x >= width) {\n      break;\n    }\n\n    context.beginPath();\n    context.moveTo(x + 0.5, 0);\n    context.lineTo(x + 0.5, 0 + markerHeight);\n    context.moveTo(x + 0.5, height);\n    context.lineTo(x + 0.5, height - markerHeight);\n    context.stroke();\n\n    // precision = 0, drops the fractional seconds\n    var label      = formatTime(secs, 0);\n    var labelWidth = context.measureText(label).width;\n    var labelX     = x - labelWidth / 2;\n    var labelY     = height - 1 - markerHeight;\n\n    if (labelX >= 0) {\n      context.fillText(label, labelX, labelY);\n    }\n\n    secs += axisLabelIntervalSecs;\n  }\n};\n\nexport default WaveformAxis;\n","/**\n * @file\n *\n * Defines the {@link WaveformOverview} class.\n *\n * @module waveform-overview\n */\n\nimport HighlightLayer from './highlight-layer';\nimport MouseDragHandler from './mouse-drag-handler';\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\nimport { clamp, formatTime, isFinite, isNumber } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates the overview waveform view.\n *\n * @class\n * @alias WaveformOverview\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformOverview(waveformData, container, peaks) {\n  var self = this;\n\n  self._originalWaveformData = waveformData;\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = peaks.options.overview;\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(this);\n  self._onPlaying = self._onPlaying.bind(this);\n  self._onPause = self._onPause.bind(this);\n  self._onZoomviewDisplaying = self._onZoomviewDisplaying.bind(this);\n  self._onWindowResize = self._onWindowResize.bind(this);\n\n  // Register event handlers\n  peaks.on('player.timeupdate', self._onTimeUpdate);\n  peaks.on('player.playing', self._onPlaying);\n  peaks.on('player.pause', self._onPause);\n  peaks.on('zoomview.displaying', self._onZoomviewDisplaying);\n  peaks.on('window_resize', self._onWindowResize);\n\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  self._data = waveformData;\n\n  if (self._width !== 0) {\n    try {\n      self._data = waveformData.resample({ width: self._width });\n    }\n    catch (error) {\n      // This error usually indicates that the waveform length\n      // is less than the container width\n    }\n  }\n\n  // Disable warning: The stage has 6 layers.\n  // Recommended maximum number of layers is 3-5.\n  Konva.showWarnings = false;\n\n  self._resizeTimeoutId = null;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformLayer = new Konva.Layer({ listening: false });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  self._segmentsLayer = new SegmentsLayer(peaks, self, false);\n  self._segmentsLayer.addToStage(self._stage);\n\n  self._pointsLayer = new PointsLayer(peaks, self, false);\n  self._pointsLayer.addToStage(self._stage);\n\n  self._highlightLayer = new HighlightLayer(\n    self,\n    self._viewOptions.highlightOffset,\n    self._viewOptions.highlightColor\n  );\n  self._highlightLayer.addToStage(self._stage);\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  var time = self._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(time);\n\n  self._mouseDragHandler = new MouseDragHandler(self._stage, {\n    onMouseDown: function(mousePosX) {\n      mousePosX = clamp(mousePosX, 0, self._width);\n\n      var time = self.pixelsToTime(mousePosX);\n      var duration = self._getDuration();\n\n      // Prevent the playhead position from jumping by limiting click\n      // handling to the waveform duration.\n      if (time > duration) {\n        time = duration;\n      }\n\n      self._playheadLayer.updatePlayheadTime(time);\n\n      peaks.player.seek(time);\n    },\n\n    onMouseMove: function(mousePosX) {\n      mousePosX = clamp(mousePosX, 0, self._width);\n\n      var time = self.pixelsToTime(mousePosX);\n      var duration = self._getDuration();\n\n      if (time > duration) {\n        time = duration;\n      }\n\n      // Update the playhead position. This gives a smoother visual update\n      // than if we only use the player.timeupdate event.\n      self._playheadLayer.updatePlayheadTime(time);\n\n      self._peaks.player.seek(time);\n    }\n  });\n\n  self._onClick = self._onClick.bind(this);\n  self._onDblClick = self._onDblClick.bind(this);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n}\n\nWaveformOverview.prototype._onClick = function(event) {\n  this._clickHandler(event, 'overview.click');\n};\n\nWaveformOverview.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'overview.dblclick');\n};\n\nWaveformOverview.prototype._clickHandler = function(event, eventName) {\n  var pixelIndex = event.evt.layerX;\n  var time = this.pixelsToTime(pixelIndex);\n\n  this._peaks.emit(eventName, time);\n};\n\nWaveformOverview.prototype.getName = function() {\n  return 'overview';\n};\n\nWaveformOverview.prototype._onTimeUpdate = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformOverview.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformOverview.prototype._onZoomviewDisplaying = function(startTime, endTime) {\n  this.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype.showHighlight = function(startTime, endTime) {\n  this._highlightLayer.showHighlight(startTime, endTime);\n};\n\nWaveformOverview.prototype._onWindowResize = function() {\n  var self = this;\n\n  if (self._resizeTimeoutId) {\n    clearTimeout(self._resizeTimeoutId);\n    self._resizeTimeoutId = null;\n  }\n\n  // Avoid resampling waveform data to zero width\n  if (self._container.clientWidth !== 0) {\n    self._width = self._container.clientWidth;\n    self._stage.setWidth(self._width);\n\n    self._resizeTimeoutId = setTimeout(function() {\n      self._width = self._container.clientWidth;\n      self._data = self._originalWaveformData.resample({ width: self._width });\n      self._stage.setWidth(self._width);\n\n      self._updateWaveform();\n    }, 500);\n  }\n};\n\nWaveformOverview.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n\n  if (this._width !== 0) {\n    this._data = waveformData.resample({ width: this._width });\n  }\n  else {\n    this._data = waveformData;\n  }\n\n  this._updateWaveform();\n};\n\nWaveformOverview.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._waveformLayer.draw();\n  }\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformOverview.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n * (This is presented for symmetry with WaveformZoomview. Since WaveformOverview\n * doesn't scroll, its pixelOffsetToTime & pixelsToTime methods are identical.)\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformOverview.prototype.pixelOffsetToTime = WaveformOverview.prototype.pixelsToTime;\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformOverview.prototype.getFrameOffset = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the leftmost edge\n */\n\nWaveformOverview.prototype.getStartTime = function() {\n  return 0;\n};\n\n/**\n * @returns {Number} The time at the rightmost edge\n */\n\nWaveformOverview.prototype.getEndTime = function() {\n  return this._getDuration();\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformOverview.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformOverview.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformOverview.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformOverview.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._waveformLayer.draw();\n  this._segmentsLayer.draw();\n};\n\nWaveformOverview.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformOverview.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformOverview.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    var time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformOverview.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformOverview.prototype._createWaveform = function() {\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n};\n\nWaveformOverview.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n\n  this._axis = new WaveformAxis(this, {\n    axisGridlineColor:   this._viewOptions.axisGridlineColor,\n    axisLabelColor:      this._viewOptions.axisLabelColor,\n    axisLabelFontFamily: this._viewOptions.fontFamily,\n    axisLabelFontSize:   this._viewOptions.fontSize,\n    axisLabelFontStyle:  this._viewOptions.fontStyle\n  });\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\nWaveformOverview.prototype.removeHighlightRect = function() {\n  this._highlightLayer.removeHighlight();\n};\n\nWaveformOverview.prototype._updateWaveform = function() {\n  this._waveformLayer.draw();\n  this._axisLayer.draw();\n\n  var playheadTime = this._peaks.player.getCurrentTime();\n\n  this._playheadLayer.updatePlayheadTime(playheadTime);\n\n  this._highlightLayer.updateHighlight();\n\n  var frameStartTime = 0;\n  var frameEndTime   = this.pixelsToTime(this._width);\n\n  this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n};\n\nWaveformOverview.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformOverview.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformOverview.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformOverview.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformOverview.prototype.formatTime = function(time) {\n  return formatTime(time, this._timeLabelPrecision);\n};\n\nWaveformOverview.prototype.enableMarkerEditing = function(enable) {\n  this._segmentsLayer.enableEditing(enable);\n  this._pointsLayer.enableEditing(enable);\n};\n\nWaveformOverview.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  var updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.setWidth(this._width);\n\n    try {\n      this._data = this._originalWaveformData.resample({ width: this._width });\n      updateWaveform = true;\n    }\n    catch (error) {\n      // Ignore, and leave this._data as it was\n    }\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.setHeight(this._height);\n\n  this._waveformShape.fitToView();\n  this._playheadLayer.fitToView();\n  this._segmentsLayer.fitToView();\n  this._pointsLayer.fitToView();\n  this._highlightLayer.fitToView();\n\n  if (updateWaveform) {\n    this._updateWaveform();\n  }\n\n  this._stage.draw();\n};\n\nWaveformOverview.prototype.destroy = function() {\n  if (this._resizeTimeoutId) {\n    clearTimeout(this._resizeTimeoutId);\n    this._resizeTimeoutId = null;\n  }\n\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('zoomview.displaying', this._onZoomviewDisplaying);\n  this._peaks.off('window_resize', this._onWindowResize);\n\n  this._playheadLayer.destroy();\n  this._segmentsLayer.destroy();\n  this._pointsLayer.destroy();\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformOverview;\n","/**\n * @file\n *\n * Defines the {@link WaveformZoomView} class.\n *\n * @module waveform-zoomview\n */\n\nimport MouseDragHandler from './mouse-drag-handler';\nimport PlayheadLayer from './playhead-layer';\nimport PointsLayer from './points-layer';\nimport SegmentsLayer from './segments-layer';\nimport WaveformAxis from './waveform-axis';\nimport WaveformShape from './waveform-shape';\n// import AnimatedZoomAdapter from './animated-zoom-adapter';\n// import StaticZoomAdapter from './static-zoom-adapter';\nimport { clamp, formatTime, isFinite, isNumber, isValidTime,\n  objectHasProperty } from './utils';\nimport Konva from 'konva/lib/Core';\n\n/**\n * Creates a zoomable waveform view.\n *\n * @class\n * @alias WaveformZoomView\n *\n * @param {WaveformData} waveformData\n * @param {HTMLElement} container\n * @param {Peaks} peaks\n */\n\nfunction WaveformZoomView(waveformData, container, peaks) {\n  var self = this;\n\n  self._originalWaveformData = waveformData;\n  self._container = container;\n  self._peaks = peaks;\n  self._options = peaks.options;\n  self._viewOptions = peaks.options.zoomview;\n\n  // Bind event handlers\n  self._onTimeUpdate = self._onTimeUpdate.bind(self);\n  self._onPlaying = self._onPlaying.bind(self);\n  self._onPause = self._onPause.bind(self);\n  self._onWindowResize = self._onWindowResize.bind(self);\n  self._onKeyboardLeft = self._onKeyboardLeft.bind(self);\n  self._onKeyboardRight = self._onKeyboardRight.bind(self);\n  self._onKeyboardShiftLeft  = self._onKeyboardShiftLeft.bind(self);\n  self._onKeyboardShiftRight = self._onKeyboardShiftRight.bind(self);\n\n  // Register event handlers\n  self._peaks.on('player.timeupdate', self._onTimeUpdate);\n  self._peaks.on('player.playing', self._onPlaying);\n  self._peaks.on('player.pause', self._onPause);\n  self._peaks.on('window_resize', self._onWindowResize);\n  self._peaks.on('keyboard.left', self._onKeyboardLeft);\n  self._peaks.on('keyboard.right', self._onKeyboardRight);\n  self._peaks.on('keyboard.shift_left', self._onKeyboardShiftLeft);\n  self._peaks.on('keyboard.shift_right', self._onKeyboardShiftRight);\n\n  self._enableAutoScroll = true;\n  self._amplitudeScale = 1.0;\n  self._timeLabelPrecision = self._viewOptions.timeLabelPrecision;\n\n  self._data = null;\n  self._pixelLength = 0;\n\n  var initialZoomLevel = peaks.zoom.getZoomLevel();\n\n  self._zoomLevelAuto = false;\n  self._zoomLevelSeconds = null;\n\n  self._resizeTimeoutId = null;\n  self._resampleData({ scale: initialZoomLevel });\n\n  self._width = container.clientWidth;\n  self._height = container.clientHeight;\n\n  // The pixel offset of the current frame being displayed\n  self._frameOffset = 0;\n\n  self._stage = new Konva.Stage({\n    container: container,\n    width: self._width,\n    height: self._height\n  });\n\n  self._waveformLayer = new Konva.Layer({ listening: false });\n\n  self._waveformColor = self._viewOptions.waveformColor;\n  self._playedWaveformColor = self._viewOptions.playedWaveformColor;\n\n  self._createWaveform();\n\n  self._segmentsLayer = new SegmentsLayer(peaks, self, true);\n  self._segmentsLayer.addToStage(self._stage);\n\n  self._pointsLayer = new PointsLayer(peaks, self, true);\n  self._pointsLayer.addToStage(self._stage);\n\n  self._createAxisLabels();\n\n  self._playheadLayer = new PlayheadLayer({\n    player: self._peaks.player,\n    view: self,\n    showPlayheadTime: self._viewOptions.showPlayheadTime,\n    playheadColor: self._viewOptions.playheadColor,\n    playheadTextColor: self._viewOptions.playheadTextColor,\n    playheadFontFamily: self._viewOptions.fontFamily,\n    playheadFontSize: self._viewOptions.fontSize,\n    playheadFontStyle: self._viewOptions.fontStyle\n  });\n\n  self._playheadLayer.addToStage(self._stage);\n\n  var time = self._peaks.player.getCurrentTime();\n\n  self._syncPlayhead(time);\n\n  self._mouseDragHandler = new MouseDragHandler(self._stage, {\n    onMouseDown: function(mousePosX) {\n      this.initialFrameOffset = self._frameOffset;\n      this.mouseDownX = mousePosX;\n    },\n\n    onMouseMove: function(mousePosX) {\n      // Moving the mouse to the left increases the time position of the\n      // left-hand edge of the visible waveform.\n      var diff = this.mouseDownX - mousePosX;\n      var newFrameOffset = this.initialFrameOffset + diff;\n\n      if (newFrameOffset !== this.initialFrameOffset) {\n        self._updateWaveform(newFrameOffset);\n      }\n    },\n\n    onMouseUp: function(/* mousePosX */) {\n      // Set playhead position only on click release, when not dragging.\n      if (!self._mouseDragHandler.isDragging()) {\n        var time = self.pixelOffsetToTime(this.mouseDownX);\n        var duration = self._getDuration();\n\n        // Prevent the playhead position from jumping by limiting click\n        // handling to the waveform duration.\n        if (time > duration) {\n          time = duration;\n        }\n\n        self._playheadLayer.updatePlayheadTime(time);\n\n        self._peaks.player.seek(time);\n      }\n    }\n  });\n\n  self._onWheel = self._onWheel.bind(self);\n  self.setWheelMode(self._viewOptions.wheelMode);\n\n  self._onClick = self._onClick.bind(this);\n  self._onDblClick = self._onDblClick.bind(this);\n\n  self._stage.on('click', self._onClick);\n  self._stage.on('dblclick', self._onDblClick);\n}\n\nWaveformZoomView.prototype._onClick = function(event) {\n  this._clickHandler(event, 'zoomview.click');\n};\n\nWaveformZoomView.prototype._onDblClick = function(event) {\n  this._clickHandler(event, 'zoomview.dblclick');\n};\n\nWaveformZoomView.prototype._clickHandler = function(event, eventName) {\n  var mousePosX = event.evt.layerX;\n  var time = this.pixelOffsetToTime(mousePosX);\n\n  this._peaks.emit(eventName, time);\n};\n\nWaveformZoomView.prototype.setWheelMode = function(mode) {\n  if (mode !== this._wheelMode) {\n    this._wheelMode = mode;\n\n    switch (mode) {\n      case 'scroll':\n        this._stage.on('wheel', this._onWheel);\n        break;\n\n      case 'none':\n        this._stage.off('wheel');\n        break;\n    }\n  }\n};\n\nWaveformZoomView.prototype._onWheel = function(event) {\n  var wheelEvent = event.evt;\n  var delta = wheelEvent.shiftKey ? wheelEvent.deltaY : wheelEvent.deltaX;\n  var offAxisDelta = wheelEvent.shiftKey ? wheelEvent.deltaX : wheelEvent.deltaY;\n\n  // Ignore the event if it looks like the user is scrolling vertically\n  // down the page\n  if (Math.abs(delta) < Math.abs(offAxisDelta)) {\n    return;\n  }\n\n  event.evt.preventDefault();\n\n  var newFrameOffset = clamp(\n    this._frameOffset + Math.floor(delta), 0, this._pixelLength - this._width\n  );\n\n  this._updateWaveform(newFrameOffset);\n};\n\nWaveformZoomView.prototype.getName = function() {\n  return 'zoomview';\n};\n\nWaveformZoomView.prototype._onTimeUpdate = function(time) {\n  if (this._mouseDragHandler.isDragging()) {\n    return;\n  }\n\n  this._syncPlayhead(time);\n};\n\nWaveformZoomView.prototype._onPlaying = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n};\n\nWaveformZoomView.prototype._onPause = function(time) {\n  this._playheadLayer.stop(time);\n};\n\nWaveformZoomView.prototype._onWindowResize = function() {\n  var self = this;\n\n  var width = self._container.clientWidth;\n\n  if (!self._zoomLevelAuto) {\n    self._width = width;\n    self._stage.width(width);\n    self._updateWaveform(self._frameOffset);\n  }\n  else {\n    if (self._resizeTimeoutId) {\n      clearTimeout(self._resizeTimeoutId);\n      self._resizeTimeoutId = null;\n    }\n\n    // Avoid resampling waveform data to zero width\n    if (width !== 0) {\n      self._width = width;\n      self._stage.width(width);\n\n      self._resizeTimeoutId = setTimeout(function() {\n        self._width = width;\n        self._data = self._originalWaveformData.resample(width);\n        self._stage.width(width);\n\n        self._updateWaveform(self._frameOffset);\n      }, 500);\n    }\n  }\n};\n\nWaveformZoomView.prototype._onKeyboardLeft = function() {\n  this._keyboardScroll(-1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardRight = function() {\n  this._keyboardScroll(1, false);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftLeft = function() {\n  this._keyboardScroll(-1, true);\n};\n\nWaveformZoomView.prototype._onKeyboardShiftRight = function() {\n  this._keyboardScroll(1, true);\n};\n\nWaveformZoomView.prototype._keyboardScroll = function(direction, large) {\n  var increment;\n\n  if (large) {\n    increment = direction * this._width;\n  }\n  else {\n    increment = direction * this.timeToPixels(this._options.nudgeIncrement);\n  }\n\n  this.scrollWaveform({ pixels: increment });\n};\n\nWaveformZoomView.prototype.setWaveformData = function(waveformData) {\n  this._originalWaveformData = waveformData;\n  // Don't update the UI here, call setZoom().\n};\n\nWaveformZoomView.prototype.playheadPosChanged = function(time) {\n  if (this._playedWaveformShape) {\n    this._playedSegment.endTime = time;\n    this._unplayedSegment.startTime = time;\n\n    this._drawWaveformLayer();\n  }\n};\n\nWaveformZoomView.prototype._syncPlayhead = function(time) {\n  this._playheadLayer.updatePlayheadTime(time);\n\n  if (this._enableAutoScroll) {\n    // Check for the playhead reaching the right-hand side of the window.\n\n    var pixelIndex = this.timeToPixels(time);\n\n    // TODO: move this code to animation function?\n    // TODO: don't scroll if user has positioned view manually (e.g., using\n    // the keyboard)\n    var endThreshold = this._frameOffset + this._width - 100;\n\n    if (pixelIndex >= endThreshold || pixelIndex < this._frameOffset) {\n      // Put the playhead at 100 pixels from the left edge\n      this._frameOffset = pixelIndex - 100;\n\n      if (this._frameOffset < 0) {\n        this._frameOffset = 0;\n      }\n\n      this._updateWaveform(this._frameOffset);\n    }\n  }\n};\n\n/**\n * Changes the zoom level.\n *\n * @param {Number} scale The new zoom level, in samples per pixel.\n */\n\nWaveformZoomView.prototype._getScale = function(duration) {\n  return duration * this._data.sample_rate / this._width;\n};\n\nfunction isAutoScale(options) {\n  return ((objectHasProperty(options, 'scale') && options.scale === 'auto') ||\n          (objectHasProperty(options, 'seconds') && options.seconds === 'auto'));\n}\n\nWaveformZoomView.prototype.setZoom = function(options) {\n  var scale;\n\n  if (isAutoScale(options)) {\n    var seconds = this._peaks.player.getDuration();\n\n    if (!isValidTime(seconds)) {\n      return false;\n    }\n\n    this._zoomLevelAuto = true;\n    this._zoomLevelSeconds = null;\n    scale = this._getScale(seconds);\n  }\n  else {\n    if (objectHasProperty(options, 'scale')) {\n      this._zoomLevelSeconds = null;\n      scale = options.scale;\n    }\n    else if (objectHasProperty(options, 'seconds')) {\n      if (!isValidTime(options.seconds)) {\n        return false;\n      }\n\n      this._zoomLevelSeconds = options.seconds;\n      scale = this._getScale(options.seconds);\n    }\n\n    this._zoomLevelAuto = false;\n  }\n\n  if (scale < this._originalWaveformData.scale) {\n    // eslint-disable-next-line max-len\n    this._peaks.logger('peaks.zoomview.setZoom(): zoom level must be at least ' + this._originalWaveformData.scale);\n    scale = this._originalWaveformData.scale;\n  }\n\n  var currentTime = this._peaks.player.getCurrentTime();\n  var apexTime;\n  var playheadOffsetPixels = this._playheadLayer.getPlayheadOffset();\n\n  if (playheadOffsetPixels >= 0 && playheadOffsetPixels < this._width) {\n    // Playhead is visible. Change the zoom level while keeping the\n    // playhead at the same position in the window.\n    apexTime = currentTime;\n  }\n  else {\n    // Playhead is not visible. Change the zoom level while keeping the\n    // centre of the window at the same position in the waveform.\n    playheadOffsetPixels = Math.floor(this._width / 2);\n    apexTime = this.pixelOffsetToTime(playheadOffsetPixels);\n  }\n\n  var prevScale = this._scale;\n\n  this._resampleData({ scale: scale });\n\n  var apexPixel = this.timeToPixels(apexTime);\n\n  this._frameOffset = apexPixel - playheadOffsetPixels;\n\n  this._updateWaveform(this._frameOffset);\n\n  this._playheadLayer.zoomLevelChanged();\n\n  // Update the playhead position after zooming.\n  this._playheadLayer.updatePlayheadTime(currentTime);\n\n  // var adapter = this.createZoomAdapter(currentScale, previousScale);\n\n  // adapter.start(relativePosition);\n\n  this._peaks.emit('zoom.update', scale, prevScale);\n\n  return true;\n};\n\nWaveformZoomView.prototype._resampleData = function(options) {\n  this._data = this._originalWaveformData.resample(options);\n  this._scale = this._data.scale;\n  this._pixelLength = this._data.length;\n};\n\nWaveformZoomView.prototype.getStartTime = function() {\n  return this.pixelOffsetToTime(0);\n};\n\nWaveformZoomView.prototype.getEndTime = function() {\n  return this.pixelOffsetToTime(this._width);\n};\n\nWaveformZoomView.prototype.setStartTime = function(time) {\n  if (time < 0) {\n    time = 0;\n  }\n\n  if (this._zoomLevelAuto) {\n    time = 0;\n  }\n\n  this._updateWaveform(this.timeToPixels(time));\n};\n\n/**\n * Returns the pixel index for a given time, for the current zoom level.\n *\n * @param {Number} time Time, in seconds.\n * @returns {Number} Pixel index.\n */\n\nWaveformZoomView.prototype.timeToPixels = function(time) {\n  return Math.floor(time * this._data.sample_rate / this._data.scale);\n};\n\n/**\n * Returns the time for a given pixel index, for the current zoom level.\n *\n * @param {Number} pixels Pixel index.\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelsToTime = function(pixels) {\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/**\n * Returns the time for a given pixel offset (relative to the\n * current scroll position), for the current zoom level.\n *\n * @param {Number} offset Offset from left-visible-edge of view\n * @returns {Number} Time, in seconds.\n */\n\nWaveformZoomView.prototype.pixelOffsetToTime = function(offset) {\n  var pixels = this._frameOffset + offset;\n\n  return pixels * this._data.scale / this._data.sample_rate;\n};\n\n/* var zoomAdapterMap = {\n  'animated': AnimatedZoomAdapter,\n  'static': StaticZoomAdapter\n};\n\nWaveformZoomView.prototype.createZoomAdapter = function(currentScale, previousScale) {\n  var ZoomAdapter = zoomAdapterMap[this._viewOptions.zoomAdapter];\n\n  if (!ZoomAdapter) {\n    throw new Error('Invalid zoomAdapter: ' + this._viewOptions.zoomAdapter);\n  }\n\n  return ZoomAdapter.create(this, currentScale, previousScale);\n}; */\n\n/**\n * @returns {Number} The start position of the waveform shown in the view,\n *   in pixels.\n */\n\nWaveformZoomView.prototype.getFrameOffset = function() {\n  return this._frameOffset;\n};\n\n/**\n * @returns {Number} The width of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getWidth = function() {\n  return this._width;\n};\n\n/**\n * @returns {Number} The height of the view, in pixels.\n */\n\nWaveformZoomView.prototype.getHeight = function() {\n  return this._height;\n};\n\n/**\n * @returns {Number} The media duration, in seconds.\n */\n\nWaveformZoomView.prototype._getDuration = function() {\n  return this._peaks.player.getDuration();\n};\n\n/**\n * Adjusts the amplitude scale of waveform shown in the view, which allows\n * users to zoom the waveform vertically.\n *\n * @param {Number} scale The new amplitude scale factor\n */\n\nWaveformZoomView.prototype.setAmplitudeScale = function(scale) {\n  if (!isNumber(scale) || !isFinite(scale)) {\n    throw new Error('view.setAmplitudeScale(): Scale must be a valid number');\n  }\n\n  this._amplitudeScale = scale;\n\n  this._drawWaveformLayer();\n  this._segmentsLayer.draw();\n};\n\nWaveformZoomView.prototype.getAmplitudeScale = function() {\n  return this._amplitudeScale;\n};\n\n/**\n * @returns {WaveformData} The view's waveform data.\n */\n\nWaveformZoomView.prototype.getWaveformData = function() {\n  return this._data;\n};\n\nWaveformZoomView.prototype._createWaveformShapes = function() {\n  if (!this._waveformShape) {\n    this._waveformShape = new WaveformShape({\n      color: this._waveformColor,\n      view: this\n    });\n\n    this._waveformShape.addToLayer(this._waveformLayer);\n  }\n\n  if (this._playedWaveformColor && !this._playedWaveformShape) {\n    var time = this._peaks.player.getCurrentTime();\n\n    this._playedSegment = {\n      startTime: 0,\n      endTime: time\n    };\n\n    this._unplayedSegment = {\n      startTime: time,\n      endTime: this._getDuration()\n    };\n\n    this._waveformShape.setSegment(this._unplayedSegment);\n\n    this._playedWaveformShape = new WaveformShape({\n      color: this._playedWaveformColor,\n      view: this,\n      segment: this._playedSegment\n    });\n\n    this._playedWaveformShape.addToLayer(this._waveformLayer);\n  }\n};\n\nWaveformZoomView.prototype._destroyPlayedWaveformShape = function() {\n  this._waveformShape.setSegment(null);\n\n  this._playedWaveformShape.destroy();\n  this._playedWaveformShape = null;\n\n  this._playedSegment = null;\n  this._unplayedSegment = null;\n};\n\nWaveformZoomView.prototype._createWaveform = function() {\n  this._createWaveformShapes();\n\n  this._stage.add(this._waveformLayer);\n\n  this._peaks.emit('zoomview.displaying', 0, this.getEndTime());\n};\n\nWaveformZoomView.prototype._createAxisLabels = function() {\n  this._axisLayer = new Konva.Layer({ listening: false });\n\n  this._axis = new WaveformAxis(this, {\n    axisGridlineColor:   this._viewOptions.axisGridlineColor,\n    axisLabelColor:      this._viewOptions.axisLabelColor,\n    axisLabelFontFamily: this._viewOptions.fontFamily,\n    axisLabelFontSize:   this._viewOptions.fontSize,\n    axisLabelFontStyle:  this._viewOptions.fontStyle\n  });\n\n  this._axis.addToLayer(this._axisLayer);\n  this._stage.add(this._axisLayer);\n};\n\n/**\n * Scrolls the region of waveform shown in the view.\n *\n * @param {Number} scrollAmount How far to scroll, in pixels\n */\n\nWaveformZoomView.prototype.scrollWaveform = function(options) {\n  var scrollAmount;\n\n  if (objectHasProperty(options, 'pixels')) {\n    scrollAmount = Math.floor(options.pixels);\n  }\n  else if (objectHasProperty(options, 'seconds')) {\n    scrollAmount = this.timeToPixels(options.seconds);\n  }\n  else {\n    throw new TypeError('view.scrollWaveform(): Missing umber of pixels or seconds');\n  }\n\n  this._updateWaveform(this._frameOffset + scrollAmount);\n};\n\n/**\n * Updates the region of waveform shown in the view.\n *\n * @param {Number} frameOffset The new frame offset, in pixels.\n */\n\nWaveformZoomView.prototype._updateWaveform = function(frameOffset) {\n  var upperLimit;\n\n  if (this._pixelLength < this._width) {\n    // Total waveform is shorter than viewport, so reset the offset to 0.\n    frameOffset = 0;\n    upperLimit = this._width;\n  }\n  else {\n    // Calculate the very last possible position.\n    upperLimit = this._pixelLength - this._width;\n  }\n\n  frameOffset = clamp(frameOffset, 0, upperLimit);\n\n  this._frameOffset = frameOffset;\n\n  // Display playhead if it is within the zoom frame width.\n  var playheadPixel = this._playheadLayer.getPlayheadPixel();\n\n  this._playheadLayer.updatePlayheadTime(this.pixelsToTime(playheadPixel));\n\n  this._drawWaveformLayer();\n  this._axisLayer.draw();\n\n  var frameStartTime = this.getStartTime();\n  var frameEndTime   = this.getEndTime();\n\n  this._pointsLayer.updatePoints(frameStartTime, frameEndTime);\n  this._segmentsLayer.updateSegments(frameStartTime, frameEndTime);\n\n  this._peaks.emit('zoomview.displaying', frameStartTime, frameEndTime);\n};\n\nWaveformZoomView.prototype._drawWaveformLayer = function() {\n  this._waveformLayer.draw();\n};\n\nWaveformZoomView.prototype.setWaveformColor = function(color) {\n  this._waveformColor = color;\n  this._waveformShape.setWaveformColor(color);\n};\n\nWaveformZoomView.prototype.setPlayedWaveformColor = function(color) {\n  this._playedWaveformColor = color;\n\n  if (color) {\n    if (!this._playedWaveformShape) {\n      this._createWaveformShapes();\n    }\n\n    this._playedWaveformShape.setWaveformColor(color);\n  }\n  else {\n    if (this._playedWaveformShape) {\n      this._destroyPlayedWaveformShape();\n    }\n  }\n};\n\nWaveformZoomView.prototype.showPlayheadTime = function(show) {\n  this._playheadLayer.showPlayheadTime(show);\n};\n\nWaveformZoomView.prototype.setTimeLabelPrecision = function(precision) {\n  this._timeLabelPrecision = precision;\n  this._playheadLayer.updatePlayheadText();\n};\n\nWaveformZoomView.prototype.formatTime = function(time) {\n  return formatTime(time, this._timeLabelPrecision);\n};\n\nWaveformZoomView.prototype.enableAutoScroll = function(enable) {\n  this._enableAutoScroll = enable;\n};\n\nWaveformZoomView.prototype.enableMarkerEditing = function(enable) {\n  this._segmentsLayer.enableEditing(enable);\n  this._pointsLayer.enableEditing(enable);\n};\n\nWaveformZoomView.prototype.fitToContainer = function() {\n  if (this._container.clientWidth === 0 && this._container.clientHeight === 0) {\n    return;\n  }\n\n  var updateWaveform = false;\n\n  if (this._container.clientWidth !== this._width) {\n    this._width = this._container.clientWidth;\n    this._stage.width(this._width);\n\n    var resample = false;\n    var resampleOptions;\n\n    if (this._zoomLevelAuto) {\n      resample = true;\n      resampleOptions = { width: this._width };\n    }\n    else if (this._zoomLevelSeconds !== null) {\n      resample = true;\n      resampleOptions = { scale: this._getScale(this._zoomLevelSeconds) };\n    }\n\n    if (resample) {\n      try {\n        this._resampleData(resampleOptions);\n        updateWaveform = true;\n      }\n      catch (error) {\n        // Ignore, and leave this._data as it was\n      }\n    }\n  }\n\n  this._height = this._container.clientHeight;\n  this._stage.height(this._height);\n\n  this._waveformShape.fitToView();\n  this._playheadLayer.fitToView();\n  this._segmentsLayer.fitToView();\n  this._pointsLayer.fitToView();\n\n  if (updateWaveform) {\n    this._updateWaveform(this._frameOffset);\n  }\n\n  this._stage.draw();\n};\n\n/* WaveformZoomView.prototype.beginZoom = function() {\n  // Fade out the time axis and the segments\n  // this._axis.axisShape.setAttr('opacity', 0);\n\n  if (this._pointsLayer) {\n    this._pointsLayer.setVisible(false);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.setVisible(false);\n  }\n};\n\nWaveformZoomView.prototype.endZoom = function() {\n  if (this._pointsLayer) {\n    this._pointsLayer.setVisible(true);\n  }\n\n  if (this._segmentsLayer) {\n    this._segmentsLayer.setVisible(true);\n  }\n\n  var time = this._peaks.player.getCurrentTime();\n\n  this.seekFrame(this.timeToPixels(time));\n}; */\n\nWaveformZoomView.prototype.destroy = function() {\n  if (this._resizeTimeoutId) {\n    clearTimeout(this._resizeTimeoutId);\n    this._resizeTimeoutId = null;\n  }\n\n  // Unregister event handlers\n  this._peaks.off('player.timeupdate', this._onTimeUpdate);\n  this._peaks.off('player.playing', this._onPlaying);\n  this._peaks.off('player.pause', this._onPause);\n  this._peaks.off('window_resize', this._onWindowResize);\n  this._peaks.off('keyboard.left', this._onKeyboardLeft);\n  this._peaks.off('keyboard.right', this._onKeyboardRight);\n  this._peaks.off('keyboard.shift_left', this._onKeyboardShiftLeft);\n  this._peaks.off('keyboard.shift_right', this._onKeyboardShiftRight);\n\n  this._playheadLayer.destroy();\n  this._segmentsLayer.destroy();\n  this._pointsLayer.destroy();\n\n  if (this._stage) {\n    this._stage.destroy();\n    this._stage = null;\n  }\n};\n\nexport default WaveformZoomView;\n","/**\n * @file\n *\n * Defines the {@link ViewController} class.\n *\n * @module view-controller\n */\n\nimport WaveformOverview from './waveform-overview';\nimport WaveformZoomView from './waveform-zoomview';\nimport { isNullOrUndefined } from './utils';\n\n/**\n * Creates an object that allows users to create and manage waveform views.\n *\n * @class\n * @alias ViewController\n *\n * @param {Peaks} peaks\n */\n\nfunction ViewController(peaks) {\n  this._peaks = peaks;\n  this._overview = null;\n  this._zoomview = null;\n}\n\nViewController.prototype.createOverview = function(container) {\n  if (this._overview) {\n    return this._overview;\n  }\n\n  var waveformData = this._peaks.getWaveformData();\n\n  this._overview = new WaveformOverview(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  if (this._zoomview) {\n    this._overview.showHighlight(\n      this._zoomview.getStartTime(),\n      this._zoomview.getEndTime()\n    );\n  }\n\n  return this._overview;\n};\n\nViewController.prototype.createZoomview = function(container) {\n  if (this._zoomview) {\n    return this._zoomview;\n  }\n\n  var waveformData = this._peaks.getWaveformData();\n\n  this._zoomview = new WaveformZoomView(\n    waveformData,\n    container,\n    this._peaks\n  );\n\n  return this._zoomview;\n};\n\nViewController.prototype.destroyOverview = function() {\n  if (!this._overview) {\n    return;\n  }\n\n  if (!this._zoomview) {\n    return;\n  }\n\n  this._overview.destroy();\n  this._overview = null;\n};\n\nViewController.prototype.destroyZoomview = function() {\n  if (!this._zoomview) {\n    return;\n  }\n\n  if (!this._overview) {\n    return;\n  }\n\n  this._zoomview.destroy();\n  this._zoomview = null;\n\n  this._overview.removeHighlightRect();\n};\n\nViewController.prototype.destroy = function() {\n  if (this._overview) {\n    this._overview.destroy();\n    this._overview = null;\n  }\n\n  if (this._zoomview) {\n    this._zoomview.destroy();\n    this._zoomview = null;\n  }\n};\n\nViewController.prototype.getView = function(name) {\n  if (isNullOrUndefined(name)) {\n    if (this._overview && this._zoomview) {\n      return null;\n    }\n    else if (this._overview) {\n      return this._overview;\n    }\n    else if (this._zoomview) {\n      return this._zoomview;\n    }\n    else {\n      return null;\n    }\n  }\n  else {\n    switch (name) {\n      case 'overview':\n        return this._overview;\n\n      case 'zoomview':\n        return this._zoomview;\n\n      default:\n        return null;\n    }\n  }\n};\n\nexport default ViewController;\n","/**\n * @file\n *\n * Defines the {@link ZoomController} class.\n *\n * @module zoom-controller\n */\n\n/**\n * Creates an object to control zoom levels in a {@link WaveformZoomView}.\n *\n * @class\n * @alias ZoomController\n *\n * @param {Peaks} peaks\n * @param {Array<Integer>} zoomLevels\n */\n\nfunction ZoomController(peaks, zoomLevels) {\n  this._peaks = peaks;\n  this._zoomLevels = zoomLevels;\n  this._zoomLevelIndex = 0;\n}\n\nZoomController.prototype.setZoomLevels = function(zoomLevels) {\n  this._zoomLevels = zoomLevels;\n  this.setZoom(0, true);\n};\n\n/**\n * Zoom in one level.\n */\n\nZoomController.prototype.zoomIn = function() {\n  this.setZoom(this._zoomLevelIndex - 1);\n};\n\n/**\n * Zoom out one level.\n */\n\nZoomController.prototype.zoomOut = function() {\n  this.setZoom(this._zoomLevelIndex + 1);\n};\n\n/**\n * Given a particular zoom level, triggers a resampling of the data in the\n * zoomed view.\n *\n * @param {number} zoomLevelIndex An index into the options.zoomLevels array.\n */\n\nZoomController.prototype.setZoom = function(zoomLevelIndex, forceUpdate) {\n  if (zoomLevelIndex >= this._zoomLevels.length) {\n    zoomLevelIndex = this._zoomLevels.length - 1;\n  }\n\n  if (zoomLevelIndex < 0) {\n    zoomLevelIndex = 0;\n  }\n\n  if (!forceUpdate && (zoomLevelIndex === this._zoomLevelIndex)) {\n    // Nothing to do.\n    return;\n  }\n\n  this._zoomLevelIndex = zoomLevelIndex;\n\n  var zoomview = this._peaks.views.getView('zoomview');\n\n  if (!zoomview) {\n    return;\n  }\n\n  zoomview.setZoom({ scale: this._zoomLevels[zoomLevelIndex] });\n};\n\n/**\n * Returns the current zoom level index.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoom = function() {\n  return this._zoomLevelIndex;\n};\n\n/**\n * Returns the current zoom level, in samples per pixel.\n *\n * @returns {Number}\n */\n\nZoomController.prototype.getZoomLevel = function() {\n  return this._zoomLevels[this._zoomLevelIndex];\n};\n\nexport default ZoomController;\n","/**\n * @file\n *\n * Defines the {@link WaveformBuilder} class.\n *\n * @module waveform-builder\n */\n\nimport { isArrayBuffer, isObject, isString } from './utils';\nimport WaveformData from 'waveform-data';\n\nvar isXhr2 = ('withCredentials' in new XMLHttpRequest());\n\n/**\n * Creates and returns a WaveformData object, either by requesting the\n * waveform data from the server, or by creating the waveform data using the\n * Web Audio API.\n *\n * @class\n * @alias WaveformBuilder\n *\n * @param {Peaks} peaks\n */\n\nfunction WaveformBuilder(peaks) {\n  this._peaks = peaks;\n}\n\n/**\n * Options for requesting remote waveform data.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Options for supplying local waveform data.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Options for the Web Audio waveform builder.\n *\n * @typedef {Object} WaveformBuilderWebAudioOptions\n * @global\n * @property {AudioContext} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [WaveformBuilder.init]{@link WaveformBuilder#init}.\n *\n * @typedef {Object} WaveformBuilderInitOptions\n * @global\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WaveformBuilderWebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Callback for receiving the waveform data.\n *\n * @callback WaveformBuilderInitCallback\n * @global\n * @param {Error} error\n * @param {WaveformData} waveformData\n */\n\n/**\n * Loads or creates the waveform data.\n *\n * @private\n * @param {WaveformBuilderInitOptions} options\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype.init = function(options, callback) {\n  if ((options.dataUri && (options.webAudio || options.audioContext)) ||\n      (options.waveformData && (options.webAudio || options.audioContext)) ||\n      (options.dataUri && options.waveformData)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data.'));\n    return;\n  }\n\n  if (options.audioContext) {\n    // eslint-disable-next-line max-len\n    this._peaks.logger('Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead');\n\n    options.webAudio = {\n      audioContext: options.audioContext\n    };\n  }\n\n  if (options.dataUri) {\n    return this._getRemoteWaveformData(options, callback);\n  }\n  else if (options.waveformData) {\n    return this._buildWaveformFromLocalData(options, callback);\n  }\n  else if (options.webAudio) {\n    if (options.webAudio.audioBuffer) {\n      return this._buildWaveformDataFromAudioBuffer(options, callback);\n    }\n    else {\n      return this._buildWaveformDataUsingWebAudio(options, callback);\n    }\n  }\n  else {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data'));\n  }\n};\n\n/* eslint-disable max-len */\n\n/**\n * Fetches waveform data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {String|Object} options.dataUri\n * @param {String} options.dataUri.arraybuffer Waveform data URL\n *   (binary format)\n * @param {String} options.dataUri.json Waveform data URL (JSON format)\n * @param {String} options.defaultUriFormat Either 'arraybuffer' (for binary\n *   data) or 'json'\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._getRemoteWaveformData = function(options, callback) {\n  var self = this;\n  var dataUri = null;\n  var requestType = null;\n  var url;\n\n  if (isObject(options.dataUri)) {\n    dataUri = options.dataUri;\n  }\n  else if (isString(options.dataUri)) {\n    // Backward compatibility\n    dataUri = {};\n    dataUri[options.dataUriDefaultFormat || 'json'] = options.dataUri;\n  }\n  else {\n    callback(new TypeError('Peaks.init(): The dataUri option must be an object'));\n    return;\n  }\n\n  ['ArrayBuffer', 'JSON'].some(function(connector) {\n    if (window[connector]) {\n      requestType = connector.toLowerCase();\n      url = dataUri[requestType];\n\n      return Boolean(url);\n    }\n  });\n\n  if (!url) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible dataUri format for this browser'));\n    return;\n  }\n\n  var xhr = self._createXHR(url, requestType, options.withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    var waveformData = WaveformData.create(event.target.response);\n\n    if (waveformData.channels !== 1 && waveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (waveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, waveformData);\n  },\n  function() {\n    callback(new Error('XHR Failed'));\n  });\n\n  xhr.send();\n};\n\n/* eslint-disable max-len */\n\n/**\n * Creates a waveform from given data, based on the given options.\n *\n * @private\n * @param {Object} options\n * @param {Object} options.waveformData\n * @param {ArrayBuffer} options.waveformData.arraybuffer Waveform data (binary format)\n * @param {Object} options.waveformData.json Waveform data (JSON format)\n * @param {WaveformBuilderInitCallback} callback\n *\n * @see Refer to the <a href=\"https://github.com/bbc/audiowaveform/blob/master/doc/DataFormat.md\">data format documentation</a>\n *   for details of the binary and JSON waveform data formats.\n */\n\n/* eslint-enable max-len */\n\nWaveformBuilder.prototype._buildWaveformFromLocalData = function(options, callback) {\n  var waveformData = null;\n  var data = null;\n\n  if (isObject(options.waveformData)) {\n    waveformData = options.waveformData;\n  }\n  else {\n    callback(new Error('Peaks.init(): The waveformData option must be an object'));\n    return;\n  }\n\n  if (isObject(waveformData.json)) {\n    data = waveformData.json;\n  }\n  else if (isArrayBuffer(waveformData.arraybuffer)) {\n    data = waveformData.arraybuffer;\n  }\n\n  if (!data) {\n    // eslint-disable-next-line max-len\n    callback(new Error('Peaks.init(): Unable to determine a compatible waveformData format'));\n    return;\n  }\n\n  try {\n    var createdWaveformData = WaveformData.create(data);\n\n    if (createdWaveformData.channels !== 1 && createdWaveformData.channels !== 2) {\n      callback(new Error('Peaks.init(): Only mono or stereo waveforms are currently supported'));\n      return;\n    }\n    else if (createdWaveformData.bits !== 8) {\n      callback(new Error('Peaks.init(): 16-bit waveform data is not supported'));\n      return;\n    }\n\n    callback(null, createdWaveformData);\n  }\n  catch (err) {\n    callback(err);\n  }\n};\n\n/**\n * Creates waveform data using the Web Audio API.\n *\n * @private\n * @param {Object} options\n * @param {AudioContext} options.audioContext\n * @param {HTMLMediaElement} options.mediaElement\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._buildWaveformDataUsingWebAudio = function(options, callback) {\n  var self = this;\n\n  var audioContext = window.AudioContext || window.webkitAudioContext;\n\n  if (!(options.webAudio.audioContext instanceof audioContext)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): The webAudio.audioContext option must be a valid AudioContext'));\n    return;\n  }\n\n  var webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  // If the media element has already selected which source to play, its\n  // currentSrc attribute will contain the source media URL. Otherwise,\n  // we wait for a canplay event to tell us when the media is ready.\n\n  var mediaSourceUrl = self._peaks.options.mediaElement.currentSrc;\n\n  if (mediaSourceUrl) {\n    self._requestAudioAndBuildWaveformData(\n      mediaSourceUrl,\n      webAudioOptions,\n      options.withCredentials,\n      callback\n    );\n  }\n  else {\n    self._peaks.once('player.canplay', function() {\n      self._requestAudioAndBuildWaveformData(\n        self._peaks.options.mediaElement.currentSrc,\n        webAudioOptions,\n        options.withCredentials,\n        callback\n      );\n    });\n  }\n};\n\nWaveformBuilder.prototype._buildWaveformDataFromAudioBuffer = function(options, callback) {\n  var webAudioOptions = options.webAudio;\n\n  if (webAudioOptions.scale !== options.zoomLevels[0]) {\n    webAudioOptions.scale = options.zoomLevels[0];\n  }\n\n  var webAudioBuilderOptions = {\n    audio_buffer: webAudioOptions.audioBuffer,\n    split_channels: webAudioOptions.multiChannel,\n    scale: webAudioOptions.scale\n  };\n\n  WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n};\n\n/**\n * Fetches the audio content, based on the given options, and creates waveform\n * data using the Web Audio API.\n *\n * @private\n * @param {url} The media source URL\n * @param {WaveformBuilderWebAudioOptions} webAudio\n * @param {Boolean} withCredentials\n * @param {WaveformBuilderInitCallback} callback\n */\n\nWaveformBuilder.prototype._requestAudioAndBuildWaveformData = function(url,\n    webAudio, withCredentials, callback) {\n  var self = this;\n\n  if (!url) {\n    self._peaks.logger('Peaks.init(): The mediaElement src is invalid');\n    return;\n  }\n\n  var xhr = self._createXHR(url, 'arraybuffer', withCredentials, function(event) {\n    if (this.readyState !== 4) {\n      return;\n    }\n\n    if (this.status !== 200) {\n      callback(\n        new Error('Unable to fetch remote data. HTTP status ' + this.status)\n      );\n\n      return;\n    }\n\n    var webAudioBuilderOptions = {\n      audio_context: webAudio.audioContext,\n      array_buffer: event.target.response,\n      split_channels: webAudio.multiChannel,\n      scale: webAudio.scale\n    };\n\n    WaveformData.createFromAudio(webAudioBuilderOptions, callback);\n  },\n  function() {\n    callback(new Error('XHR Failed'));\n  });\n\n  xhr.send();\n};\n\n/**\n * @private\n * @param {String} url\n * @param {String} requestType\n * @param {Boolean} withCredentials\n * @param {Function} onLoad\n * @param {Function} onError\n *\n * @returns {XMLHttpRequest}\n */\n\nWaveformBuilder.prototype._createXHR = function(url, requestType,\n    withCredentials, onLoad, onError) {\n  var xhr = new XMLHttpRequest();\n\n  // open an XHR request to the data source file\n  xhr.open('GET', url, true);\n\n  if (isXhr2) {\n    try {\n      xhr.responseType = requestType;\n    }\n    catch (e) {\n      // Some browsers like Safari 6 do handle XHR2 but not the json\n      // response type, doing only a try/catch fails in IE9\n    }\n  }\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  if (isXhr2 && withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  return xhr;\n};\n\nexport default WaveformBuilder;\n","/**\n * @file\n *\n * Defines the {@link Peaks} class.\n *\n * @module main\n */\n\nimport EventEmitter from 'eventemitter3';\nimport CueEmitter from './cue-emitter';\nimport WaveformPoints from './waveform-points';\nimport WaveformSegments from './waveform-segments';\nimport KeyboardHandler from './keyboard-handler';\nimport MediaElementPlayer from './mediaelement-player';\nimport Player from './player';\nimport { createPointMarker, createSegmentMarker, createSegmentLabel } from './marker-factories';\nimport ViewController from './view-controller';\nimport ZoomController from './zoom-controller';\nimport WaveformBuilder from './waveform-builder';\nimport {\n  isHTMLElement, isFunction, isInAscendingOrder, isObject,\n  objectHasProperty\n} from './utils';\n\n/**\n * Initialises a new Peaks instance with default option settings.\n *\n * @class\n * @alias Peaks\n *\n * @param {Object} opts Configuration options\n */\n\nfunction Peaks() {\n  EventEmitter.call(this);\n\n  // Set default options\n  this.options = {\n    zoomLevels:              [512, 1024, 2048, 4096],\n\n    mediaElement:            null,\n    mediaUrl:                null,\n\n    dataUri:                 null,\n    dataUriDefaultFormat:    'json',\n    withCredentials:         false,\n\n    waveformData:            null,\n    webAudio:                null,\n\n    nudgeIncrement:          1.0,\n\n    segmentStartMarkerColor: '#aaaaaa',\n    segmentEndMarkerColor:   '#aaaaaa',\n    randomizeSegmentColor:   true,\n    segmentColor:            '#ff851b',\n    pointMarkerColor:        '#39cccc',\n\n    createSegmentMarker:     createSegmentMarker,\n    createSegmentLabel:      createSegmentLabel,\n    createPointMarker:       createPointMarker,\n\n    // eslint-disable-next-line no-console\n    logger:                  console.error.bind(console)\n  };\n\n  return this;\n}\n\nPeaks.prototype = Object.create(EventEmitter.prototype);\n\nvar defaultViewOptions = {\n  playheadColor:       '#111111',\n  playheadTextColor:   '#aaaaaa',\n  axisGridlineColor:   '#cccccc',\n  axisLabelColor:      '#aaaaaa',\n  fontFamily:          'sans-serif',\n  fontSize:            11,\n  fontStyle:           'normal',\n  timeLabelPrecision:  2\n};\n\nvar defaultZoomviewOptions = {\n  // showPlayheadTime:    true,\n  waveformColor:       'rgba(0, 225, 128, 1)',\n  wheelMode:           'none'\n  // zoomAdapter:         'static'\n};\n\nvar defaultOverviewOptions = {\n  // showPlayheadTime:    false,\n  waveformColor:       'rgba(0, 0, 0, 0.2)',\n  highlightColor:      '#aaaaaa',\n  highlightOffset:     11\n};\n\nfunction getOverviewOptions(opts) {\n  var overviewOptions = {};\n\n  if (opts.containers && opts.containers.overview) {\n    overviewOptions.container = opts.containers.overview;\n  }\n\n  if (opts.overviewWaveformColor) {\n    overviewOptions.waveformColor = opts.overviewWaveformColor;\n  }\n\n  if (opts.overviewHighlightOffset) {\n    overviewOptions.highlightOffset = opts.overviewHighlightOffset;\n  }\n\n  if (opts.overviewHighlightColor) {\n    overviewOptions.highlightColor = opts.overviewHighlightColor;\n  }\n\n  if (opts.overview && opts.overview.showPlayheadTime) {\n    overviewOptions.showPlayheadTime = opts.overview.showPlayheadTime;\n  }\n\n  var optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'axisLabelColor',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'highlightColor',\n    'highlightOffset'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.overview && objectHasProperty(opts.overview, optName)) {\n      overviewOptions[optName] = opts.overview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      overviewOptions[optName] = opts[optName];\n    }\n    else if (objectHasProperty(defaultOverviewOptions, optName)) {\n      overviewOptions[optName] = defaultOverviewOptions[optName];\n    }\n    else if (objectHasProperty(defaultViewOptions, optName)) {\n      overviewOptions[optName] = defaultViewOptions[optName];\n    }\n  });\n\n  return overviewOptions;\n}\n\nfunction getZoomviewOptions(opts) {\n  var zoomviewOptions = {};\n\n  if (opts.containers && opts.containers.zoomview) {\n    zoomviewOptions.container = opts.containers.zoomview;\n  }\n\n  if (opts.zoomWaveformColor) {\n    zoomviewOptions.waveformColor = opts.zoomWaveformColor;\n  }\n\n  if (opts.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.showPlayheadTime;\n  }\n  else if (opts.zoomview && opts.zoomview.showPlayheadTime) {\n    zoomviewOptions.showPlayheadTime = opts.zoomview.showPlayheadTime;\n  }\n\n  var optNames = [\n    'container',\n    'waveformColor',\n    'playedWaveformColor',\n    'playheadColor',\n    'playheadTextColor',\n    'timeLabelPrecision',\n    'axisGridlineColor',\n    'axisLabelColor',\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'wheelMode'\n  ];\n\n  optNames.forEach(function(optName) {\n    if (opts.zoomview && objectHasProperty(opts.zoomview, optName)) {\n      zoomviewOptions[optName] = opts.zoomview[optName];\n    }\n    else if (objectHasProperty(opts, optName)) {\n      zoomviewOptions[optName] = opts[optName];\n    }\n    else if (objectHasProperty(defaultZoomviewOptions, optName)) {\n      zoomviewOptions[optName] = defaultZoomviewOptions[optName];\n    }\n    else if (objectHasProperty(defaultViewOptions, optName)) {\n      zoomviewOptions[optName] = defaultViewOptions[optName];\n    }\n  });\n\n  return zoomviewOptions;\n}\n\nfunction extendOptions(to, from) {\n  for (var key in from) {\n    if (objectHasProperty(from, key) &&\n        objectHasProperty(to, key)) {\n      to[key] = from[key];\n    }\n  }\n\n  return to;\n}\n\n/**\n * Creates and initialises a new Peaks instance with the given options.\n *\n * @param {Object} opts Configuration options\n *\n * @return {Peaks}\n */\n\nPeaks.init = function(opts, callback) {\n  var instance = new Peaks();\n\n  var err = instance._setOptions(opts);\n\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  var zoomviewContainer = instance.options.zoomview.container;\n  var overviewContainer = instance.options.overview.container;\n\n  if (!isHTMLElement(zoomviewContainer) &&\n      !isHTMLElement(overviewContainer)) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): The zoomview and/or overview container options must be valid HTML elements'));\n    return;\n  }\n\n  if (zoomviewContainer && zoomviewContainer.clientWidth <= 0) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): Please ensure that the zoomview container is visible and has non-zero width'));\n    return;\n  }\n\n  if (overviewContainer && overviewContainer.clientWidth <= 0) {\n    // eslint-disable-next-line max-len\n    callback(new TypeError('Peaks.init(): Please ensure that the overview container is visible and has non-zero width'));\n    return;\n  }\n\n  if (opts.keyboard) {\n    instance._keyboardHandler = new KeyboardHandler(instance);\n  }\n\n  var player = opts.player ?\n    opts.player :\n    new MediaElementPlayer(instance, instance.options.mediaElement);\n\n  instance.player = new Player(instance, player);\n  instance.segments = new WaveformSegments(instance);\n  instance.points = new WaveformPoints(instance);\n  instance.zoom = new ZoomController(instance, instance.options.zoomLevels);\n  instance.views = new ViewController(instance);\n\n  // Setup the UI components\n  var waveformBuilder = new WaveformBuilder(instance);\n\n  waveformBuilder.init(instance.options, function(err, waveformData) {\n    if (err) {\n      if (callback) {\n        callback(err);\n      }\n\n      return;\n    }\n\n    instance._waveformData = waveformData;\n\n    if (overviewContainer) {\n      instance.views.createOverview(overviewContainer);\n    }\n\n    if (zoomviewContainer) {\n      instance.views.createZoomview(zoomviewContainer);\n    }\n\n    instance._addWindowResizeHandler();\n\n    if (opts.segments) {\n      instance.segments.add(opts.segments);\n    }\n\n    if (opts.points) {\n      instance.points.add(opts.points);\n    }\n\n    if (opts.emitCueEvents) {\n      instance._cueEmitter = new CueEmitter(instance);\n    }\n\n    // Allow applications to attach event handlers before emitting events,\n    // when initialising with local waveform data.\n\n    setTimeout(function() {\n      instance.emit('peaks.ready');\n    }, 0);\n\n    callback(null, instance);\n  });\n};\n\nPeaks.prototype._setOptions = function(opts) {\n  if (!isObject(opts)) {\n    return new TypeError('Peaks.init(): The options parameter should be an object');\n  }\n\n  if (!opts.player) {\n    if (!opts.mediaElement) {\n      return new Error('Peaks.init(): Missing mediaElement option');\n    }\n\n    if (!(opts.mediaElement instanceof HTMLMediaElement)) {\n      // eslint-disable-next-line max-len\n      return new TypeError('Peaks.init(): The mediaElement option should be an HTMLMediaElement');\n    }\n  }\n\n  if (opts.container) {\n    // eslint-disable-next-line max-len\n    return new Error('Peaks.init(): The container option has been removed, please use containers instead');\n  }\n\n  if (opts.logger && !isFunction(opts.logger)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): The logger option should be a function');\n  }\n\n  if (opts.segments && !Array.isArray(opts.segments)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.segments must be an array of segment objects');\n  }\n\n  if (opts.points && !Array.isArray(opts.points)) {\n    // eslint-disable-next-line max-len\n    return new TypeError('Peaks.init(): options.points must be an array of point objects');\n  }\n\n  extendOptions(this.options, opts);\n\n  this.options.overview = getOverviewOptions(opts);\n  this.options.zoomview = getZoomviewOptions(opts);\n\n  if (!Array.isArray(this.options.zoomLevels)) {\n    return new TypeError('Peaks.init(): The zoomLevels option should be an array');\n  }\n  else if (this.options.zoomLevels.length === 0) {\n    return new Error('Peaks.init(): The zoomLevels array must not be empty');\n  }\n  else {\n    if (!isInAscendingOrder(this.options.zoomLevels)) {\n      return new Error('Peaks.init(): The zoomLevels array must be sorted in ascending order');\n    }\n  }\n\n  if (opts.logger) {\n    this.logger = opts.logger;\n  }\n};\n\n/**\n * Remote waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} RemoteWaveformDataOptions\n * @global\n * @property {String=} arraybuffer\n * @property {String=} json\n */\n\n/**\n * Local waveform data options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} LocalWaveformDataOptions\n * @global\n * @property {ArrayBuffer=} arraybuffer\n * @property {Object=} json\n */\n\n/**\n * Web Audio options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} WebAudioOptions\n * @global\n * @property {AudioContext=} audioContext\n * @property {AudioBuffer=} audioBuffer\n * @property {Number=} scale\n * @property {Boolean=} multiChannel\n */\n\n/**\n * Options for [Peaks.setSource]{@link Peaks#setSource}.\n *\n * @typedef {Object} PeaksSetSourceOptions\n * @global\n * @property {String} mediaUrl\n * @property {RemoteWaveformDataOptions=} dataUri\n * @property {LocalWaveformDataOptions=} waveformData\n * @property {WebAudioOptions=} webAudio\n * @property {Boolean=} withCredentials\n * @property {Array<Number>=} zoomLevels\n */\n\n/**\n * Changes the audio or video media source associated with the {@link Peaks}\n * instance.\n *\n * @param {PeaksSetSourceOptions} options\n * @param {Function} callback\n */\n\nPeaks.prototype.setSource = function(options, callback) {\n  var self = this;\n\n  if (this.options.mediaElement && !options.mediaUrl) {\n    // eslint-disable-next-line max-len\n    callback(new Error('peaks.setSource(): options must contain a mediaUrl when using mediaElement'));\n    return;\n  }\n\n  function reset() {\n    self.removeAllListeners('player.canplay');\n    self.removeAllListeners('player.error');\n  }\n\n  function playerErrorHandler(err) {\n    reset();\n\n    // Return the MediaError object from the media element\n    callback(err);\n  }\n\n  function playerCanPlayHandler() {\n    reset();\n\n    if (!options.zoomLevels) {\n      options.zoomLevels = self.options.zoomLevels;\n    }\n\n    var waveformBuilder = new WaveformBuilder(self);\n\n    waveformBuilder.init(options, function(err, waveformData) {\n      if (err) {\n        callback(err);\n        return;\n      }\n\n      self._waveformData = waveformData;\n\n      ['overview', 'zoomview'].forEach(function(viewName) {\n        var view = self.views.getView(viewName);\n\n        if (view) {\n          view.setWaveformData(waveformData);\n        }\n      });\n\n      self.zoom.setZoomLevels(options.zoomLevels);\n\n      callback();\n    });\n  }\n\n  self.once('player.canplay', playerCanPlayHandler);\n  self.once('player.error', playerErrorHandler);\n\n  if (this.options.mediaElement) {\n    self.options.mediaElement.setAttribute('src', options.mediaUrl);\n  }\n  else {\n    playerCanPlayHandler();\n  }\n};\n\nPeaks.prototype.getWaveformData = function() {\n  return this._waveformData;\n};\n\nPeaks.prototype._addWindowResizeHandler = function() {\n  this._onResize = this._onResize.bind(this);\n  window.addEventListener('resize', this._onResize);\n};\n\nPeaks.prototype._onResize = function() {\n  this.emit('window_resize');\n};\n\nPeaks.prototype._removeWindowResizeHandler = function() {\n  window.removeEventListener('resize', this._onResize);\n};\n\n/**\n * Cleans up a Peaks instance after use.\n */\n\nPeaks.prototype.destroy = function() {\n  this._removeWindowResizeHandler();\n\n  if (this._keyboardHandler) {\n    this._keyboardHandler.destroy();\n  }\n\n  if (this.views) {\n    this.views.destroy();\n  }\n\n  if (this.player) {\n    this.player.destroy();\n  }\n\n  if (this._cueEmitter) {\n    this._cueEmitter.destroy();\n  }\n};\n\nexport default Peaks;\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","this","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","Cue","time","type","id","zeroPad","number","precision","toString","formatTime","result","fractionSeconds","Math","floor","pow","seconds","minutes","hours","join","clamp","value","min","max","objectHasProperty","object","field","extend","to","from","key","isNumber","isFinite","Infinity","isValidTime","Number","isObject","_typeof","isArray","isString","isNullOrUndefined","isBoolean","isHTMLElement","HTMLElement","isLinearGradientColor","linearGradientStart","linearGradientEnd","linearGradientColorStops","POINT","SEGMENT_START","SEGMENT_END","sorter","a","b","isHeadless","test","navigator","userAgent","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","eventTypes","forward","reverse","getPointOrSegment","peaks","cue","points","getPoint","segments","getSegment","Error","CueEmitter","_cues","_peaks","_previousTime","_updateCues","bind","_onPlaying","onPlaying","_onSeeked","onSeeked","_onTimeUpdate","onTimeUpdate","_onAnimationFrame","onAnimationFrame","_rAFHandle","_activeSegments","_attachEventHandlers","getSegmentIdComparator","segment","self","getPoints","getSegments","forEach","point","startTime","endTime","sort","player","getCurrentTime","_updateActiveSegments","_onUpdate","previousTime","start","end","step","isForward","marker","eventType","webdriver","document","visibilityState","isPlaying","isSeeking","activeSegments","getSegmentsAtTime","find","triggerUpdateOn","_detachEventHandlers","destroy","pointOptions","validatePoint","options","RangeError","labelText","editable","color","Point","_id","_time","_labelText","_color","_editable","_setUserData","WaveformPoints","_points","_pointsById","_pointIdCounter","indexOf","defineProperties","enumerable","get","update","opts","isVisible","_setTime","_getNextPointId","_addPoint","_createPoint","filter","add","arrayArgs","map","_findPoint","predicate","indexes","_removeIndexes","removed","index","itemRemoved","splice","_removePoints","remove","p","removeById","pointId","removeByTime","removeAll","segmentOptions","validateSegment","Segment","_startTime","_endTime","WaveformSegments","_segments","_segmentsById","_segmentIdCounter","_colorIndex","_setStartTime","_setEndTime","_getNextSegmentId","colors","_getSegmentColor","randomizeSegmentColor","segmentColor","_addSegment","_createSegment","_findSegment","_removeSegments","s","segmentId","fnFilter","nodes","keys","KeyboardHandler","eventEmitter","_handleKeyEvent","addEventListener","MediaElementPlayer","mediaElement","_listeners","_mediaElement","validateAdapter","adapter","allProperties","obj","getOwnPropertyNames","getPrototypeOf","getAllPropertiesFrom","method","includes","Player","_playingSegment","_segment","_loop","_playSegmentTimerCallback","_adapter","init","DefaultPointMarker","_options","DefaultSegmentMarker","createSegmentMarker","view","createSegmentLabel","Text","x","y","text","textAlign","fontFamily","fontSize","fontStyle","fill","createPointMarker","HighlightLayer","offset","_view","_offset","_layer","Konva","Layer","listening","_highlightRect","MouseDragHandler","stage","_stage","_handlers","_dragging","_mouseDown","_mouseUp","_mouseMove","_lastMouseClientX","PlayheadLayer","_player","_playheadPixel","_playheadLineAnimation","_playheadVisible","_playheadColor","playheadColor","_playheadTextColor","playheadTextColor","_playheadFontFamily","playheadFontFamily","_playheadFontSize","playheadFontSize","_playheadFontStyle","playheadFontStyle","_playheadLayer","_createPlayhead","showPlayheadTime","_createPlayheadText","fitToView","zoomLevelChanged","PointMarker","_point","_marker","_draggable","draggable","_onClick","onClick","_onDblClick","onDblClick","_onDragStart","onDragStart","_onDragMove","onDragMove","_onDragEnd","onDragEnd","_onMouseEnter","onMouseEnter","_onMouseLeave","onMouseLeave","_dragBoundFunc","_group","Group","dragBoundFunc","_bindDefaultEventHandlers","target","nodeName","preventDefault","keyCode","shiftKey","removeEventListener","_addMediaListener","callback","_duration","getDuration","_isPlaying","error","_interval","readyState","HTMLMediaElement","HAVE_NOTHING","load","play","pause","seeking","currentTime","duration","seek","logger","playSegment","loop","Promise","reject","group","_label","_handle","Rect","width","height","_line","Line","stroke","strokeWidth","layer","hide","bindEventHandlers","setX","getWidth","show","getHeight","timeUpdated","setText","xPosition","startMarker","addToStage","showHighlight","_createHighlightRect","_update","startOffset","timeToPixels","endOffset","setAttrs","opacity","cornerRadius","removeHighlight","updateHighlight","parent","getMarkerObject","attrs","touches","clientX","onMouseDown","mouseDownPosX","_getMousePosX","changedTouches","onMouseMove","mousePosX","cancelable","onMouseUp","getContainer","getBoundingClientRect","left","isDragging","pixelsPerSecond","_useAnimation","_start","stop","_playheadLine","_playheadText","_playheadGroup","align","updatePlayheadTime","_syncPlayhead","pixelIndex","frameOffset","getFrameOffset","playheadX","playheadTextWidth","getTextWidth","playheadPosChanged","lastPlayheadPosition","Animation","playheadPosition","getPlayheadOffset","getPlayheadPixel","updatePlayheadText","pos","getAbsolutePosition","addToLayer","getX","destroyChildren","PointsLayer","allowEditing","_allowEditing","_pointMarkers","_onPointsDrag","_onPointHandleClick","_onPointHandleDblClick","_onPointHandleDragStart","_onPointHandleDragMove","_onPointHandleDragEnd","_onPointHandleMouseEnter","_onPointHandleMouseLeave","_onPointsUpdate","_onPointsAdd","_onPointsRemove","_onPointsRemoveAll","SegmentMarker","_segmentShape","segmentShape","_startMarker","_onDrag","onDrag","WaveformShape","shapeOptions","startY","_height","endY","fillLinearGradientStartPointY","fillLinearGradientEndPointY","fillLinearGradientColorStops","_shape","Shape","sceneFunc","_sceneFunc","hitFunc","_waveformShapeHitFunc","enableEditing","enable","frameStartTime","getStartTime","frameEndTime","getEndTime","_removePoint","_addPointMarker","updatePoints","removeChildren","_updatePoint","_createPointMarker","pointMarkerColor","getName","pointMarker","markerX","pixelOffsetToTime","_removeInvisiblePoints","_findOrAddPointMarker","pointMarkerX","count","setVisible","visible","draw","limit","getEndMarker","getStartMarker","isStartMarker","setSegment","setWaveformColor","_drawWaveform","getWaveformData","waveformData","startPixels","endPixels","channels","waveformTop","waveformHeight","_drawChannel","channel","top","amplitude","lineX","lineY","amplitudeScale","getAmplitudeScale","beginPath","min_sample","scaleY","lineTo","max_sample","closePath","fillShape","viewWidth","viewHeight","hitRectHeight","hitRectLeft","hitRectWidth","rect","fillStrokeShape","handler","scale","SegmentShape","_endMarker","_waveformShape","_onSegmentHandleDrag","_onSegmentHandleDragStart","_onSegmentHandleDragEnd","_createMarkers","SegmentsLayer","_segmentShapes","_onSegmentsUpdate","_onSegmentsAdd","_onSegmentsRemove","_onSegmentsRemoveAll","_onSegmentsDragged","WaveformAxis","_axisGridlineColor","axisGridlineColor","_axisLabelColor","axisLabelColor","_axisLabelFont","_buildFontString","axisLabelFontFamily","axisLabelFontSize","axisLabelFontStyle","_axisShape","drawAxis","WaveformOverview","container","_originalWaveformData","_container","_viewOptions","overview","_onPause","_onZoomviewDisplaying","_onWindowResize","_amplitudeScale","_timeLabelPrecision","timeLabelPrecision","_width","clientWidth","clientHeight","_data","resample","showWarnings","_resizeTimeoutId","Stage","_waveformLayer","_waveformColor","waveformColor","_playedWaveformColor","playedWaveformColor","_createWaveform","_segmentsLayer","_pointsLayer","_highlightLayer","highlightOffset","highlightColor","_createAxisLabels","_mouseDragHandler","pixelsToTime","_getDuration","WaveformZoomView","zoomview","_onKeyboardLeft","_onKeyboardRight","_onKeyboardShiftLeft","_onKeyboardShiftRight","_enableAutoScroll","_pixelLength","initialZoomLevel","zoom","getZoomLevel","_zoomLevelAuto","_zoomLevelSeconds","_resampleData","_frameOffset","initialFrameOffset","mouseDownX","diff","newFrameOffset","_updateWaveform","_onWheel","setWheelMode","wheelMode","ViewController","_overview","_zoomview","ZoomController","zoomLevels","_zoomLevels","_zoomLevelIndex","updatePosition","segmentStartOffset","segmentEndOffset","frameStartOffset","startPixel","endPixel","isEditingEnabled","segmentStartMarkerColor","endMarker","segmentEndMarkerColor","moveToTop","segmentMarker","startMarkerX","endMarkerX","startMarkerOffset","endMarkerOffset","redraw","_removeSegment","_addSegmentShape","updateSegments","_updateSegment","_createSegmentShape","_removeInvisibleSegments","_findOrAddSegmentShape","getAxisLabelScale","secs","baseSecs","steps","currentFrameStartTime","axisLabelIntervalSecs","firstAxisLabelSecs","multiple","multiplier","ceil","roundUpToNearest","axisLabelOffsetSecs","axisLabelOffsetPixels","setAttr","moveTo","label","labelX","measureText","labelY","fillText","_clickHandler","eventName","layerX","clearTimeout","setWidth","setTimeout","setWaveformData","_playedWaveformShape","_playedSegment","_unplayedSegment","sample_rate","pixels","setAmplitudeScale","_createWaveformShapes","_destroyPlayedWaveformShape","_axisLayer","_axis","removeHighlightRect","playheadTime","setPlayedWaveformColor","setTimeLabelPrecision","enableMarkerEditing","fitToContainer","updateWaveform","setHeight","mode","_wheelMode","wheelEvent","delta","deltaY","deltaX","offAxisDelta","abs","_keyboardScroll","direction","large","increment","nudgeIncrement","scrollWaveform","_drawWaveformLayer","_getScale","setZoom","isAutoScale","apexTime","playheadOffsetPixels","prevScale","_scale","apexPixel","setStartTime","scrollAmount","upperLimit","playheadPixel","enableAutoScroll","resampleOptions","createOverview","createZoomview","destroyOverview","destroyZoomview","getView","setZoomLevels","zoomIn","zoomOut","zoomLevelIndex","forceUpdate","views","getZoom","isXhr2","XMLHttpRequest","WaveformBuilder","Peaks","mediaUrl","dataUri","dataUriDefaultFormat","withCredentials","webAudio","console","audioContext","_getRemoteWaveformData","_buildWaveformFromLocalData","audioBuffer","_buildWaveformDataFromAudioBuffer","_buildWaveformDataUsingWebAudio","url","requestType","some","connector","toLowerCase","Boolean","_createXHR","status","WaveformData","response","bits","send","data","json","arraybuffer","createdWaveformData","err","AudioContext","webkitAudioContext","webAudioOptions","mediaSourceUrl","currentSrc","_requestAudioAndBuildWaveformData","webAudioBuilderOptions","audio_buffer","split_channels","multiChannel","createFromAudio","audio_context","array_buffer","onLoad","onError","xhr","open","responseType","e","onload","onerror","defaultViewOptions","defaultZoomviewOptions","defaultOverviewOptions","instance","_setOptions","zoomviewContainer","overviewContainer","keyboard","_keyboardHandler","_waveformData","_addWindowResizeHandler","emitCueEvents","_cueEmitter","extendOptions","overviewOptions","containers","overviewWaveformColor","overviewHighlightOffset","overviewHighlightColor","optName","getOverviewOptions","zoomviewOptions","zoomWaveformColor","getZoomviewOptions","array","isInAscendingOrder","setSource","reset","playerCanPlayHandler","viewName","setAttribute","_onResize","_removeWindowResizeHandler"],"mappings":"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"}