import{Line as e}from"konva/lib/shapes/Line";import{Rect as t}from"konva/lib/shapes/Rect";import{Text as i}from"konva/lib/shapes/Text";import o from"konva/lib/Core";import{Animation as n}from"konva/lib/Animation";import s from"waveform-data";var a={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function o(){}function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,o,s,a){if("function"!=typeof o)throw new TypeError("The listener must be a function");var r=new n(o,s||e,a),h=i?i+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],r]:e._events[h].push(r):(e._events[h]=r,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function r(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),r.prototype.eventNames=function(){var e,o,n=[];if(0===this._eventsCount)return n;for(o in e=this._events)t.call(e,o)&&n.push(i?o.slice(1):o);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},r.prototype.listeners=function(e){var t=i?i+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,s=o.length,a=new Array(s);n<s;n++)a[n]=o[n].fn;return a},r.prototype.listenerCount=function(e){var t=i?i+e:e,o=this._events[t];return o?o.fn?1:o.length:0},r.prototype.emit=function(e,t,o,n,s,a){var r=i?i+e:e;if(!this._events[r])return!1;var h,l,p=this._events[r],_=arguments.length;if(p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),_){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,o),!0;case 4:return p.fn.call(p.context,t,o,n),!0;case 5:return p.fn.call(p.context,t,o,n,s),!0;case 6:return p.fn.call(p.context,t,o,n,s,a),!0}for(l=1,h=new Array(_-1);l<_;l++)h[l-1]=arguments[l];p.fn.apply(p.context,h)}else{var d,m=p.length;for(l=0;l<m;l++)switch(p[l].once&&this.removeListener(e,p[l].fn,void 0,!0),_){case 1:p[l].fn.call(p[l].context);break;case 2:p[l].fn.call(p[l].context,t);break;case 3:p[l].fn.call(p[l].context,t,o);break;case 4:p[l].fn.call(p[l].context,t,o,n);break;default:if(!h)for(d=1,h=new Array(_-1);d<_;d++)h[d-1]=arguments[d];p[l].fn.apply(p[l].context,h)}}return!0},r.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},r.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},r.prototype.removeListener=function(e,t,o,n){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var r=this._events[s];if(r.fn)r.fn!==t||n&&!r.once||o&&r.context!==o||a(this,s);else{for(var h=0,l=[],p=r.length;h<p;h++)(r[h].fn!==t||n&&!r[h].once||o&&r[h].context!==o)&&l.push(r[h]);l.length?this._events[s]=1===l.length?l[0]:l:a(this,s)}return this},r.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&a(this,t)):(this._events=new o,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=i,r.EventEmitter=r,e.exports=r}(a);var r=a.exports;function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,i){this.time=e,this.type=t,this.id=i}function p(e,t){for(e=e.toString();e.length<t;)e="0"+e;return e}function _(e,t){var i=[],o=Math.floor(e%1*Math.pow(10,t)),n=Math.floor(e),s=Math.floor(n/60),a=Math.floor(s/60);a>0&&i.push(a),i.push(s%60),i.push(n%60);for(var r=0;r<i.length;r++)i[r]=p(i[r],2);return i=i.join(":"),t>0&&(i+="."+p(o,t)),i}function d(e,t,i){return e<t?t:e>i?i:e}function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){for(var i in t)m(t,i)&&(e[i]=t[i]);return e}function f(e){return"number"==typeof e}function y(e){return"number"==typeof e&&(e==e&&e!==1/0&&e!==-1/0)}function c(e){return"number"==typeof e&&Number.isFinite(e)}function g(e){return null!==e&&"object"===h(e)&&!Array.isArray(e)}function v(e){return"string"==typeof e}function w(e){return null==e}function T(e){return!0===e||!1===e}function b(e){return e instanceof HTMLElement}function k(e){return g(e)&&m(e,"linearGradientStart")&&m(e,"linearGradientEnd")&&m(e,"linearGradientColorStops")&&f(e.linearGradientStart)&&f(e.linearGradientEnd)&&function(e){return Array.isArray(e)}(e.linearGradientColorStops)&&2===e.linearGradientColorStops.length}l.POINT=0,l.SEGMENT_START=1,l.SEGMENT_END=2,l.sorter=function(e,t){return e.time-t.time};var S=/HeadlessChrome/.test(navigator.userAgent);var P=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,L=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,x={forward:{},reverse:{}};x.forward[l.POINT]=0,x.forward[l.SEGMENT_START]=1,x.forward[l.SEGMENT_END]=2,x.reverse[l.POINT]=0,x.reverse[l.SEGMENT_START]=2,x.reverse[l.SEGMENT_END]=1;var E={};function C(e,t){switch(t.type){case l.POINT:return e.points.getPoint(t.id);case l.SEGMENT_START:case l.SEGMENT_END:return e.segments.getSegment(t.id);default:throw new Error("getPointOrSegment: id not found?")}}function M(e){this._cues=[],this._peaks=e,this._previousTime=-1,this._updateCues=this._updateCues.bind(this),this._onPlaying=this.onPlaying.bind(this),this._onSeeked=this.onSeeked.bind(this),this._onTimeUpdate=this.onTimeUpdate.bind(this),this._onAnimationFrame=this.onAnimationFrame.bind(this),this._rAFHandle=null,this._activeSegments={},this._attachEventHandlers()}function D(e){return function(t){return t.id===e}}E[0]="points.enter",E[1]="segments.enter",E[2]="segments.exit",M.prototype._updateCues=function(){var e=this,t=e._peaks.points.getPoints(),i=e._peaks.segments.getSegments();e._cues.length=0,t.forEach((function(t){e._cues.push(new l(t.time,l.POINT,t.id))})),i.forEach((function(t){e._cues.push(new l(t.startTime,l.SEGMENT_START,t.id)),e._cues.push(new l(t.endTime,l.SEGMENT_END,t.id))})),e._cues.sort(l.sorter);var o=e._peaks.player.getCurrentTime();e._updateActiveSegments(o)},M.prototype._onUpdate=function(e,t){var i,o,n,s=e>t;s?(i=0,o=this._cues.length,n=1):(i=this._cues.length-1,o=-1,n=-1);for(var a=i;s?a<o:a>o;a+=n){var r=this._cues[a];if(s?r.time>t:r.time<t){if(s?r.time>e:r.time<e)break;var h=C(this._peaks,r),l=s?x.forward[r.type]:x.reverse[r.type];1===l?this._activeSegments[h.id]=h:2===l&&delete this._activeSegments[h.id],this._peaks.emit(E[l],h)}}},M.prototype.onTimeUpdate=function(e){(S||navigator.webdriver||"object"!==("undefined"==typeof document?"undefined":h(document))||!("visibilityState"in document)||"visible"!==document.visibilityState)&&(this._peaks.player.isPlaying()&&!this._peaks.player.isSeeking()&&this._onUpdate(e,this._previousTime),this._previousTime=e)},M.prototype.onAnimationFrame=function(){var e=this._peaks.player.getCurrentTime();this._peaks.player.isSeeking()||this._onUpdate(e,this._previousTime),this._previousTime=e,this._peaks.player.isPlaying()&&(this._rAFHandle=P(this._onAnimationFrame))},M.prototype.onPlaying=function(){this._previousTime=this._peaks.player.getCurrentTime(),this._rAFHandle=P(this._onAnimationFrame)},M.prototype.onSeeked=function(e){this._previousTime=e,this._updateActiveSegments(e)},M.prototype._updateActiveSegments=function(e){var t=this,i=t._peaks.segments.getSegmentsAtTime(e);for(var o in t._activeSegments){if(m(t._activeSegments,o))i.find(D(o))||(t._peaks.emit("segments.exit",t._activeSegments[o]),delete t._activeSegments[o])}i.forEach((function(e){e.id in t._activeSegments||(t._activeSegments[e.id]=e,t._peaks.emit("segments.enter",e))}))};var W=Array("points.update","points.dragmove","points.add","points.remove","points.remove_all","segments.update","segments.dragged","segments.add","segments.remove","segments.remove_all");M.prototype._attachEventHandlers=function(){this._peaks.on("player.timeupdate",this._onTimeUpdate),this._peaks.on("player.playing",this._onPlaying),this._peaks.on("player.seeked",this._onSeeked);for(var e=0;e<W.length;e++)this._peaks.on(W[e],this._updateCues);this._updateCues()},M.prototype._detachEventHandlers=function(){this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.seeked",this._onSeeked);for(var e=0;e<W.length;e++)this._peaks.off(W[e],this._updateCues)},M.prototype.destroy=function(){this._rAFHandle&&(L(this._rAFHandle),this._rAFHandle=null),this._detachEventHandlers(),this._previousTime=-1};var z=["peaks","id","time","labelText","color","editable"];function A(e,t){if(!c(e.time))throw new TypeError("peaks.points."+t+": time should be a numeric value");if(e.time<0)throw new RangeError("peaks.points."+t+": time should not be negative");if(w(e.labelText))e.labelText="";else if(!v(e.labelText))throw new TypeError("peaks.points."+t+": labelText must be a string");if(!T(e.editable))throw new TypeError("peaks.points."+t+": editable must be true or false");if(e.color&&!v(e.color)&&!k(e.color))throw new TypeError("peaks.points."+t+": color must be a string or a valid linear gradient object")}function H(e){A(e,"add()"),this._peaks=e.peaks,this._id=e.id,this._time=e.time,this._labelText=e.labelText,this._color=e.color,this._editable=e.editable,this._setUserData(e)}function O(e){this._peaks=e,this._points=[],this._pointsById={},this._pointIdCounter=0}H.prototype._setUserData=function(e){for(var t in e)m(e,t)&&-1===z.indexOf(t)&&(this[t]=e[t])},Object.defineProperties(H.prototype,{id:{enumerable:!0,get:function(){return this._id}},time:{enumerable:!0,get:function(){return this._time}},labelText:{get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}}),H.prototype.update=function(e){var t={time:this.time,labelText:this.labelText,color:this.color,editable:this.editable};u(t,e),A(t,"update()"),this._time=t.time,this._labelText=t.labelText,this._color=t.color,this._editable=t.editable,this._setUserData(e),this._peaks.emit("points.update",this)},H.prototype.isVisible=function(e,t){return this.time>=e&&this.time<t},H.prototype._setTime=function(e){this._time=e},O.prototype._getNextPointId=function(){return"peaks.point."+this._pointIdCounter++},O.prototype._addPoint=function(e){this._points.push(e),this._pointsById[e.id]=e},O.prototype._createPoint=function(e){var t={peaks:this._peaks};return u(t,e),w(t.id)&&(t.id=this._getNextPointId()),w(t.labelText)&&(t.labelText=""),w(t.editable)&&(t.editable=!1),new H(t)},O.prototype.getPoints=function(){return this._points},O.prototype.getPoint=function(e){return this._pointsById[e]||null},O.prototype.find=function(e,t){return this._points.filter((function(i){return i.isVisible(e,t)}))},O.prototype.add=function(){var e=this,t=Array.isArray(arguments[0]),i=t?arguments[0]:Array.prototype.slice.call(arguments);return(i=i.map((function(t){var i=e._createPoint(t);if(m(e._pointsById,i.id))throw new Error("peaks.points.add(): duplicate id");return i}))).forEach((function(t){e._addPoint(t)})),this._peaks.emit("points.add",i),t?i:i[0]},O.prototype._findPoint=function(e){for(var t=[],i=0,o=this._points.length;i<o;i++)e(this._points[i])&&t.push(i);return t},O.prototype._removeIndexes=function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i]-t.length,n=this._points.splice(o,1)[0];delete this._pointsById[n.id],t.push(n)}return t},O.prototype._removePoints=function(e){var t=this._findPoint(e),i=this._removeIndexes(t);return this._peaks.emit("points.remove",i),i},O.prototype.remove=function(e){return this._removePoints((function(t){return t===e}))},O.prototype.removeById=function(e){return this._removePoints((function(t){return t.id===e}))},O.prototype.removeByTime=function(e){return this._removePoints((function(t){return t.time===e}))},O.prototype.removeAll=function(){this._points=[],this._pointsById={},this._peaks.emit("points.remove_all")};var F=["peaks","id","startTime","endTime","labelText","color","editable"];function R(e,t){if(!c(e.startTime))throw new TypeError("peaks.segments."+t+": startTime should be a valid number");if(!c(e.endTime))throw new TypeError("peaks.segments."+t+": endTime should be a valid number");if(e.startTime<0)throw new RangeError("peaks.segments."+t+": startTime should not be negative");if(e.endTime<0)throw new RangeError("peaks.segments."+t+": endTime should not be negative");if(e.endTime<e.startTime)throw new RangeError("peaks.segments."+t+": endTime should not be less than startTime");if(w(e.labelText))e.labelText="";else if(!v(e.labelText))throw new TypeError("peaks.segments."+t+": labelText must be a string");if(!T(e.editable))throw new TypeError("peaks.segments."+t+": editable must be true or false");if(e.color&&!v(e.color)&&!k(e.color))throw new TypeError("peaks.segments."+t+": color must be a string or a valid linear gradient object")}function U(e){R(e,"add()"),this._peaks=e.peaks,this._id=e.id,this._startTime=e.startTime,this._endTime=e.endTime,this._labelText=e.labelText,this._color=e.color,this._editable=e.editable,this._setUserData(e)}function I(e){this._peaks=e,this._segments=[],this._segmentsById={},this._segmentIdCounter=0,this._colorIndex=0}U.prototype._setUserData=function(e){for(var t in e)m(e,t)&&-1===F.indexOf(t)&&(this[t]=e[t])},Object.defineProperties(U.prototype,{id:{enumerable:!0,get:function(){return this._id}},startTime:{enumerable:!0,get:function(){return this._startTime}},endTime:{enumerable:!0,get:function(){return this._endTime}},labelText:{enumerable:!0,get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}}),U.prototype.update=function(e){var t={startTime:this.startTime,endTime:this.endTime,labelText:this.labelText,color:this.color,editable:this.editable};u(t,e),R(t,"update()"),this._startTime=t.startTime,this._endTime=t.endTime,this._labelText=t.labelText,this._color=t.color,this._editable=t.editable,this._setUserData(e),this._peaks.emit("segments.update",this)},U.prototype.isVisible=function(e,t){return this.startTime<t&&e<this.endTime},U.prototype._setStartTime=function(e){this._startTime=e},U.prototype._setEndTime=function(e){this._endTime=e},I.prototype._getNextSegmentId=function(){return"peaks.segment."+this._segmentIdCounter++};var G=["#001f3f","#0074d9","#7fdbff","#39cccc","#ffdc00","#ff851b","#ff4136","#85144b","#f012be","#b10dc9"];I.prototype._getSegmentColor=function(){return this._peaks.options.randomizeSegmentColor?(++this._colorIndex===G.length&&(this._colorIndex=0),G[this._colorIndex]):this._peaks.options.segmentColor},I.prototype._addSegment=function(e){this._segments.push(e),this._segmentsById[e.id]=e},I.prototype._createSegment=function(e){if(!g(e))throw new TypeError("peaks.segments.add(): expected a Segment object parameter");var t={peaks:this._peaks};return u(t,e),w(t.id)&&(t.id=this._getNextSegmentId()),w(t.color)&&(t.color=this._getSegmentColor()),w(t.labelText)&&(t.labelText=""),w(t.editable)&&(t.editable=!1),new U(t)},I.prototype.getSegments=function(){return this._segments},I.prototype.getSegment=function(e){return this._segmentsById[e]||null},I.prototype.getSegmentsAtTime=function(e){return this._segments.filter((function(t){return e>=t.startTime&&e<t.endTime}))},I.prototype.find=function(e,t){return this._segments.filter((function(i){return i.isVisible(e,t)}))},I.prototype.add=function(){var e=this,t=Array.isArray(arguments[0]),i=t?arguments[0]:Array.prototype.slice.call(arguments);return(i=i.map((function(t){var i=e._createSegment(t);if(m(e._segmentsById,i.id))throw new Error("peaks.segments.add(): duplicate id");return i}))).forEach((function(t){e._addSegment(t)})),this._peaks.emit("segments.add",i),t?i:i[0]},I.prototype._findSegment=function(e){for(var t=[],i=0,o=this._segments.length;i<o;i++)e(this._segments[i])&&t.push(i);return t},I.prototype._removeIndexes=function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i]-t.length,n=this._segments.splice(o,1)[0];delete this._segmentsById[n.id],t.push(n)}return t},I.prototype._removeSegments=function(e){var t=this._findSegment(e),i=this._removeIndexes(t);return this._peaks.emit("segments.remove",i),i},I.prototype.remove=function(e){return this._removeSegments((function(t){return t===e}))},I.prototype.removeById=function(e){return this._removeSegments((function(t){return t.id===e}))},I.prototype.removeByTime=function(e,t){var i;return i=(t="number"==typeof t?t:0)>0?function(i){return i.startTime===e&&i.endTime===t}:function(t){return t.startTime===e},this._removeSegments(i)},I.prototype.removeAll=function(){this._segments=[],this._segmentsById={},this._peaks.emit("segments.remove_all")};var V=["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"],X=[32,9,37,39];function B(e){this.eventEmitter=e,this._handleKeyEvent=this._handleKeyEvent.bind(this),document.addEventListener("keydown",this._handleKeyEvent),document.addEventListener("keypress",this._handleKeyEvent),document.addEventListener("keyup",this._handleKeyEvent)}function N(e,t){var i=this;i._peaks=e,i._listeners=[],i._mediaElement=t}function K(e){var t=function(e){for(var t=[],i=e;i;)Object.getOwnPropertyNames(i).forEach((function(e){t.push(e)})),i=Object.getPrototypeOf(i);return t}(e);["init","destroy","play","pause","isPlaying","isSeeking","getCurrentTime","getDuration","seek"].forEach((function(i){if(!t.includes(i))throw new TypeError("Peaks.init(): Player method "+i+" is undefined");if("function"!=typeof e[i])throw new TypeError("Peaks.init(): Player method "+i+" is not a function")}))}function j(e,t){this._peaks=e,this._playingSegment=!1,this._segment=null,this._loop=!1,this._playSegmentTimerCallback=this._playSegmentTimerCallback.bind(this),K(t),this._adapter=t,this._adapter.init(e)}function Z(e){this._options=e}function Y(e){this._options=e}function q(e){return"zoomview"===e.view?new Y(e):null}function J(e){return new i({x:12,y:12,text:e.segment.labelText,textAlign:"center",fontFamily:e.fontFamily||"sans-serif",fontSize:e.fontSize||12,fontStyle:e.fontStyle||"normal",fill:"#000"})}function Q(e){return new Z(e)}function $(e,t,i){this._view=e,this._offset=t,this._color=i,this._layer=new o.Layer({listening:!1}),this._highlightRect=null,this._startTime=null,this._endTime=null}function ee(e,t){this._stage=e,this._handlers=t,this._dragging=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseMove=this._mouseMove.bind(this),this._stage.on("mousedown",this._mouseDown),this._stage.on("touchstart",this._mouseDown),this._lastMouseClientX=null}function te(e){this._player=e.player,this._view=e.view,this._playheadPixel=0,this._playheadLineAnimation=null,this._playheadVisible=!1,this._playheadColor=e.playheadColor,this._playheadTextColor=e.playheadTextColor,this._playheadFontFamily=e.playheadFontFamily,this._playheadFontSize=e.playheadFontSize,this._playheadFontStyle=e.playheadFontStyle,this._playheadLayer=new o.Layer,this._createPlayhead(this._playheadColor),e.showPlayheadTime&&this._createPlayheadText(this._playheadTextColor),this.fitToView(),this.zoomLevelChanged()}function ie(e){this._point=e.point,this._marker=e.marker,this._draggable=e.draggable,this._onClick=e.onClick,this._onDblClick=e.onDblClick,this._onDragStart=e.onDragStart,this._onDragMove=e.onDragMove,this._onDragEnd=e.onDragEnd,this._onMouseEnter=e.onMouseEnter,this._onMouseLeave=e.onMouseLeave,this._dragBoundFunc=this._dragBoundFunc.bind(this),this._group=new o.Group({draggable:this._draggable,dragBoundFunc:this._dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}B.prototype._handleKeyEvent=function(e){if(-1===V.indexOf(e.target.nodeName))if(X.indexOf(e.type)>-1&&e.preventDefault(),"keydown"===e.type||"keypress"===e.type)switch(e.keyCode){case 32:this.eventEmitter.emit("keyboard.space");break;case 9:this.eventEmitter.emit("keyboard.tab")}else if("keyup"===e.type)switch(e.keyCode){case 37:e.shiftKey?this.eventEmitter.emit("keyboard.shift_left"):this.eventEmitter.emit("keyboard.left");break;case 39:e.shiftKey?this.eventEmitter.emit("keyboard.shift_right"):this.eventEmitter.emit("keyboard.right")}},B.prototype.destroy=function(){document.removeEventListener("keydown",this._handleKeyEvent),document.removeEventListener("keypress",this._handleKeyEvent),document.removeEventListener("keyup",this._handleKeyEvent)},N.prototype._addMediaListener=function(e,t){this._listeners.push({type:e,callback:t}),this._mediaElement.addEventListener(e,t)},N.prototype.init=function(e){var t=this;t._player=e,t._listeners=[],t._duration=t.getDuration(),t._isPlaying=!1,t._addMediaListener("timeupdate",(function(){t._peaks.emit("player.timeupdate",t.getCurrentTime())})),t._addMediaListener("playing",(function(){t._isPlaying=!0,t._peaks.emit("player.playing",t.getCurrentTime())})),t._addMediaListener("pause",(function(){t._isPlaying=!1,t._peaks.emit("player.pause",t.getCurrentTime())})),t._addMediaListener("ended",(function(){t._peaks.emit("player.ended")})),t._addMediaListener("seeked",(function(){t._peaks.emit("player.seeked",t.getCurrentTime())})),t._addMediaListener("canplay",(function(){t._peaks.emit("player.canplay")})),t._addMediaListener("error",(function(e){t._peaks.emit("player.error",e.target.error)})),t._interval=null,t._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING&&t._mediaElement.load()},N.prototype.destroy=function(){for(var e=0;e<this._listeners.length;e++){var t=this._listeners[e];this._mediaElement.removeEventListener(t.type,t.callback)}this._listeners.length=0,this._mediaElement=null},N.prototype.play=function(){return this._mediaElement.play()},N.prototype.pause=function(){this._mediaElement.pause()},N.prototype.isPlaying=function(){return this._isPlaying},N.prototype.isSeeking=function(){return this._mediaElement.seeking},N.prototype.getCurrentTime=function(){return this._mediaElement.currentTime},N.prototype.getDuration=function(){return this._mediaElement.duration},N.prototype.seek=function(e){this._mediaElement.currentTime=e},j.prototype.destroy=function(){this._adapter.destroy()},j.prototype.play=function(){return this._adapter.play()},j.prototype.pause=function(){this._adapter.pause()},j.prototype.isPlaying=function(){return this._adapter.isPlaying()},j.prototype.isSeeking=function(){return this._adapter.isSeeking()},j.prototype.getCurrentTime=function(){return this._adapter.getCurrentTime()},j.prototype.getDuration=function(){return this._adapter.getDuration()},j.prototype.seek=function(e){c(e)?this._adapter.seek(e):this._peaks.logger("peaks.player.seek(): parameter must be a valid time, in seconds")},j.prototype.playSegment=function(e,t){var i=this;return e&&c(e.startTime)&&c(e.endTime)?(i._segment=e,i._loop=t,i.seek(e.startTime),i._peaks.once("player.playing",(function(){i._playingSegment||(i._playingSegment=!0,window.requestAnimationFrame(i._playSegmentTimerCallback))})),i.play()):Promise.reject(new Error("peaks.player.playSegment(): parameter must be a segment object"))},j.prototype._playSegmentTimerCallback=function(){if(this.isPlaying()){if(this.getCurrentTime()>=this._segment.endTime){if(!this._loop)return this.pause(),this._peaks.emit("player.ended"),void(this._playingSegment=!1);this.seek(this._segment.startTime)}window.requestAnimationFrame(this._playSegmentTimerCallback)}else this._playingSegment=!1},Z.prototype.init=function(o){"zoomview"===this._options.view&&(this._label=new i({x:2,y:0,text:this._options.point.labelText,textAlign:"left",fontFamily:this._options.fontFamily||"sans-serif",fontSize:this._options.fontSize||10,fontStyle:this._options.fontStyle||"normal",fill:"#000"})),this._options.draggable&&(this._handle=new t({x:-4.5,y:0,width:10,height:20,fill:this._options.color})),this._line=new e({x:0,y:0,stroke:this._options.color,strokeWidth:1}),this._handle&&(this._time=new i({x:-24,y:0,text:this._options.layer.formatTime(this._options.point.time),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._time.hide()),this._handle&&o.add(this._handle),o.add(this._line),this._label&&o.add(this._label),this._time&&o.add(this._time),this.fitToView(),this.bindEventHandlers(o)},Z.prototype.bindEventHandlers=function(e){var t=this;t._handle&&(t._handle.on("mouseover touchstart",(function(){t._time.setX(-24-t._time.getWidth()),t._time.show()})),t._handle.on("mouseout touchend",(function(){t._time.hide()})),e.on("dragstart",(function(){t._time.setX(-24-t._time.getWidth()),t._time.show()})),e.on("dragend",(function(){t._time.hide()})))},Z.prototype.fitToView=function(){var e=this._options.layer.getHeight();this._line.points([.5,0,.5,e]),this._label&&this._label.y(12),this._handle&&this._handle.y(e/2-10.5),this._time&&this._time.y(e/2-5)},Z.prototype.timeUpdated=function(e){this._time&&this._time.setText(this._options.layer.formatTime(e))},Y.prototype.init=function(o){var n=this._options.startMarker?-24:24,s=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new i({x:n,y:0,text:this._options.layer.formatTime(s),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._label.hide(),this._handle=new t({x:-4.5,y:0,width:10,height:20,fill:this._options.color,stroke:this._options.color,strokeWidth:1}),this._line=new e({x:0,y:0,stroke:this._options.color,strokeWidth:1}),o.add(this._label),o.add(this._line),o.add(this._handle),this.fitToView(),this.bindEventHandlers(o)},Y.prototype.bindEventHandlers=function(e){var t=this,i=t._options.startMarker?-24:24;t._options.draggable&&(e.on("dragstart",(function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()})),e.on("dragend",(function(){t._label.hide()}))),t._handle.on("mouseover touchstart",(function(){t._options.startMarker&&t._label.setX(i-t._label.getWidth()),t._label.show()})),t._handle.on("mouseout touchend",(function(){t._label.hide()}))},Y.prototype.fitToView=function(){var e=this._options.layer.getHeight();this._label.y(e/2-5),this._handle.y(e/2-10.5),this._line.points([.5,0,.5,e])},Y.prototype.timeUpdated=function(e){this._label.setText(this._options.layer.formatTime(e))},$.prototype.addToStage=function(e){e.add(this._layer)},$.prototype.showHighlight=function(e,t){this._highlightRect||this._createHighlightRect(e,t),this._update(e,t)},$.prototype._update=function(e,t){this._startTime=e,this._endTime=t;var i=this._view.timeToPixels(e),o=this._view.timeToPixels(t);this._highlightRect.setAttrs({x:i,width:o-i})},$.prototype._createHighlightRect=function(e,i){this._startTime=e,this._endTime=i;var o=this._view.timeToPixels(e),n=this._view.timeToPixels(i);this._highlightRect=new t({startOffset:0,y:0,width:n-o,stroke:this._color,strokeWidth:1,height:0,fill:this._color,opacity:.3,cornerRadius:2}),this.fitToView(),this._layer.add(this._highlightRect)},$.prototype.removeHighlight=function(){this._highlightRect&&(this._highlightRect.destroy(),this._highlightRect=null)},$.prototype.updateHighlight=function(){this._highlightRect&&this._update(this._startTime,this._endTime)},$.prototype.fitToView=function(){if(this._highlightRect){var e=this._view.getHeight(),t=d(this._offset,0,Math.floor(e/2));this._highlightRect.setAttrs({y:t,height:e-2*t})}},ee.prototype._mouseDown=function(e){var t=function(e){for(;null!==e.parent;){if(e.parent instanceof o.Layer)return e;e=e.parent}return null}(e.target);if(!t||!t.attrs.draggable){if(this._lastMouseClientX=Math.floor("touchstart"===e.type?e.evt.touches[0].clientX:e.evt.clientX),this._handlers.onMouseDown){var i=this._getMousePosX(this._lastMouseClientX);this._handlers.onMouseDown(i)}window.addEventListener("mousemove",this._mouseMove,!1),window.addEventListener("touchmove",this._mouseMove,!1),window.addEventListener("mouseup",this._mouseUp,!1),window.addEventListener("touchend",this._mouseUp,!1),window.addEventListener("blur",this._mouseUp,!1)}},ee.prototype._mouseMove=function(e){var t=Math.floor("touchmove"===e.type?e.changedTouches[0].clientX:e.clientX);if(t!==this._lastMouseClientX&&(this._lastMouseClientX=t,this._dragging=!0,this._handlers.onMouseMove)){var i=this._getMousePosX(t);this._handlers.onMouseMove(i)}},ee.prototype._mouseUp=function(e){var t;if("touchend"===e.type?(t=Math.floor(e.changedTouches[0].clientX),e.cancelable&&e.preventDefault()):t=Math.floor(e.clientX),this._handlers.onMouseUp){var i=this._getMousePosX(t);this._handlers.onMouseUp(i)}window.removeEventListener("mousemove",this._mouseMove,!1),window.removeEventListener("touchmove",this._mouseMove,!1),window.removeEventListener("mouseup",this._mouseUp,!1),window.removeEventListener("touchend",this._mouseUp,!1),window.removeEventListener("blur",this._mouseUp,!1),this._dragging=!1},ee.prototype._getMousePosX=function(e){return e-this._stage.getContainer().getBoundingClientRect().left},ee.prototype.isDragging=function(){return this._dragging},te.prototype.addToStage=function(e){e.add(this._playheadLayer)},te.prototype.zoomLevelChanged=function(){var e,t=this._view.timeToPixels(1);this._useAnimation=t>=5,this._useAnimation?this._player.isPlaying()&&!this._playheadLineAnimation&&this._start():this._playheadLineAnimation&&(e=this._player.getCurrentTime(),this.stop(e))},te.prototype.fitToView=function(){var e=this._view.getHeight();this._playheadLine.points([.5,0,.5,e]),this._playheadText&&this._playheadText.y(12)},te.prototype._createPlayhead=function(t){this._playheadLine=new e({stroke:t,strokeWidth:1}),this._playheadGroup=new o.Group({x:0,y:0}),this._playheadGroup.add(this._playheadLine),this._playheadLayer.add(this._playheadGroup)},te.prototype._createPlayheadText=function(e){var t=this._player.getCurrentTime(),o=this._view.formatTime(t);this._playheadText=new i({x:2,y:0,text:o,fontSize:this._playheadFontSize,fontFamily:this._playheadFontFamily,fontStyle:this._playheadFontStyle,fill:e,align:"right"}),this._playheadGroup.add(this._playheadText)},te.prototype.updatePlayheadTime=function(e){this._syncPlayhead(e),this._player.isPlaying()&&this._start()},te.prototype._syncPlayhead=function(e){var t=this._view.timeToPixels(e),i=this._view.getFrameOffset(),o=this._view.getWidth(),n=t>=i&&t<=i+o;if(this._playheadPixel=t,n){var s=this._playheadPixel-i;if(this._playheadVisible||(this._playheadVisible=!0,this._playheadGroup.show()),this._playheadGroup.setX(s),this._playheadText){var a=this._view.formatTime(e),r=this._playheadText.getTextWidth();this._playheadText.setText(a),r+s>o-2?this._playheadText.setX(-r-2):r+s<o&&this._playheadText.setX(2)}}else this._playheadVisible&&(this._playheadVisible=!1,this._playheadGroup.hide());this._view.playheadPosChanged&&this._view.playheadPosChanged(e)},te.prototype._start=function(){var e=this;if(e._playheadLineAnimation&&(e._playheadLineAnimation.stop(),e._playheadLineAnimation=null),e._useAnimation){var t=null;e._playheadLineAnimation=new n((function(){var i=e._player.getCurrentTime(),o=e._view.timeToPixels(i);o!==t&&(e._syncPlayhead(i),t=o)}),e._playheadLayer),e._playheadLineAnimation.start()}},te.prototype.stop=function(e){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null),this._syncPlayhead(e)},te.prototype.getPlayheadOffset=function(){return this._playheadPixel-this._view.getFrameOffset()},te.prototype.getPlayheadPixel=function(){return this._playheadPixel},te.prototype.showPlayheadTime=function(e){e?this._playheadText||(this._createPlayheadText(this._playheadTextColor),this.fitToView()):this._playheadText&&(this._playheadText.remove(),this._playheadText.destroy(),this._playheadText=null)},te.prototype.updatePlayheadText=function(){if(this._playheadText){var e=this._player.getCurrentTime(),t=this._view.formatTime(e);this._playheadText.setText(t)}},te.prototype.destroy=function(){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null)},ie.prototype._bindDefaultEventHandlers=function(){var e=this;e._group.on("dragstart",(function(){e._onDragStart(e._point)})),e._group.on("dragmove",(function(){e._onDragMove(e._point)})),e._group.on("dragend",(function(){e._onDragEnd(e._point)})),e._group.on("click",(function(){e._onClick(e._point)})),e._group.on("dblclick",(function(){e._onDblClick(e._point)})),e._group.on("mouseenter",(function(){e._onMouseEnter(e._point)})),e._group.on("mouseleave",(function(){e._onMouseLeave(e._point)}))},ie.prototype._dragBoundFunc=function(e){return{x:e.x,y:this._group.getAbsolutePosition().y}},ie.prototype.addToLayer=function(e){e.add(this._group)},ie.prototype.fitToView=function(){this._marker.fitToView()},ie.prototype.getPoint=function(){return this._point},ie.prototype.getX=function(){return this._group.getX()},ie.prototype.getWidth=function(){return this._group.getWidth()},ie.prototype.setX=function(e){this._group.setX(e)},ie.prototype.timeUpdated=function(e){this._marker.timeUpdated&&this._marker.timeUpdated(e)},ie.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()};function oe(e,t,i){this._peaks=e,this._view=t,this._allowEditing=i,this._pointMarkers={},this._layer=new o.Layer,this._onPointsDrag=this._onPointsDrag.bind(this),this._onPointHandleClick=this._onPointHandleClick.bind(this),this._onPointHandleDblClick=this._onPointHandleDblClick.bind(this),this._onPointHandleDragStart=this._onPointHandleDragStart.bind(this),this._onPointHandleDragMove=this._onPointHandleDragMove.bind(this),this._onPointHandleDragEnd=this._onPointHandleDragEnd.bind(this),this._onPointHandleMouseEnter=this._onPointHandleMouseEnter.bind(this),this._onPointHandleMouseLeave=this._onPointHandleMouseLeave.bind(this),this._onPointsUpdate=this._onPointsUpdate.bind(this),this._onPointsAdd=this._onPointsAdd.bind(this),this._onPointsRemove=this._onPointsRemove.bind(this),this._onPointsRemoveAll=this._onPointsRemoveAll.bind(this),this._peaks.on("points.update",this._onPointsUpdate),this._peaks.on("points.add",this._onPointsAdd),this._peaks.on("points.remove",this._onPointsRemove),this._peaks.on("points.remove_all",this._onPointsRemoveAll),this._peaks.on("points.dragstart",this._onPointsDrag),this._peaks.on("points.dragmove",this._onPointsDrag),this._peaks.on("points.dragend",this._onPointsDrag)}function ne(e){this._segment=e.segment,this._marker=e.marker,this._segmentShape=e.segmentShape,this._draggable=e.draggable,this._layer=e.layer,this._startMarker=e.startMarker,this._onDrag=e.onDrag,this._onDragStart=e.onDragStart,this._onDragEnd=e.onDragEnd,this._dragBoundFunc=this._dragBoundFunc.bind(this),this._group=new o.Group({draggable:this._draggable,dragBoundFunc:this._dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}function se(e){this._color=e.color;var t={};if(v(e.color))t.fill=e.color;else{if(!k(e.color))throw new TypeError("Unknown type for color property");var i=e.view._height*(e.color.linearGradientStart/100),n=e.view._height*(e.color.linearGradientEnd/100);t.fillLinearGradientStartPointY=i,t.fillLinearGradientEndPointY=n,t.fillLinearGradientColorStops=[0,e.color.linearGradientColorStops[0],1,e.color.linearGradientColorStops[1]]}this._shape=new o.Shape(t),this._view=e.view,this._segment=e.segment,this._shape.sceneFunc(this._sceneFunc.bind(this)),this._shape.hitFunc(this._waveformShapeHitFunc.bind(this))}oe.prototype.addToStage=function(e){e.add(this._layer)},oe.prototype.enableEditing=function(e){this._allowEditing=e},oe.prototype.formatTime=function(e){return this._view.formatTime(e)},oe.prototype._onPointsUpdate=function(e){var t=this._view.getStartTime(),i=this._view.getEndTime();this._removePoint(e),e.isVisible(t,i)&&this._addPointMarker(e),this.updatePoints(t,i)},oe.prototype._onPointsAdd=function(e){var t=this,i=t._view.getStartTime(),o=t._view.getEndTime();e.forEach((function(e){e.isVisible(i,o)&&t._addPointMarker(e)})),t.updatePoints(i,o)},oe.prototype._onPointsRemove=function(e){var t=this;e.forEach((function(e){t._removePoint(e)}))},oe.prototype._onPointsRemoveAll=function(){this._layer.removeChildren(),this._pointMarkers={}},oe.prototype._onPointsDrag=function(e){this._updatePoint(e)},oe.prototype._createPointMarker=function(e){var t=this._allowEditing&&e.editable;return new ie({point:e,draggable:t,marker:this._peaks.options.createPointMarker({point:e,draggable:t,color:e.color?e.color:this._peaks.options.pointMarkerColor,fontFamily:this._peaks.options.fontFamily||"sans-serif",fontSize:this._peaks.options.fontSize||10,fontStyle:this._peaks.options.fontStyle||"normal",layer:this,view:this._view.getName()}),onClick:this._onPointHandleClick,onDblClick:this._onPointHandleDblClick,onDragStart:this._onPointHandleDragStart,onDragMove:this._onPointHandleDragMove,onDragEnd:this._onPointHandleDragEnd,onMouseEnter:this._onPointHandleMouseEnter,onMouseLeave:this._onPointHandleMouseLeave})},oe.prototype.getHeight=function(){return this._view.getHeight()},oe.prototype._addPointMarker=function(e){var t=this._createPointMarker(e);return this._pointMarkers[e.id]=t,t.addToLayer(this._layer),t},oe.prototype._onPointHandleDragMove=function(e){var t=this._pointMarkers[e.id],i=t.getX();if(i>=0&&i<this._view.getWidth()){var o=i+t.getWidth();e._setTime(this._view.pixelOffsetToTime(o)),t.timeUpdated(e.time)}this._peaks.emit("points.dragmove",e)},oe.prototype._onPointHandleMouseEnter=function(e){this._peaks.emit("points.mouseenter",e)},oe.prototype._onPointHandleMouseLeave=function(e){this._peaks.emit("points.mouseleave",e)},oe.prototype._onPointHandleClick=function(e){this._peaks.emit("points.click",e)},oe.prototype._onPointHandleDblClick=function(e){this._peaks.emit("points.dblclick",e)},oe.prototype._onPointHandleDragStart=function(e){this._peaks.emit("points.dragstart",e)},oe.prototype._onPointHandleDragEnd=function(e){this._peaks.emit("points.dragend",e)},oe.prototype.updatePoints=function(e,t){this._peaks.points.find(e,t).forEach(this._updatePoint.bind(this)),this._removeInvisiblePoints(e,t)},oe.prototype._updatePoint=function(e){var t=this._findOrAddPointMarker(e),i=this._view.timeToPixels(e.time)-this._view.getFrameOffset();t.setX(i)},oe.prototype._findOrAddPointMarker=function(e){var t=this._pointMarkers[e.id];return t||(t=this._addPointMarker(e)),t},oe.prototype._removeInvisiblePoints=function(e,t){var i=0;for(var o in this._pointMarkers)if(m(this._pointMarkers,o)){var n=this._pointMarkers[o].getPoint();n.isVisible(e,t)||(this._removePoint(n),i++)}return i},oe.prototype._removePoint=function(e){var t=this._pointMarkers[e.id];t&&(t.destroy(),delete this._pointMarkers[e.id])},oe.prototype.setVisible=function(e){this._layer.setVisible(e)},oe.prototype.destroy=function(){this._peaks.off("points.update",this._onPointsUpdate),this._peaks.off("points.add",this._onPointsAdd),this._peaks.off("points.remove",this._onPointsRemove),this._peaks.off("points.remove_all",this._onPointsRemoveAll),this._peaks.off("points.dragstart",this._onPointsDrag),this._peaks.off("points.dragmove",this._onPointsDrag),this._peaks.off("points.dragend",this._onPointsDrag)},oe.prototype.fitToView=function(){for(var e in this._pointMarkers){if(m(this._pointMarkers,e))this._pointMarkers[e].fitToView()}},oe.prototype.draw=function(){this._layer.draw()},ne.prototype._bindDefaultEventHandlers=function(){var e=this;e._draggable&&(e._group.on("dragmove",(function(){e._onDrag(e)})),e._group.on("dragstart",(function(){e._onDragStart(e)})),e._group.on("dragend",(function(){e._onDragEnd(e)})))},ne.prototype._dragBoundFunc=function(e){var t,i;return this._startMarker?(i=(t=this._segmentShape.getEndMarker()).getX()-t.getWidth(),e.x>i&&(e.x=i)):(i=(t=this._segmentShape.getStartMarker()).getX()+t.getWidth(),e.x<i&&(e.x=i)),{x:e.x,y:this._group.getAbsolutePosition().y}},ne.prototype.addToLayer=function(e){e.add(this._group)},ne.prototype.fitToView=function(){this._marker.fitToView()},ne.prototype.getSegment=function(){return this._segment},ne.prototype.getX=function(){return this._group.getX()},ne.prototype.getWidth=function(){return this._group.getWidth()},ne.prototype.isStartMarker=function(){return this._startMarker},ne.prototype.setX=function(e){this._group.setX(e)},ne.prototype.timeUpdated=function(e){this._marker.timeUpdated&&this._marker.timeUpdated(e)},ne.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},se.prototype.setSegment=function(e){this._segment=e},se.prototype.setWaveformColor=function(e){if(v(e))this._shape.fill(e),this._shape.fillLinearGradientStartPointY(null),this._shape.fillLinearGradientEndPointY(null),this._shape.fillLinearGradientColorStops(null);else{if(!k(e))throw new TypeError("Unknown type for color property");this._shape.fill(null);var t=this._view._height*(e.linearGradientStart/100),i=this._view._height*(e.linearGradientEnd/100);this._shape.fillLinearGradientStartPointY(t),this._shape.fillLinearGradientEndPointY(i),this._shape.fillLinearGradientColorStops([0,e.linearGradientColorStops[0],1,e.linearGradientColorStops[1]])}},se.prototype.fitToView=function(){this.setWaveformColor(this._color)},se.prototype._sceneFunc=function(e){var t=this._view.getFrameOffset(),i=this._view.getWidth(),o=this._view.getHeight();this._drawWaveform(e,this._view.getWaveformData(),t,this._segment?this._view.timeToPixels(this._segment.startTime):t,this._segment?this._view.timeToPixels(this._segment.endTime):t+i,i,o)},se.prototype._drawWaveform=function(e,t,i,o,n,s,a){o<i&&(o=i);var r=i+s;n>r&&(n=r),n>t.length-1&&(n=t.length-1);for(var h=t.channels,l=0,p=Math.floor(a/h),_=0;_<h;_++)_===h-1&&(p=a-(h-1)*p),this._drawChannel(e,t.channel(_),i,o,n,l,p),l+=p},se.prototype._drawChannel=function(e,t,i,o,n,s,a){var r,h,l,p,_=this._view.getAmplitudeScale();for(e.beginPath(),r=o;r<=n;r++)h=t.min_sample(r),l=r-i+.5,p=s+se.scaleY(h,a,_)+.5,e.lineTo(l,p);for(r=n;r>=o;r--)h=t.max_sample(r),l=r-i+.5,p=s+se.scaleY(h,a,_)+.5,e.lineTo(l,p);e.closePath(),e.fillShape(this._shape)},se.prototype._waveformShapeHitFunc=function(e){if(this._segment){var t=this._view.getFrameOffset(),i=this._view.getWidth(),o=this._view.getHeight(),n=this._view.timeToPixels(this._segment.startTime),s=o-20;s<0&&(s=0);var a=n-t,r=this._view.timeToPixels(this._segment.endTime)-n;a<0&&(r-=-a,a=0),a+r>i&&(r-=a+r-i),e.beginPath(),e.rect(a,10,r,s),e.closePath(),e.fillStrokeShape(this._shape)}},se.prototype.addToLayer=function(e){e.add(this._shape)},se.prototype.destroy=function(){this._shape.destroy(),this._shape=null},se.prototype.on=function(e,t){this._shape.on(e,t)},se.scaleY=function(e,t,i){var o=-(t-1)*(e*i+128)/255+(t-1);return d(Math.floor(o),0,t-1)};function ae(e,t,i,o){this._segment=e,this._peaks=t,this._layer=i,this._view=o,this._label=null,this._startMarker=null,this._endMarker=null,this._color=e.color,this._waveformShape=new se({color:e.color,view:o,segment:e}),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onClick=this._onClick.bind(this),this._onDblClick=this._onDblClick.bind(this),this._waveformShape.on("mouseenter",this._onMouseEnter),this._waveformShape.on("mouseleave",this._onMouseLeave),this._waveformShape.on("click",this._onClick),this._waveformShape.on("dblclick",this._onDblClick),this._onSegmentHandleDrag=this._onSegmentHandleDrag.bind(this),this._onSegmentHandleDragStart=this._onSegmentHandleDragStart.bind(this),this._onSegmentHandleDragEnd=this._onSegmentHandleDragEnd.bind(this),this._label=this._peaks.options.createSegmentLabel({segment:e,view:this._view.getName(),layer:this._layer,fontFamily:this._peaks.options.fontFamily,fontSize:this._peaks.options.fontSize,fontStyle:this._peaks.options.fontStyle}),this._label&&this._label.hide(),this._createMarkers()}function re(e,t,i){this._peaks=e,this._view=t,this._allowEditing=i,this._segmentShapes={},this._layer=new o.Layer,this._onSegmentsUpdate=this._onSegmentsUpdate.bind(this),this._onSegmentsAdd=this._onSegmentsAdd.bind(this),this._onSegmentsRemove=this._onSegmentsRemove.bind(this),this._onSegmentsRemoveAll=this._onSegmentsRemoveAll.bind(this),this._onSegmentsDragged=this._onSegmentsDragged.bind(this),this._peaks.on("segments.update",this._onSegmentsUpdate),this._peaks.on("segments.add",this._onSegmentsAdd),this._peaks.on("segments.remove",this._onSegmentsRemove),this._peaks.on("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.on("segments.dragged",this._onSegmentsDragged)}function he(e,t){var i=this;i._axisGridlineColor=t.axisGridlineColor,i._axisLabelColor=t.axisLabelColor,i._axisLabelFont=he._buildFontString(t.axisLabelFontFamily,t.axisLabelFontSize,t.axisLabelFontStyle),i._axisShape=new o.Shape({sceneFunc:function(t){i.drawAxis(t,e)}})}function le(e,t,i){var n=this;if(n._originalWaveformData=e,n._container=t,n._peaks=i,n._options=i.options,n._viewOptions=i.options.overview,n._onTimeUpdate=n._onTimeUpdate.bind(this),n._onPlaying=n._onPlaying.bind(this),n._onPause=n._onPause.bind(this),n._onZoomviewDisplaying=n._onZoomviewDisplaying.bind(this),n._onWindowResize=n._onWindowResize.bind(this),i.on("player.timeupdate",n._onTimeUpdate),i.on("player.playing",n._onPlaying),i.on("player.pause",n._onPause),i.on("zoomview.displaying",n._onZoomviewDisplaying),i.on("window_resize",n._onWindowResize),n._amplitudeScale=1,n._timeLabelPrecision=n._viewOptions.timeLabelPrecision,n._width=t.clientWidth,n._height=t.clientHeight,n._data=e,0!==n._width)try{n._data=e.resample({width:n._width})}catch(e){}o.showWarnings=!1,n._resizeTimeoutId=null,n._stage=new o.Stage({container:t,width:n._width,height:n._height}),n._waveformLayer=new o.Layer({listening:!1}),n._waveformColor=n._viewOptions.waveformColor,n._playedWaveformColor=n._viewOptions.playedWaveformColor,n._createWaveform(),n._segmentsLayer=new re(i,n,!1),n._segmentsLayer.addToStage(n._stage),n._pointsLayer=new oe(i,n,!1),n._pointsLayer.addToStage(n._stage),n._highlightLayer=new $(n,n._viewOptions.highlightOffset,n._viewOptions.highlightColor),n._highlightLayer.addToStage(n._stage),n._createAxisLabels(),n._playheadLayer=new te({player:n._peaks.player,view:n,showPlayheadTime:n._viewOptions.showPlayheadTime,playheadColor:n._viewOptions.playheadColor,playheadTextColor:n._viewOptions.playheadTextColor,playheadFontFamily:n._viewOptions.fontFamily,playheadFontSize:n._viewOptions.fontSize,playheadFontStyle:n._viewOptions.fontStyle}),n._playheadLayer.addToStage(n._stage);var s=n._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(s),n._mouseDragHandler=new ee(n._stage,{onMouseDown:function(e){e=d(e,0,n._width);var t=n.pixelsToTime(e),o=n._getDuration();t>o&&(t=o),n._playheadLayer.updatePlayheadTime(t),i.player.seek(t)},onMouseMove:function(e){e=d(e,0,n._width);var t=n.pixelsToTime(e),i=n._getDuration();t>i&&(t=i),n._playheadLayer.updatePlayheadTime(t),n._peaks.player.seek(t)}}),n._onClick=n._onClick.bind(this),n._onDblClick=n._onDblClick.bind(this),n._stage.on("click",n._onClick),n._stage.on("dblclick",n._onDblClick)}function pe(e,t,i){var n=this;n._originalWaveformData=e,n._container=t,n._peaks=i,n._options=i.options,n._viewOptions=i.options.zoomview,n._onTimeUpdate=n._onTimeUpdate.bind(n),n._onPlaying=n._onPlaying.bind(n),n._onPause=n._onPause.bind(n),n._onWindowResize=n._onWindowResize.bind(n),n._onKeyboardLeft=n._onKeyboardLeft.bind(n),n._onKeyboardRight=n._onKeyboardRight.bind(n),n._onKeyboardShiftLeft=n._onKeyboardShiftLeft.bind(n),n._onKeyboardShiftRight=n._onKeyboardShiftRight.bind(n),n._peaks.on("player.timeupdate",n._onTimeUpdate),n._peaks.on("player.playing",n._onPlaying),n._peaks.on("player.pause",n._onPause),n._peaks.on("window_resize",n._onWindowResize),n._peaks.on("keyboard.left",n._onKeyboardLeft),n._peaks.on("keyboard.right",n._onKeyboardRight),n._peaks.on("keyboard.shift_left",n._onKeyboardShiftLeft),n._peaks.on("keyboard.shift_right",n._onKeyboardShiftRight),n._enableAutoScroll=!0,n._amplitudeScale=1,n._timeLabelPrecision=n._viewOptions.timeLabelPrecision,n._data=null,n._pixelLength=0;var s=i.zoom.getZoomLevel();n._zoomLevelAuto=!1,n._zoomLevelSeconds=null,n._resizeTimeoutId=null,n._resampleData({scale:s}),n._width=t.clientWidth,n._height=t.clientHeight,n._frameOffset=0,n._stage=new o.Stage({container:t,width:n._width,height:n._height}),n._waveformLayer=new o.Layer({listening:!1}),n._waveformColor=n._viewOptions.waveformColor,n._playedWaveformColor=n._viewOptions.playedWaveformColor,n._createWaveform(),n._segmentsLayer=new re(i,n,!0),n._segmentsLayer.addToStage(n._stage),n._pointsLayer=new oe(i,n,!0),n._pointsLayer.addToStage(n._stage),n._createAxisLabels(),n._playheadLayer=new te({player:n._peaks.player,view:n,showPlayheadTime:n._viewOptions.showPlayheadTime,playheadColor:n._viewOptions.playheadColor,playheadTextColor:n._viewOptions.playheadTextColor,playheadFontFamily:n._viewOptions.fontFamily,playheadFontSize:n._viewOptions.fontSize,playheadFontStyle:n._viewOptions.fontStyle}),n._playheadLayer.addToStage(n._stage);var a=n._peaks.player.getCurrentTime();n._syncPlayhead(a),n._mouseDragHandler=new ee(n._stage,{onMouseDown:function(e){this.initialFrameOffset=n._frameOffset,this.mouseDownX=e},onMouseMove:function(e){var t=this.mouseDownX-e,i=this.initialFrameOffset+t;i!==this.initialFrameOffset&&n._updateWaveform(i)},onMouseUp:function(){if(!n._mouseDragHandler.isDragging()){var e=n.pixelOffsetToTime(this.mouseDownX),t=n._getDuration();e>t&&(e=t),n._playheadLayer.updatePlayheadTime(e),n._peaks.player.seek(e)}}}),n._onWheel=n._onWheel.bind(n),n.setWheelMode(n._viewOptions.wheelMode),n._onClick=n._onClick.bind(this),n._onDblClick=n._onDblClick.bind(this),n._stage.on("click",n._onClick),n._stage.on("dblclick",n._onDblClick)}function _e(e){this._peaks=e,this._overview=null,this._zoomview=null}function de(e,t){this._peaks=e,this._zoomLevels=t,this._zoomLevelIndex=0}ae.prototype.updatePosition=function(){var e=this._view.timeToPixels(this._segment.startTime),t=this._view.timeToPixels(this._segment.endTime),i=this._view.getFrameOffset(),o=e-i,n=t-i,s=this.getStartMarker();s&&s.setX(o-s.getWidth()),(s=this.getEndMarker())&&s.setX(n)},ae.prototype.getSegment=function(){return this._segment},ae.prototype.getStartMarker=function(){return this._startMarker},ae.prototype.getEndMarker=function(){return this._endMarker},ae.prototype.addToLayer=function(e){this._waveformShape.addToLayer(e),this._label&&e.add(this._label),this._startMarker&&this._startMarker.addToLayer(e),this._endMarker&&this._endMarker.addToLayer(e)},ae.prototype._createMarkers=function(){var e=this._layer.isEditingEnabled()&&this._segment.editable;if(e){var t=this._peaks.options.createSegmentMarker({segment:this._segment,draggable:e,startMarker:!0,color:this._peaks.options.segmentStartMarkerColor,fontFamily:this._peaks.options.fontFamily||"sans-serif",fontSize:this._peaks.options.fontSize||10,fontStyle:this._peaks.options.fontStyle||"normal",layer:this._layer,view:this._view.getName()});t&&(this._startMarker=new ne({segment:this._segment,segmentShape:this,draggable:e,startMarker:!0,marker:t,onDrag:this._onSegmentHandleDrag,onDragStart:this._onSegmentHandleDragStart,onDragEnd:this._onSegmentHandleDragEnd}));var i=this._peaks.options.createSegmentMarker({segment:this._segment,draggable:e,startMarker:!1,color:this._peaks.options.segmentEndMarkerColor,fontFamily:this._peaks.options.fontFamily||"sans-serif",fontSize:this._peaks.options.fontSize||10,fontStyle:this._peaks.options.fontStyle||"normal",layer:this._layer,view:this._view.getName()});i&&(this._endMarker=new ne({segment:this._segment,segmentShape:this,draggable:e,startMarker:!1,marker:i,onDrag:this._onSegmentHandleDrag,onDragStart:this._onSegmentHandleDragStart,onDragEnd:this._onSegmentHandleDragEnd}))}},ae.prototype._onMouseEnter=function(){this._label&&(this._label.moveToTop(),this._label.show()),this._peaks.emit("segments.mouseenter",this._segment)},ae.prototype._onMouseLeave=function(){this._label&&this._label.hide(),this._peaks.emit("segments.mouseleave",this._segment)},ae.prototype._onClick=function(){this._peaks.emit("segments.click",this._segment)},ae.prototype._onDblClick=function(){this._peaks.emit("segments.dblclick",this._segment)},ae.prototype._onSegmentHandleDrag=function(e){var t=this._view.getWidth(),i=e.isStartMarker(),o=this._startMarker.getX(),n=this._endMarker.getX();if(i&&o>=0){var s=o+this._startMarker.getWidth();this._segment._setStartTime(this._view.pixelOffsetToTime(s)),e.timeUpdated(this._segment.startTime)}if(!i&&n<t){var a=n;this._segment._setEndTime(this._view.pixelOffsetToTime(a)),e.timeUpdated(this._segment.endTime)}this._peaks.emit("segments.dragged",this._segment,i)},ae.prototype._onSegmentHandleDragStart=function(e){var t=e.isStartMarker();this._peaks.emit("segments.dragstart",this._segment,t)},ae.prototype._onSegmentHandleDragEnd=function(e){var t=e.isStartMarker();this._peaks.emit("segments.dragend",this._segment,t)},ae.prototype.fitToView=function(){this._startMarker&&this._startMarker.fitToView(),this._endMarker&&this._endMarker.fitToView(),this._waveformShape.setWaveformColor(this._color)},ae.prototype.destroy=function(){this._waveformShape.destroy(),this._label&&this._label.destroy(),this._startMarker&&this._startMarker.destroy(),this._endMarker&&this._endMarker.destroy()},re.prototype.addToStage=function(e){e.add(this._layer)},re.prototype.enableEditing=function(e){this._allowEditing=e},re.prototype.isEditingEnabled=function(){return this._allowEditing},re.prototype.formatTime=function(e){return this._view.formatTime(e)},re.prototype._onSegmentsUpdate=function(e){var t=!1,i=this._segmentShapes[e.id],o=this._view.getStartTime(),n=this._view.getEndTime();i&&(this._removeSegment(e),t=!0),e.isVisible(o,n)&&(this._addSegmentShape(e),t=!0),t&&this.updateSegments(o,n)},re.prototype._onSegmentsAdd=function(e){var t=this,i=t._view.getStartTime(),o=t._view.getEndTime();e.forEach((function(e){e.isVisible(i,o)&&t._addSegmentShape(e)})),t.updateSegments(i,o)},re.prototype._onSegmentsRemove=function(e){var t=this;e.forEach((function(e){t._removeSegment(e)}))},re.prototype._onSegmentsRemoveAll=function(){this._layer.removeChildren(),this._segmentShapes={}},re.prototype._onSegmentsDragged=function(e){this._updateSegment(e)},re.prototype._createSegmentShape=function(e){return new ae(e,this._peaks,this,this._view)},re.prototype._addSegmentShape=function(e){var t=this._createSegmentShape(e);return t.addToLayer(this._layer),this._segmentShapes[e.id]=t,t},re.prototype.updateSegments=function(e,t){this._peaks.segments.find(e,t).forEach(this._updateSegment.bind(this)),this._removeInvisibleSegments(e,t)},re.prototype._updateSegment=function(e){this._findOrAddSegmentShape(e).updatePosition()},re.prototype._findOrAddSegmentShape=function(e){var t=this._segmentShapes[e.id];return t||(t=this._addSegmentShape(e)),t},re.prototype._removeInvisibleSegments=function(e,t){var i=0;for(var o in this._segmentShapes)if(m(this._segmentShapes,o)){var n=this._segmentShapes[o].getSegment();n.isVisible(e,t)||(this._removeSegment(n),i++)}return i},re.prototype._removeSegment=function(e){var t=this._segmentShapes[e.id];t&&(t.destroy(),delete this._segmentShapes[e.id])},re.prototype.setVisible=function(e){this._layer.setVisible(e)},re.prototype.destroy=function(){this._peaks.off("segments.update",this._onSegmentsUpdate),this._peaks.off("segments.add",this._onSegmentsAdd),this._peaks.off("segments.remove",this._onSegmentsRemove),this._peaks.off("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.off("segments.dragged",this._onSegmentsDragged)},re.prototype.fitToView=function(){for(var e in this._segmentShapes){if(m(this._segmentShapes,e))this._segmentShapes[e].fitToView()}},re.prototype.draw=function(){this._layer.draw()},re.prototype.getHeight=function(){return this._layer.getHeight()},he._buildFontString=function(e,t,i){return t||(t=11),e||(e="sans-serif"),i||(i="normal"),i+" "+t+"px "+e},he.prototype.addToLayer=function(e){e.add(this._axisShape)},he.prototype.getAxisLabelScale=function(e){for(var t,i=1,o=[1,2,5,10,20,30],n=0;;){if(t=i*o[n],!(e.timeToPixels(t)<60))break;++n===o.length&&(i*=60,n=0)}return t},he.prototype.drawAxis=function(e,t){var i=t.getStartTime(),o=this.getAxisLabelScale(t),n=function(e,t){if(0===t)return 0;var i=1;return e<0&&(i=-1,e=-e),i*((Math.ceil(e)+t-1)/t|0)*t}(i,o),s=n-i,a=t.timeToPixels(s);e.setAttr("strokeStyle",this._axisGridlineColor),e.setAttr("lineWidth",1),e.setAttr("font",this._axisLabelFont),e.setAttr("fillStyle",this._axisLabelColor),e.setAttr("textAlign","left"),e.setAttr("textBaseline","bottom");for(var r,h=n,l=t.getWidth(),p=t.getHeight();!((r=a+t.timeToPixels(h-n))>=l);){e.beginPath(),e.moveTo(r+.5,0),e.lineTo(r+.5,10),e.moveTo(r+.5,p),e.lineTo(r+.5,p-10),e.stroke();var d=_(h,0),m=r-e.measureText(d).width/2,u=p-1-10;m>=0&&e.fillText(d,m,u),h+=o}},le.prototype._onClick=function(e){this._clickHandler(e,"overview.click")},le.prototype._onDblClick=function(e){this._clickHandler(e,"overview.dblclick")},le.prototype._clickHandler=function(e,t){var i=e.evt.layerX,o=this.pixelsToTime(i);this._peaks.emit(t,o)},le.prototype.getName=function(){return"overview"},le.prototype._onTimeUpdate=function(e){this._playheadLayer.updatePlayheadTime(e)},le.prototype._onPlaying=function(e){this._playheadLayer.updatePlayheadTime(e)},le.prototype._onPause=function(e){this._playheadLayer.stop(e)},le.prototype._onZoomviewDisplaying=function(e,t){this.showHighlight(e,t)},le.prototype.showHighlight=function(e,t){this._highlightLayer.showHighlight(e,t)},le.prototype._onWindowResize=function(){var e=this;e._resizeTimeoutId&&(clearTimeout(e._resizeTimeoutId),e._resizeTimeoutId=null),0!==e._container.clientWidth&&(e._width=e._container.clientWidth,e._stage.setWidth(e._width),e._resizeTimeoutId=setTimeout((function(){e._width=e._container.clientWidth,e._data=e._originalWaveformData.resample({width:e._width}),e._stage.setWidth(e._width),e._updateWaveform()}),500))},le.prototype.setWaveformData=function(e){this._originalWaveformData=e,0!==this._width?this._data=e.resample({width:this._width}):this._data=e,this._updateWaveform()},le.prototype.playheadPosChanged=function(e){this._playedWaveformShape&&(this._playedSegment.endTime=e,this._unplayedSegment.startTime=e,this._waveformLayer.draw())},le.prototype.timeToPixels=function(e){return Math.floor(e*this._data.sample_rate/this._data.scale)},le.prototype.pixelsToTime=function(e){return e*this._data.scale/this._data.sample_rate},le.prototype.pixelOffsetToTime=le.prototype.pixelsToTime,le.prototype.getFrameOffset=function(){return 0},le.prototype.getStartTime=function(){return 0},le.prototype.getEndTime=function(){return this._getDuration()},le.prototype.getWidth=function(){return this._width},le.prototype.getHeight=function(){return this._height},le.prototype._getDuration=function(){return this._peaks.player.getDuration()},le.prototype.setAmplitudeScale=function(e){if(!f(e)||!y(e))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");this._amplitudeScale=e,this._waveformLayer.draw(),this._segmentsLayer.draw()},le.prototype.getAmplitudeScale=function(){return this._amplitudeScale},le.prototype.getWaveformData=function(){return this._data},le.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new se({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var e=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:e},this._unplayedSegment={startTime:e,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new se({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}},le.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null},le.prototype._createWaveform=function(){this._createWaveformShapes(),this._stage.add(this._waveformLayer)},le.prototype._createAxisLabels=function(){this._axisLayer=new o.Layer({listening:!1}),this._axis=new he(this,{axisGridlineColor:this._viewOptions.axisGridlineColor,axisLabelColor:this._viewOptions.axisLabelColor,axisLabelFontFamily:this._viewOptions.fontFamily,axisLabelFontSize:this._viewOptions.fontSize,axisLabelFontStyle:this._viewOptions.fontStyle}),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)},le.prototype.removeHighlightRect=function(){this._highlightLayer.removeHighlight()},le.prototype._updateWaveform=function(){this._waveformLayer.draw(),this._axisLayer.draw();var e=this._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(e),this._highlightLayer.updateHighlight();var t=this.pixelsToTime(this._width);this._pointsLayer.updatePoints(0,t),this._segmentsLayer.updateSegments(0,t)},le.prototype.setWaveformColor=function(e){this._waveformColor=e,this._waveformShape.setWaveformColor(e)},le.prototype.setPlayedWaveformColor=function(e){this._playedWaveformColor=e,e?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(e)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()},le.prototype.showPlayheadTime=function(e){this._playheadLayer.showPlayheadTime(e)},le.prototype.setTimeLabelPrecision=function(e){this._timeLabelPrecision=e,this._playheadLayer.updatePlayheadText()},le.prototype.formatTime=function(e){return _(e,this._timeLabelPrecision)},le.prototype.enableMarkerEditing=function(e){this._segmentsLayer.enableEditing(e),this._pointsLayer.enableEditing(e)},le.prototype.fitToContainer=function(){if(0!==this._container.clientWidth||0!==this._container.clientHeight){var e=!1;if(this._container.clientWidth!==this._width){this._width=this._container.clientWidth,this._stage.setWidth(this._width);try{this._data=this._originalWaveformData.resample({width:this._width}),e=!0}catch(e){}}this._height=this._container.clientHeight,this._stage.setHeight(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this._segmentsLayer.fitToView(),this._pointsLayer.fitToView(),this._highlightLayer.fitToView(),e&&this._updateWaveform(),this._stage.draw()}},le.prototype.destroy=function(){this._resizeTimeoutId&&(clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=null),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("zoomview.displaying",this._onZoomviewDisplaying),this._peaks.off("window_resize",this._onWindowResize),this._playheadLayer.destroy(),this._segmentsLayer.destroy(),this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)},pe.prototype._onClick=function(e){this._clickHandler(e,"zoomview.click")},pe.prototype._onDblClick=function(e){this._clickHandler(e,"zoomview.dblclick")},pe.prototype._clickHandler=function(e,t){var i=e.evt.layerX,o=this.pixelOffsetToTime(i);this._peaks.emit(t,o)},pe.prototype.setWheelMode=function(e){if(e!==this._wheelMode)switch(this._wheelMode=e,e){case"scroll":this._stage.on("wheel",this._onWheel);break;case"none":this._stage.off("wheel")}},pe.prototype._onWheel=function(e){var t=e.evt,i=t.shiftKey?t.deltaY:t.deltaX,o=t.shiftKey?t.deltaX:t.deltaY;if(!(Math.abs(i)<Math.abs(o))){e.evt.preventDefault();var n=d(this._frameOffset+Math.floor(i),0,this._pixelLength-this._width);this._updateWaveform(n)}},pe.prototype.getName=function(){return"zoomview"},pe.prototype._onTimeUpdate=function(e){this._mouseDragHandler.isDragging()||this._syncPlayhead(e)},pe.prototype._onPlaying=function(e){this._playheadLayer.updatePlayheadTime(e)},pe.prototype._onPause=function(e){this._playheadLayer.stop(e)},pe.prototype._onWindowResize=function(){var e=this,t=e._container.clientWidth;e._zoomLevelAuto?(e._resizeTimeoutId&&(clearTimeout(e._resizeTimeoutId),e._resizeTimeoutId=null),0!==t&&(e._width=t,e._stage.width(t),e._resizeTimeoutId=setTimeout((function(){e._width=t,e._data=e._originalWaveformData.resample(t),e._stage.width(t),e._updateWaveform(e._frameOffset)}),500))):(e._width=t,e._stage.width(t),e._updateWaveform(e._frameOffset))},pe.prototype._onKeyboardLeft=function(){this._keyboardScroll(-1,!1)},pe.prototype._onKeyboardRight=function(){this._keyboardScroll(1,!1)},pe.prototype._onKeyboardShiftLeft=function(){this._keyboardScroll(-1,!0)},pe.prototype._onKeyboardShiftRight=function(){this._keyboardScroll(1,!0)},pe.prototype._keyboardScroll=function(e,t){var i;i=t?e*this._width:e*this.timeToPixels(this._options.nudgeIncrement),this.scrollWaveform({pixels:i})},pe.prototype.setWaveformData=function(e){this._originalWaveformData=e},pe.prototype.playheadPosChanged=function(e){this._playedWaveformShape&&(this._playedSegment.endTime=e,this._unplayedSegment.startTime=e,this._drawWaveformLayer())},pe.prototype._syncPlayhead=function(e){if(this._playheadLayer.updatePlayheadTime(e),this._enableAutoScroll){var t=this.timeToPixels(e);(t>=this._frameOffset+this._width-100||t<this._frameOffset)&&(this._frameOffset=t-100,this._frameOffset<0&&(this._frameOffset=0),this._updateWaveform(this._frameOffset))}},pe.prototype._getScale=function(e){return e*this._data.sample_rate/this._width},pe.prototype.setZoom=function(e){var t;if(function(e){return m(e,"scale")&&"auto"===e.scale||m(e,"seconds")&&"auto"===e.seconds}(e)){var i=this._peaks.player.getDuration();if(!c(i))return!1;this._zoomLevelAuto=!0,this._zoomLevelSeconds=null,t=this._getScale(i)}else{if(m(e,"scale"))this._zoomLevelSeconds=null,t=e.scale;else if(m(e,"seconds")){if(!c(e.seconds))return!1;this._zoomLevelSeconds=e.seconds,t=this._getScale(e.seconds)}this._zoomLevelAuto=!1}t<this._originalWaveformData.scale&&(this._peaks.logger("peaks.zoomview.setZoom(): zoom level must be at least "+this._originalWaveformData.scale),t=this._originalWaveformData.scale);var o,n=this._peaks.player.getCurrentTime(),s=this._playheadLayer.getPlayheadOffset();s>=0&&s<this._width?o=n:(s=Math.floor(this._width/2),o=this.pixelOffsetToTime(s));var a=this._scale;this._resampleData({scale:t});var r=this.timeToPixels(o);return this._frameOffset=r-s,this._updateWaveform(this._frameOffset),this._playheadLayer.zoomLevelChanged(),this._playheadLayer.updatePlayheadTime(n),this._peaks.emit("zoom.update",t,a),!0},pe.prototype._resampleData=function(e){this._data=this._originalWaveformData.resample(e),this._scale=this._data.scale,this._pixelLength=this._data.length},pe.prototype.getStartTime=function(){return this.pixelOffsetToTime(0)},pe.prototype.getEndTime=function(){return this.pixelOffsetToTime(this._width)},pe.prototype.setStartTime=function(e){e<0&&(e=0),this._zoomLevelAuto&&(e=0),this._updateWaveform(this.timeToPixels(e))},pe.prototype.timeToPixels=function(e){return Math.floor(e*this._data.sample_rate/this._data.scale)},pe.prototype.pixelsToTime=function(e){return e*this._data.scale/this._data.sample_rate},pe.prototype.pixelOffsetToTime=function(e){return(this._frameOffset+e)*this._data.scale/this._data.sample_rate},pe.prototype.getFrameOffset=function(){return this._frameOffset},pe.prototype.getWidth=function(){return this._width},pe.prototype.getHeight=function(){return this._height},pe.prototype._getDuration=function(){return this._peaks.player.getDuration()},pe.prototype.setAmplitudeScale=function(e){if(!f(e)||!y(e))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");this._amplitudeScale=e,this._drawWaveformLayer(),this._segmentsLayer.draw()},pe.prototype.getAmplitudeScale=function(){return this._amplitudeScale},pe.prototype.getWaveformData=function(){return this._data},pe.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new se({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var e=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:e},this._unplayedSegment={startTime:e,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new se({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}},pe.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null},pe.prototype._createWaveform=function(){this._createWaveformShapes(),this._stage.add(this._waveformLayer),this._peaks.emit("zoomview.displaying",0,this.getEndTime())},pe.prototype._createAxisLabels=function(){this._axisLayer=new o.Layer({listening:!1}),this._axis=new he(this,{axisGridlineColor:this._viewOptions.axisGridlineColor,axisLabelColor:this._viewOptions.axisLabelColor,axisLabelFontFamily:this._viewOptions.fontFamily,axisLabelFontSize:this._viewOptions.fontSize,axisLabelFontStyle:this._viewOptions.fontStyle}),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)},pe.prototype.scrollWaveform=function(e){var t;if(m(e,"pixels"))t=Math.floor(e.pixels);else{if(!m(e,"seconds"))throw new TypeError("view.scrollWaveform(): Missing umber of pixels or seconds");t=this.timeToPixels(e.seconds)}this._updateWaveform(this._frameOffset+t)},pe.prototype._updateWaveform=function(e){var t;this._pixelLength<this._width?(e=0,t=this._width):t=this._pixelLength-this._width,e=d(e,0,t),this._frameOffset=e;var i=this._playheadLayer.getPlayheadPixel();this._playheadLayer.updatePlayheadTime(this.pixelsToTime(i)),this._drawWaveformLayer(),this._axisLayer.draw();var o=this.getStartTime(),n=this.getEndTime();this._pointsLayer.updatePoints(o,n),this._segmentsLayer.updateSegments(o,n),this._peaks.emit("zoomview.displaying",o,n)},pe.prototype._drawWaveformLayer=function(){this._waveformLayer.draw()},pe.prototype.setWaveformColor=function(e){this._waveformColor=e,this._waveformShape.setWaveformColor(e)},pe.prototype.setPlayedWaveformColor=function(e){this._playedWaveformColor=e,e?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(e)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()},pe.prototype.showPlayheadTime=function(e){this._playheadLayer.showPlayheadTime(e)},pe.prototype.setTimeLabelPrecision=function(e){this._timeLabelPrecision=e,this._playheadLayer.updatePlayheadText()},pe.prototype.formatTime=function(e){return _(e,this._timeLabelPrecision)},pe.prototype.enableAutoScroll=function(e){this._enableAutoScroll=e},pe.prototype.enableMarkerEditing=function(e){this._segmentsLayer.enableEditing(e),this._pointsLayer.enableEditing(e)},pe.prototype.fitToContainer=function(){if(0!==this._container.clientWidth||0!==this._container.clientHeight){var e=!1;if(this._container.clientWidth!==this._width){this._width=this._container.clientWidth,this._stage.width(this._width);var t,i=!1;if(this._zoomLevelAuto?(i=!0,t={width:this._width}):null!==this._zoomLevelSeconds&&(i=!0,t={scale:this._getScale(this._zoomLevelSeconds)}),i)try{this._resampleData(t),e=!0}catch(e){}}this._height=this._container.clientHeight,this._stage.height(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this._segmentsLayer.fitToView(),this._pointsLayer.fitToView(),e&&this._updateWaveform(this._frameOffset),this._stage.draw()}},pe.prototype.destroy=function(){this._resizeTimeoutId&&(clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=null),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("window_resize",this._onWindowResize),this._peaks.off("keyboard.left",this._onKeyboardLeft),this._peaks.off("keyboard.right",this._onKeyboardRight),this._peaks.off("keyboard.shift_left",this._onKeyboardShiftLeft),this._peaks.off("keyboard.shift_right",this._onKeyboardShiftRight),this._playheadLayer.destroy(),this._segmentsLayer.destroy(),this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)},_e.prototype.createOverview=function(e){if(this._overview)return this._overview;var t=this._peaks.getWaveformData();return this._overview=new le(t,e,this._peaks),this._zoomview&&this._overview.showHighlight(this._zoomview.getStartTime(),this._zoomview.getEndTime()),this._overview},_e.prototype.createZoomview=function(e){if(this._zoomview)return this._zoomview;var t=this._peaks.getWaveformData();return this._zoomview=new pe(t,e,this._peaks),this._zoomview},_e.prototype.destroyOverview=function(){this._overview&&this._zoomview&&(this._overview.destroy(),this._overview=null)},_e.prototype.destroyZoomview=function(){this._zoomview&&this._overview&&(this._zoomview.destroy(),this._zoomview=null,this._overview.removeHighlightRect())},_e.prototype.destroy=function(){this._overview&&(this._overview.destroy(),this._overview=null),this._zoomview&&(this._zoomview.destroy(),this._zoomview=null)},_e.prototype.getView=function(e){if(w(e))return this._overview&&this._zoomview?null:this._overview?this._overview:this._zoomview?this._zoomview:null;switch(e){case"overview":return this._overview;case"zoomview":return this._zoomview;default:return null}},de.prototype.setZoomLevels=function(e){this._zoomLevels=e,this.setZoom(0,!0)},de.prototype.zoomIn=function(){this.setZoom(this._zoomLevelIndex-1)},de.prototype.zoomOut=function(){this.setZoom(this._zoomLevelIndex+1)},de.prototype.setZoom=function(e,t){if(e>=this._zoomLevels.length&&(e=this._zoomLevels.length-1),e<0&&(e=0),t||e!==this._zoomLevelIndex){this._zoomLevelIndex=e;var i=this._peaks.views.getView("zoomview");i&&i.setZoom({scale:this._zoomLevels[e]})}},de.prototype.getZoom=function(){return this._zoomLevelIndex},de.prototype.getZoomLevel=function(){return this._zoomLevels[this._zoomLevelIndex]};var me="withCredentials"in new XMLHttpRequest;function ue(e){this._peaks=e}function fe(){return r.call(this),this.options={zoomLevels:[512,1024,2048,4096],mediaElement:null,mediaUrl:null,dataUri:null,dataUriDefaultFormat:"json",withCredentials:!1,waveformData:null,webAudio:null,nudgeIncrement:1,segmentStartMarkerColor:"#aaaaaa",segmentEndMarkerColor:"#aaaaaa",randomizeSegmentColor:!0,segmentColor:"#ff851b",pointMarkerColor:"#39cccc",createSegmentMarker:q,createSegmentLabel:J,createPointMarker:Q,logger:console.error.bind(console)},this}ue.prototype.init=function(e,t){if(!(e.dataUri&&(e.webAudio||e.audioContext)||e.waveformData&&(e.webAudio||e.audioContext)||e.dataUri&&e.waveformData))return e.audioContext&&(this._peaks.logger("Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead"),e.webAudio={audioContext:e.audioContext}),e.dataUri?this._getRemoteWaveformData(e,t):e.waveformData?this._buildWaveformFromLocalData(e,t):e.webAudio?e.webAudio.audioBuffer?this._buildWaveformDataFromAudioBuffer(e,t):this._buildWaveformDataUsingWebAudio(e,t):void t(new Error("Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data"));t(new TypeError("Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data."))},ue.prototype._getRemoteWaveformData=function(e,t){var i,o=null,n=null;if(g(e.dataUri))o=e.dataUri;else{if(!v(e.dataUri))return void t(new TypeError("Peaks.init(): The dataUri option must be an object"));(o={})[e.dataUriDefaultFormat||"json"]=e.dataUri}(["ArrayBuffer","JSON"].some((function(e){if(window[e])return n=e.toLowerCase(),i=o[n],Boolean(i)})),i)?this._createXHR(i,n,e.withCredentials,(function(e){if(4===this.readyState)if(200===this.status){var i=s.create(e.target.response);1===i.channels||2===i.channels?8===i.bits?t(null,i):t(new Error("Peaks.init(): 16-bit waveform data is not supported")):t(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"))}else t(new Error("Unable to fetch remote data. HTTP status "+this.status))}),(function(){t(new Error("XHR Failed"))})).send():t(new Error("Peaks.init(): Unable to determine a compatible dataUri format for this browser"))},ue.prototype._buildWaveformFromLocalData=function(e,t){var i,o=null,n=null;if(g(e.waveformData))if(g((o=e.waveformData).json)?n=o.json:(i=o.arraybuffer,Object.prototype.toString.call(i).includes("ArrayBuffer")&&(n=o.arraybuffer)),n)try{var a=s.create(n);if(1!==a.channels&&2!==a.channels)return void t(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));if(8!==a.bits)return void t(new Error("Peaks.init(): 16-bit waveform data is not supported"));t(null,a)}catch(e){t(e)}else t(new Error("Peaks.init(): Unable to determine a compatible waveformData format"));else t(new Error("Peaks.init(): The waveformData option must be an object"))},ue.prototype._buildWaveformDataUsingWebAudio=function(e,t){var i=this,o=window.AudioContext||window.webkitAudioContext;if(e.webAudio.audioContext instanceof o){var n=e.webAudio;n.scale!==e.zoomLevels[0]&&(n.scale=e.zoomLevels[0]);var s=i._peaks.options.mediaElement.currentSrc;s?i._requestAudioAndBuildWaveformData(s,n,e.withCredentials,t):i._peaks.once("player.canplay",(function(){i._requestAudioAndBuildWaveformData(i._peaks.options.mediaElement.currentSrc,n,e.withCredentials,t)}))}else t(new TypeError("Peaks.init(): The webAudio.audioContext option must be a valid AudioContext"))},ue.prototype._buildWaveformDataFromAudioBuffer=function(e,t){var i=e.webAudio;i.scale!==e.zoomLevels[0]&&(i.scale=e.zoomLevels[0]);var o={audio_buffer:i.audioBuffer,split_channels:i.multiChannel,scale:i.scale};s.createFromAudio(o,t)},ue.prototype._requestAudioAndBuildWaveformData=function(e,t,i,o){e?this._createXHR(e,"arraybuffer",i,(function(e){if(4===this.readyState)if(200===this.status){var i={audio_context:t.audioContext,array_buffer:e.target.response,split_channels:t.multiChannel,scale:t.scale};s.createFromAudio(i,o)}else o(new Error("Unable to fetch remote data. HTTP status "+this.status))}),(function(){o(new Error("XHR Failed"))})).send():this._peaks.logger("Peaks.init(): The mediaElement src is invalid")},ue.prototype._createXHR=function(e,t,i,o,n){var s=new XMLHttpRequest;if(s.open("GET",e,!0),me)try{s.responseType=t}catch(e){}return s.onload=o,s.onerror=n,me&&i&&(s.withCredentials=!0),s},fe.prototype=Object.create(r.prototype);var ye={playheadColor:"#111111",playheadTextColor:"#aaaaaa",axisGridlineColor:"#cccccc",axisLabelColor:"#aaaaaa",fontFamily:"sans-serif",fontSize:11,fontStyle:"normal",timeLabelPrecision:2},ce={waveformColor:"rgba(0, 225, 128, 1)",wheelMode:"none"},ge={waveformColor:"rgba(0, 0, 0, 0.2)",highlightColor:"#aaaaaa",highlightOffset:11};fe.init=function(e,t){var i=new fe,o=i._setOptions(e);if(o)t(o);else{var n=i.options.zoomview.container,s=i.options.overview.container;if(b(n)||b(s))if(n&&n.clientWidth<=0)t(new TypeError("Peaks.init(): Please ensure that the zoomview container is visible and has non-zero width"));else if(s&&s.clientWidth<=0)t(new TypeError("Peaks.init(): Please ensure that the overview container is visible and has non-zero width"));else{e.keyboard&&(i._keyboardHandler=new B(i));var a=e.player?e.player:new N(i,i.options.mediaElement);i.player=new j(i,a),i.segments=new I(i),i.points=new O(i),i.zoom=new de(i,i.options.zoomLevels),i.views=new _e(i),new ue(i).init(i.options,(function(o,a){o?t&&t(o):(i._waveformData=a,s&&i.views.createOverview(s),n&&i.views.createZoomview(n),i._addWindowResizeHandler(),e.segments&&i.segments.add(e.segments),e.points&&i.points.add(e.points),e.emitCueEvents&&(i._cueEmitter=new M(i)),setTimeout((function(){i.emit("peaks.ready")}),0),t(null,i))}))}else t(new TypeError("Peaks.init(): The zoomview and/or overview container options must be valid HTML elements"))}},fe.prototype._setOptions=function(e){if(!g(e))return new TypeError("Peaks.init(): The options parameter should be an object");if(!e.player){if(!e.mediaElement)return new Error("Peaks.init(): Missing mediaElement option");if(!(e.mediaElement instanceof HTMLMediaElement))return new TypeError("Peaks.init(): The mediaElement option should be an HTMLMediaElement")}return e.container?new Error("Peaks.init(): The container option has been removed, please use containers instead"):e.logger&&"function"!=typeof e.logger?new TypeError("Peaks.init(): The logger option should be a function"):e.segments&&!Array.isArray(e.segments)?new TypeError("Peaks.init(): options.segments must be an array of segment objects"):e.points&&!Array.isArray(e.points)?new TypeError("Peaks.init(): options.points must be an array of point objects"):(function(e,t){for(var i in t)m(t,i)&&m(e,i)&&(e[i]=t[i])}(this.options,e),this.options.overview=function(e){var t={};return e.containers&&e.containers.overview&&(t.container=e.containers.overview),e.overviewWaveformColor&&(t.waveformColor=e.overviewWaveformColor),e.overviewHighlightOffset&&(t.highlightOffset=e.overviewHighlightOffset),e.overviewHighlightColor&&(t.highlightColor=e.overviewHighlightColor),e.overview&&e.overview.showPlayheadTime&&(t.showPlayheadTime=e.overview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","timeLabelPrecision","axisGridlineColor","axisLabelColor","fontFamily","fontSize","fontStyle","highlightColor","highlightOffset"].forEach((function(i){e.overview&&m(e.overview,i)?t[i]=e.overview[i]:m(e,i)?t[i]=e[i]:m(ge,i)?t[i]=ge[i]:m(ye,i)&&(t[i]=ye[i])})),t}(e),this.options.zoomview=function(e){var t={};return e.containers&&e.containers.zoomview&&(t.container=e.containers.zoomview),e.zoomWaveformColor&&(t.waveformColor=e.zoomWaveformColor),e.showPlayheadTime?t.showPlayheadTime=e.showPlayheadTime:e.zoomview&&e.zoomview.showPlayheadTime&&(t.showPlayheadTime=e.zoomview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","timeLabelPrecision","axisGridlineColor","axisLabelColor","fontFamily","fontSize","fontStyle","wheelMode"].forEach((function(i){e.zoomview&&m(e.zoomview,i)?t[i]=e.zoomview[i]:m(e,i)?t[i]=e[i]:m(ce,i)?t[i]=ce[i]:m(ye,i)&&(t[i]=ye[i])})),t}(e),Array.isArray(this.options.zoomLevels)?0===this.options.zoomLevels.length?new Error("Peaks.init(): The zoomLevels array must not be empty"):function(e){if(0===e.length)return!0;for(var t=e[0],i=1;i<e.length;i++){if(t>=e[i])return!1;t=e[i]}return!0}(this.options.zoomLevels)?void(e.logger&&(this.logger=e.logger)):new Error("Peaks.init(): The zoomLevels array must be sorted in ascending order"):new TypeError("Peaks.init(): The zoomLevels option should be an array"))},fe.prototype.setSource=function(e,t){var i=this;function o(){i.removeAllListeners("player.canplay"),i.removeAllListeners("player.error")}function n(){o(),e.zoomLevels||(e.zoomLevels=i.options.zoomLevels),new ue(i).init(e,(function(o,n){o?t(o):(i._waveformData=n,["overview","zoomview"].forEach((function(e){var t=i.views.getView(e);t&&t.setWaveformData(n)})),i.zoom.setZoomLevels(e.zoomLevels),t())}))}!this.options.mediaElement||e.mediaUrl?(i.once("player.canplay",n),i.once("player.error",(function(e){o(),t(e)})),this.options.mediaElement?i.options.mediaElement.setAttribute("src",e.mediaUrl):n()):t(new Error("peaks.setSource(): options must contain a mediaUrl when using mediaElement"))},fe.prototype.getWaveformData=function(){return this._waveformData},fe.prototype._addWindowResizeHandler=function(){this._onResize=this._onResize.bind(this),window.addEventListener("resize",this._onResize)},fe.prototype._onResize=function(){this.emit("window_resize")},fe.prototype._removeWindowResizeHandler=function(){window.removeEventListener("resize",this._onResize)},fe.prototype.destroy=function(){this._removeWindowResizeHandler(),this._keyboardHandler&&this._keyboardHandler.destroy(),this.views&&this.views.destroy(),this.player&&this.player.destroy(),this._cueEmitter&&this._cueEmitter.destroy()};export{fe as default};
//# sourceMappingURL=peaks.esm.min.js.map
